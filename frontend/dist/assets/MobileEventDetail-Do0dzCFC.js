import{d as Re,A as Ae,u as Be,l as Ne,r as m,B as je,c as u,g as V,C as M,o as ze,b as o,e as i,i as h,D as de,t as v,F as y,h as a,n as me,f as b,y as T,j as P,w as He,E as Je,G as Oe,H as Ve,_ as qe}from"./index-CT-XDF2b.js";import{u as Ge}from"./useFavorites-CfB83eXE.js";const Ke={class:"event-detail-page"},Ye={key:0,class:"event-skeleton"},Ze={key:1,class:"event-state error"},Qe={class:"m-event-content event-content--with-footer"},We={class:"event-hero"},Xe={class:"event-carousel"},et=["src","alt"],tt={key:2,class:"carousel-dots"},at=["onClick"],st={class:"event-hero-info"},lt={class:"m-text-event-title-main"},nt={class:"event-hero-actions"},ot={key:0,class:"m-chip-row"},it=["onClick"],rt={class:"m-event-card event-meta-card"},ut={class:"event-schedule-block"},ct={class:"event-meta-row event-meta-row--schedule"},vt={class:"event-schedule"},dt={class:"event-schedule__day"},mt={class:"event-schedule__time"},pt={key:0,class:"event-schedule__badge"},ht={class:"event-meta-row event-meta-row--location"},gt={class:"event-meta-text"},ft={class:"event-location-title"},_t={key:1,class:"event-section"},yt={class:"m-event-card"},kt={class:"event-progress-head"},wt={class:"event-progress"},bt={key:0,class:"participant-wall"},Tt={class:"participant-avatars"},Ct=["src","alt"],xt={key:1},St={class:"sr-only"},$t={class:"participants-hint"},Ut={key:1,class:"participants-empty"},Dt={class:"event-section"},Mt={class:"m-event-card event-group-card"},Pt={class:"group-main"},It=["disabled"],Lt={class:"group-text"},Ft={class:"group-name"},Et={key:0,class:"i-lucide-bell-minus"},Rt={key:1,class:"i-lucide-bell-plus"},At={class:"event-section"},Bt={class:"m-event-card"},Nt=["innerHTML"],jt={key:2,class:"event-section"},zt={class:"m-event-card"},Ht={class:"event-requirements"},Jt={class:"event-footer"},Ot={class:"price-block"},Vt={class:"price"},qt=["disabled"],Gt={class:"max-h-[80vh] w-[90vw] max-w-md overflow-y-auto rounded-3xl bg-white p-4"},Kt={class:"participant-list"},Yt={class:"participant-list__avatar"},Zt=["src","alt"],Qt={key:1},Wt={class:"participant-list__name"},Xt=Re({__name:"MobileEventDetail",setup(ea){const z=Ae(),I=Be(),{user:L}=Ne(),F=Ge(),s=m(null),E=m([]),H=m(!0),R=m(null);m(null),m(!1),m(!1),m(!1),m(null),m(null),m(!1),m(!1),je({});const C=m(null),g=m(0),x=m(null),A=m(!1),f=u(()=>z.params.eventId),J=u(()=>!!L.value),q=u(()=>{var e;return((e=s.value)==null?void 0:e.registrationFormSchema)??[]}),pe=u(()=>{var t;const e=(t=n.value)==null?void 0:t.id;return e?F.isFavorite(e):!1}),B=u(()=>!!x.value),he=u(()=>{var e;return A.value&&!B.value?"読み込み中…":B.value?"申込済み・チケットを見る":((e=n.value)==null?void 0:e.status)==="open"?"イベントに申し込む":"受付終了"}),ge=u(()=>B.value?!1:n.value?n.value.status!=="open"||A.value:!0),n=u(()=>{var r,d,l,c,_,se,le,ne,oe,ie,re,ue,ce,ve;if(!s.value)return null;const e=ee(s.value.startTime),t=s.value.endTime?ee(s.value.endTime):"未定";return{id:s.value.id,status:s.value.status,title:V(s.value.title),categoryLabel:s.value.category??"イベント",timeFullText:`${e} 〜 ${t}`,locationText:s.value.locationText,coverUrl:((r=E.value[0])==null?void 0:r.imageUrl)??"https://placehold.co/640x360?text=Event",regSummary:((d=s.value.config)==null?void 0:d.regSummary)??"参加状況を確認中",capacityText:s.value.maxParticipants?`定員 ${s.value.maxParticipants}名`:"定員未設定",regProgress:((l=s.value.config)==null?void 0:l.regProgress)??40,priceText:((c=s.value.config)==null?void 0:c.priceText)??"無料 / 未定",hostName:((_=s.value.community)==null?void 0:_.name)??"SOCIALMORE Community",communitySlug:((se=s.value.community)==null?void 0:se.slug)??null,descriptionHtml:s.value.descriptionHtml??`<p>${V(s.value.description??s.value.title)}</p>`,mapUrl:typeof s.value.locationLat=="number"&&typeof s.value.locationLng=="number"?`https://www.google.com/maps/dir/?api=1&destination=${s.value.locationLat},${s.value.locationLng}`:`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(s.value.locationText)}`,participants:Array.isArray((le=s.value.config)==null?void 0:le.participants)&&((oe=(ne=s.value.config)==null?void 0:ne.participants)!=null&&oe.length)?(ie=s.value.config)==null?void 0:ie.participants:[],participantCount:((re=s.value.config)==null?void 0:re.participantCount)??((ce=(ue=s.value.config)==null?void 0:ue.participants)==null?void 0:ce.length)??null,showParticipants:((ve=s.value.config)==null?void 0:ve.showRegistrationStatus)!==!1}}),p=u(()=>{var t;if(E.value.length)return E.value.map((r,d)=>({id:r.id??`gallery-${d}`,imageUrl:r.imageUrl}));const e=(t=n.value)==null?void 0:t.coverUrl;return e?[{id:"cover",imageUrl:e}]:[]}),G=u(()=>{var e,t,r;return p.value.length?((t=p.value[g.value])==null?void 0:t.imageUrl)??((r=p.value[0])==null?void 0:r.imageUrl)??"":((e=n.value)==null?void 0:e.coverUrl)??""}),fe=u(()=>G.value?{backgroundImage:`url(${G.value})`}:{}),O=u(()=>{var c;if(!n.value||!((c=s.value)!=null&&c.startTime))return"";const e=ae(s.value.startTime),t=ae(s.value.endTime??s.value.startTime);if(!e||!t)return"";const r=encodeURIComponent(n.value.title),d=encodeURIComponent(n.value.locationText??""),l=encodeURIComponent(V(s.value.description??s.value.title)??n.value.title);return`https://calendar.google.com/calendar/render?action=TEMPLATE&text=${r}&dates=${e}/${t}&location=${d}&details=${l}`}),S=u(()=>{var d;if(!s.value)return[];const e={id:s.value.id,label:U(s.value.startTime),meta:te(s.value.startTime,s.value.endTime)},t=(s.value.occurrences??((d=s.value.config)==null?void 0:d.occurrences))||[],r=Array.isArray(t)?t.map((l,c)=>{var _;return{id:`occ-${c}`,label:U(l.start??l.startTime??((_=s.value)==null?void 0:_.startTime)),meta:te(l.start??l.startTime,l.end??l.endTime)}}):[];return[e,...r]});M(S,e=>{e.length&&!C.value&&(C.value=e[0].id)},{immediate:!0});const K=u(()=>S.value.find(e=>e.id===C.value)??S.value[0]),N=u(()=>n.value?{id:n.value.id,title:n.value.title,coverUrl:n.value.coverUrl,timeText:n.value.timeFullText,locationText:n.value.locationText}:null),_e=u(()=>{var r,d;if(!((r=s.value)!=null&&r.startTime)||!((d=s.value)!=null&&d.endTime))return!1;const e=new Date(s.value.startTime),t=new Date(s.value.endTime);return e.toDateString()!==t.toDateString()}),Y=u(()=>{var r;const e=((r=s.value)==null?void 0:r.status)??"draft";return{open:{label:"受付中",variant:"is-live"},pending:{label:"受付前",variant:"is-pending"},soldout:{label:"満席",variant:"is-soldout"},closed:{label:"受付終了",variant:"is-closed"},ended:{label:"終了",variant:"is-closed"},draft:{label:"準備中",variant:"is-pending"}}[e]??{label:"ステータス未設定",variant:"is-closed"}}),ye=u(()=>{var e;return!!((e=n.value)!=null&&e.showParticipants)}),k=u(()=>{var e;return((e=n.value)==null?void 0:e.participants)??[]}),Z=u(()=>{var e;return((e=n.value)==null?void 0:e.participantCount)??k.value.length??0}),w=u(()=>k.value.slice(0,20)),ke=u(()=>k.value.length>w.value.length),we=u(()=>Math.max(k.value.length-w.value.length,0)),be=u(()=>Z.value?`${Z.value}名`:`${w.value.length}名`),j=m(!1),Te=async()=>{if(f.value){H.value=!0,R.value=null;try{const[e,t]=await Promise.all([Je(f.value),Oe(f.value)]);s.value=e,E.value=t}catch(e){R.value=e instanceof Error?e.message:"イベント情報の取得に失敗しました"}finally{H.value=!1}}},Ce=async()=>{if(!L.value||!f.value){x.value=null;return}A.value=!0;try{const e=await Ve();x.value=e.find(t=>t.event.id===f.value)??null}catch{x.value=null}finally{A.value=!1}};M(()=>p.value.length,()=>{g.value=0});const xe=()=>{navigator.share&&n.value&&navigator.share({title:n.value.title,url:window.location.href}).catch(()=>{})},Se=()=>{if(!(!n.value||!N.value)){if(!J.value){typeof window<"u"&&(window.localStorage.setItem("favorite:redirect",z.fullPath),window.localStorage.setItem("favorite:data",JSON.stringify(N.value))),I.push({name:"organizer-apply",query:{redirect:z.fullPath}});return}F.toggleFavorite(N.value)}},$e=e=>{e<0||e>=p.value.length||(g.value=e)},Ue=()=>{p.value.length&&(g.value=(g.value-1+p.value.length)%p.value.length)},De=()=>{p.value.length&&(g.value=(g.value+1)%p.value.length)},Me=()=>{O.value&&window.open(O.value,"_blank")},$=m(!1),Pe=()=>{$.value=!$.value},Ie=()=>{var e;(e=n.value)!=null&&e.communitySlug&&I.push({name:"community-portal",params:{slug:n.value.communitySlug}})},Q=e=>e?e.charAt(0).toUpperCase():"G",W=()=>{w.value.length&&(j.value=!0)},X=()=>{j.value=!1},Le=()=>{var e;(e=n.value)!=null&&e.mapUrl&&window.open(n.value.mapUrl,"_blank")},Fe=()=>{if(n.value){if(B.value){I.push({name:"my-events"});return}n.value.status==="open"&&I.push({name:"MobileEventRegister",params:{eventId:n.value.id}})}},Ee=(e,t)=>e.id??`${e.label??"field"}-${t}`,ee=e=>new Date(e).toLocaleString("ja-JP",{month:"short",day:"numeric",weekday:"short",hour:"2-digit",minute:"2-digit"}),U=e=>e?new Date(e).toLocaleDateString("ja-JP",{month:"long",day:"numeric",weekday:"short"}):"",te=(e,t)=>{if(!e)return"";const r=new Date(e),d=r.toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"});if(!t)return`${U(e)} ${d} 開始`;const l=new Date(t),c=l.toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"});return r.toDateString()===l.toDateString()?`${d} - ${c}`:`${U(e)} ${d} 〜 ${U(t)} ${c}`},D=e=>e.toString().padStart(2,"0"),ae=e=>{if(!e)return"";const t=new Date(e);return`${t.getUTCFullYear()}${D(t.getUTCMonth()+1)}${D(t.getUTCDate())}T${D(t.getUTCHours())}${D(t.getUTCMinutes())}${D(t.getUTCSeconds())}Z`};return ze(Te),M(()=>{var e;return[(e=L.value)==null?void 0:e.id,f.value]},()=>{L.value&&f.value?Ce():x.value=null},{immediate:!0}),M(()=>{var e;return[J.value,(e=n.value)==null?void 0:e.id]},()=>{if(!(typeof window>"u")&&J.value&&n.value&&N.value){const e=window.localStorage.getItem("favorite:data");if(e)try{const t=JSON.parse(e);t.id===n.value.id&&!F.isFavorite(t.id)&&F.addFavorite(t)}catch(t){console.warn("Failed to process pending favorite",t)}finally{window.localStorage.removeItem("favorite:data")}}},{immediate:!0}),M(k,e=>{e.length||(j.value=!1)},{immediate:!0}),(e,t)=>{var r,d;return i(),o("div",Ke,[H.value?(i(),o("div",Ye,[...t[0]||(t[0]=[de('<div class="skeleton-hero shimmer" data-v-23d08461></div><div class="skeleton-content" data-v-23d08461><div class="skeleton-title shimmer" data-v-23d08461></div><div class="skeleton-button-row" data-v-23d08461><span class="skeleton-button shimmer" data-v-23d08461></span><span class="skeleton-button shimmer" data-v-23d08461></span></div><div class="skeleton-card shimmer" data-v-23d08461></div><div class="skeleton-card shimmer" data-v-23d08461></div><div class="skeleton-card skeleton-card--short shimmer" data-v-23d08461></div></div>',2)])])):R.value?(i(),o("div",Ze,v(R.value),1)):n.value?(i(),o(y,{key:2},[a("main",Qe,[a("section",We,[t[5]||(t[5]=a("div",{class:"event-hero__overlay"},null,-1)),a("div",{class:"event-cover-wrapper",style:me(fe.value)},[a("div",Xe,[(i(!0),o(y,null,b(p.value,(l,c)=>(i(),o("div",{key:l.id||l.imageUrl||c,class:T(["event-carousel__slide",{"is-active":c===g.value}])},[a("img",{src:l.imageUrl,class:"event-cover",alt:`event cover ${c+1}`},null,8,et)],2))),128)),p.value.length>1?(i(),o("button",{key:0,class:"carousel-nav carousel-nav--prev",type:"button",onClick:Ue},[...t[1]||(t[1]=[a("span",{class:"i-lucide-chevron-left"},null,-1)])])):h("",!0),p.value.length>1?(i(),o("button",{key:1,class:"carousel-nav carousel-nav--next",type:"button",onClick:De},[...t[2]||(t[2]=[a("span",{class:"i-lucide-chevron-right"},null,-1)])])):h("",!0),p.value.length>1?(i(),o("div",tt,[(i(!0),o(y,null,b(p.value,(l,c)=>(i(),o("button",{key:l.id||l.imageUrl||`dot-${c}`,class:T(["carousel-dot",{"is-active":c===g.value}]),onClick:_=>$e(c)},null,10,at))),128))])):h("",!0)]),a("span",{class:T(["event-status-badge",Y.value.variant])},v(Y.value.label),3)],4),a("div",st,[a("h1",lt,v(n.value.title),1),a("div",nt,[a("button",{class:"event-action",type:"button",onClick:xe},[...t[3]||(t[3]=[a("span",{class:"i-lucide-share-2"},null,-1),P(" 共有する ",-1)])]),a("button",{class:T(["event-action",{"is-active":pe.value}]),type:"button",onClick:Se},[...t[4]||(t[4]=[a("span",{class:"i-lucide-bookmark"},null,-1),P(" お気に入り ",-1)])],2)])])]),S.value.length>1?(i(),o("div",ot,[(i(!0),o(y,null,b(S.value,l=>(i(),o("button",{key:l.id,class:T(["m-chip",{"is-active":l.id===C.value}]),onClick:c=>C.value=l.id},v(l.label),11,it))),128))])):h("",!0),a("section",rt,[a("div",ut,[a("div",ct,[t[6]||(t[6]=a("div",{class:"event-meta-icon"},[a("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none"},[a("rect",{x:"3",y:"4",width:"18",height:"17",rx:"3",stroke:"currentColor","stroke-width":"1.5"}),a("path",{d:"M3 9h18M8 2v4M16 2v4",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round"})])],-1)),a("div",vt,[a("p",dt,v(((r=K.value)==null?void 0:r.label)??n.value.timeFullText),1),a("p",mt,v(((d=K.value)==null?void 0:d.meta)??n.value.timeFullText),1)]),_e.value?(i(),o("span",pt,"複数日程")):h("",!0)]),O.value?(i(),o("button",{key:0,class:"event-schedule__cta",type:"button",onClick:Me},[...t[7]||(t[7]=[a("span",{class:"i-lucide-calendar-plus"},null,-1),P(" カレンダーに追加 ",-1)])])):h("",!0)]),t[10]||(t[10]=a("div",{class:"m-divider"},null,-1)),a("div",ht,[t[9]||(t[9]=de('<div class="event-meta-icon" data-v-23d08461><svg width="20" height="20" viewBox="0 0 24 24" fill="none" data-v-23d08461><path d="M12 21c4.418 0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7 3.582 7 8 7z" stroke="currentColor" stroke-width="1.5" data-v-23d08461></path><path d="M12 11v6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" data-v-23d08461></path><path d="M7 3h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" data-v-23d08461></path></svg></div>',1)),a("div",gt,[a("div",ft,v(n.value.locationText),1)]),a("button",{class:"event-map-button",type:"button",onClick:Le},[...t[8]||(t[8]=[a("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true"},[a("path",{d:"M12 21c4.418 0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7 3.582 7 8 7z",stroke:"currentColor","stroke-width":"1.5"}),a("path",{d:"M12 11v6",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round"}),a("path",{d:"M7 3h10",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round"})],-1),P(" ルートを見る ",-1)])])])]),ye.value?(i(),o("section",_t,[t[11]||(t[11]=a("h2",{class:"m-section-title"},"参加状況",-1)),a("div",yt,[a("div",kt,[a("span",null,v(n.value.regSummary),1),a("span",null,v(n.value.capacityText),1)]),a("div",wt,[a("div",{class:"event-progress__bar",style:me({width:`${n.value.regProgress}%`})},null,4)]),w.value.length?(i(),o("div",bt,[a("div",Tt,[(i(!0),o(y,null,b(w.value,l=>(i(),o("button",{key:l.id||l.name,class:"participant-avatar",type:"button",onClick:W},[l.avatarUrl?(i(),o("img",{key:0,src:l.avatarUrl,alt:l.name},null,8,Ct)):(i(),o("span",xt,v(Q(l.name)),1)),a("span",St,v(l.name),1)]))),128)),ke.value?(i(),o("button",{key:0,class:"participant-more",type:"button",onClick:W}," +"+v(we.value),1)):h("",!0)]),a("p",$t,"最近の参加者（"+v(be.value)+"）",1)])):(i(),o("p",Ut,"表示できる参加者がまだいません。"))])])):h("",!0),a("section",Dt,[t[15]||(t[15]=a("h2",{class:"m-section-title"},"主催コミュニティ",-1)),a("div",Mt,[a("div",Pt,[a("button",{class:"group-info",type:"button",onClick:Ie,disabled:!n.value.communitySlug},[t[13]||(t[13]=a("div",{class:"group-avatar"},null,-1)),a("div",Lt,[a("div",Ft,v(n.value.hostName),1),t[12]||(t[12]=a("div",{class:"m-text-meta"},"最新ニュースとイベント情報",-1))])],8,It),a("button",{class:T(["group-follow",{"is-active":$.value}]),type:"button",onClick:Pe},[$.value?(i(),o("span",Et)):(i(),o("span",Rt)),P(" "+v($.value?"フォロー中":"フォロー"),1)],2)]),t[14]||(t[14]=a("p",{class:"group-hint"},"このコミュニティをフォローすると最新イベントやアナウンスを受け取れます。",-1))])]),a("section",At,[t[16]||(t[16]=a("h2",{class:"m-section-title"},"About",-1)),a("div",Bt,[a("div",{class:"m-text-body prose prose-sm max-w-none",innerHTML:n.value.descriptionHtml},null,8,Nt)])]),q.value.length?(i(),o("section",jt,[t[17]||(t[17]=a("h2",{class:"m-section-title"},"申込時の必須情報",-1)),a("div",zt,[a("ul",Ht,[(i(!0),o(y,null,b(q.value,(l,c)=>(i(),o("li",{key:Ee(l,c)},"・"+v(l.label),1))),128))])])])):h("",!0)]),a("footer",Jt,[a("div",Ot,[a("p",Vt,v(n.value.priceText),1)]),a("button",{class:"rails-cta",type:"button",disabled:ge.value,onClick:Fe},[a("span",null,v(he.value),1)],8,qt)])],64)):h("",!0),j.value?(i(),o("div",{key:3,class:"fixed inset-0 z-40 flex items-center justify-center bg-black/50",onClick:He(X,["self"])},[a("div",Gt,[a("div",{class:"mb-3 flex items-center justify-between"},[t[19]||(t[19]=a("h3",{class:"text-base font-semibold"},"参加者一覧",-1)),a("button",{class:"participant-close",type:"button",onClick:X},[...t[18]||(t[18]=[a("span",{class:"i-lucide-x text-lg"},null,-1)])])]),a("ul",Kt,[(i(!0),o(y,null,b(k.value,l=>(i(),o("li",{key:l.id||l.name,class:"participant-list__item"},[a("div",Yt,[l.avatarUrl?(i(),o("img",{key:0,src:l.avatarUrl,alt:l.name},null,8,Zt)):(i(),o("span",Qt,v(Q(l.name)),1))]),a("div",Wt,v(l.name||"ゲスト"),1)]))),128))])])])):h("",!0)])}}}),sa=qe(Xt,[["__scopeId","data-v-23d08461"]]);export{sa as default};
