import{d as Y,l as Z,c as f,r as y,a as i,e,h as B,q as E,t as b,j as $,n as j,u as G,y as H,P as K,b as u,_ as ee}from"./index-BPws346P.js";const ae={class:"mobile-me m-page"},se={class:"me-hero"},te=["disabled"],ne={key:0,class:"me-hero__avatar-spinner"},re=["src"],oe={key:2},le={class:"me-hero__info"},ce={class:"me-hero__subtitle"},ie={class:"me-hero__chips"},ue={key:0,class:"chip chip--success"},de={key:1,class:"chip chip--ghost"},pe=200*1024,me=Y({__name:"MobileMe",setup(_e){const o=G(),F=H(),{user:l,setUserProfile:P}=Z(),w=f(()=>!!l.value),U=f(()=>{var s;return!!((s=l.value)!=null&&s.isOrganizer)}),z=f(()=>{var s,a,t;return((t=(a=(s=l.value)==null?void 0:s.name)==null?void 0:a.charAt(0))==null?void 0:t.toUpperCase())??"M"}),T=f(()=>{var a;switch(((a=l.value)==null?void 0:a.language)??"ja"){case"zh":return"中文 / Chinese";case"en":return"English";default:return"日本語 / Japanese"}}),q=()=>{o.push({name:"my-events"})},L=()=>{o.push({name:"my-payments"})},V=()=>{o.push({name:"favorites"})},D=()=>{o.push({name:"MobileSettings"})},N=()=>{w.value?o.push({path:"/me"}):o.push({name:"organizer-apply"})},I=y(null),h=y(!1),d=y(""),k=y("success"),O=()=>{var s;if(!w.value){o.push({name:"organizer-apply",query:{redirect:F.fullPath}});return}d.value="",(s=I.value)==null||s.click()},R=s=>new Promise((a,t)=>{const r=new FileReader;r.onload=()=>{const n=new Image;n.onload=()=>{const p=Math.min(n.width,n.height),X=(n.width-p)/2,J=(n.height-p)/2,S=m=>{const _=document.createElement("canvas");_.width=m,_.height=m;const c=_.getContext("2d");return c?(c.drawImage(n,X,J,p,p,0,0,m,m),_):null};(m=>new Promise((_,c)=>{let v=m,g=S(v);if(!g){c(new Error("Failed to init canvas"));return}const x=[.9,.8,.7,.6,.5,.4],C=A=>{if(!g){c(new Error("Failed to init canvas"));return}if(A>=x.length){if(v<=256){c(new Error("画像を圧縮できませんでした"));return}v=Math.floor(v*.85),g=S(v),C(0);return}g.toBlob(M=>{if(!M){c(new Error("画像変換に失敗しました"));return}if(M.size<=pe){const Q=new File([M],`avatar-${Date.now()}.jpg`,{type:"image/jpeg"});_(Q)}else C(A+1)},"image/jpeg",x[A])};C(0)}))(512).then(a).catch(t)},n.onerror=()=>t(new Error("画像の読み込みに失敗しました")),n.src=r.result},r.onerror=()=>t(new Error("画像を読み込めませんでした")),r.readAsDataURL(s)}),W=async s=>{var r;const a=s.target,t=(r=a.files)==null?void 0:r[0];if(t){h.value=!0,d.value="";try{const n=await R(t),p=await K(n);P(p),d.value="プロフィール写真を更新しました",k.value="success"}catch(n){console.error("Failed to upload avatar",n),d.value="写真の更新に失敗しました",k.value="error"}finally{h.value=!1,a&&(a.value="")}}};return(s,a)=>{var t,r;return u(),i("div",ae,[e("section",se,[e("button",{class:"me-hero__avatar",type:"button",onClick:O,disabled:h.value},[h.value?(u(),i("div",ne)):B("",!0),(t=E(l))!=null&&t.avatarUrl?(u(),i("img",{key:1,src:E(l).avatarUrl,alt:"user"},null,8,re)):(u(),i("span",oe,b(z.value),1))],8,te),e("input",{ref_key:"avatarInput",ref:I,type:"file",accept:"image/*",class:"sr-only",onChange:W},null,544),e("div",le,[e("p",ce,b(w.value?T.value:"ようこそ"),1),e("button",{class:"me-hero__title",type:"button",onClick:N},b(((r=E(l))==null?void 0:r.name)||"ゲスト"),1),e("div",ie,[U.value?(u(),i("span",ue,[...a[0]||(a[0]=[e("span",{class:"i-lucide-badge-check mr-1"},null,-1),$("主理人 ",-1)])])):(u(),i("span",de,"ゲスト"))]),d.value?(u(),i("p",{key:0,class:j(["me-hero__status",k.value==="error"?"is-error":""])},b(d.value),3)):B("",!0)])]),a[5]||(a[5]=e("section",{class:"m-section-title"},"マイサービス",-1)),e("div",{class:"me-grid"},[e("button",{class:"me-card",onClick:q},[...a[1]||(a[1]=[e("span",{class:"me-card__icon i-lucide-calendar-check"},null,-1),e("span",{class:"me-card__label"},"参加したイベント",-1),e("span",{class:"me-card__meta"},"予約・チケット",-1)])]),e("button",{class:"me-card",onClick:L},[...a[2]||(a[2]=[e("span",{class:"me-card__icon i-lucide-credit-card"},null,-1),e("span",{class:"me-card__label"},"支払い履歴",-1),e("span",{class:"me-card__meta"},"お支払い記録",-1)])]),e("button",{class:"me-card",onClick:V},[...a[3]||(a[3]=[e("span",{class:"me-card__icon i-lucide-heart"},null,-1),e("span",{class:"me-card__label"},"お気に入りイベント",-1),e("span",{class:"me-card__meta"},"お気に入り",-1)])]),e("button",{class:"me-card",onClick:D},[...a[4]||(a[4]=[e("span",{class:"me-card__icon i-lucide-settings-2"},null,-1),e("span",{class:"me-card__label"},"設定",-1),e("span",{class:"me-card__meta"},"アプリ環境",-1)])])])])}}}),ge=ee(me,[["__scopeId","data-v-141d195e"]]);export{ge as default};
