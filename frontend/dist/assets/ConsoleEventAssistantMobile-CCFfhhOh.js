import{ae as ge,d as me,a7 as ke,c as g,B as we,r as v,C as be,D as it,o as _e,a1 as Se,e as l,A as qt,i,q as Ce,j as c,t as o,k as T,w as Ft,F as _,h as S,x as zt,y as Te,af as $e,n as Pe,v as Ae,a2 as Ie,a3 as xe,a9 as Ee,g as Le,ag as Ne,ah as De,ai as Re,aj as Oe,ak as Mt,u as qe,a5 as Fe,f as n,z as nt,al as ze,_ as Me}from"./index-D9GuT0xz.js";import{P as je}from"./PageMarker-CiSmMvmB.js";const Bt=["title","description","startTime","locationText","ticketTypes","visibility","registrationFormSchema"],Ve=`${ge}

---
You are the SOCIALMORE Event Creation Assistant.
- Mission: understand the organizer's intention, encourage them when they hesitate, and then help them commit to clear written decisions.
- Persona: warm coach at first, precise editor later. Never turn the conversation into a rigid form.
- Languages: default to Japanese, but mirror the user's input language when possible.
- Process: Listen (感性) → Guide (構造化) → Write (草稿を提示) → Confirm (ユーザーに最終判断を委ねる).`,Be={coach:`Current stage: 感性モード (Coach).
Goals:
- Surface the organizer's motivation, people they want to help, and desired vibe.
- Translate vague wishes into tangible goals.
- Ask one focused question at a time; do not rush into fields or checklists.
Forbidden:
- Empty hype (e.g., "必ず成功します").
- Ignoring obvious fears or blockers the organizer mentions.`,editor:`Current stage: 理性モード (Editor).
Goals:
- Organize concrete decisions (title, time, location, ticketing, requirements).
- Offer options with pros/cons when the organizer hesitates.
- Highlight contradictions or risks (e.g., "想要開放但又限定費用很高").
Guidelines:
- Provide concise bullet structures or A/B drafts.
- Ask clarifying questions only for the missing fields listed below.`,writer:`Current stage: ライティング / 確認.
Goals:
- Summarize the EventDraft so the organizer can confirm or adjust.
- Clearly list every key field (title, schedule, ticketing, requirements, notes).
- Invite the organizer to edit specific parts instead of rewriting everything.
If something is still missing, politely mention it before presenting the summary.`},Je='Reply with:\n1) A short natural-language response following the current stage instructions.\n2) If you update the draft, append a JSON block using ```json ... ``` that contains { "type": "event_draft_update", "data": Partial<EventDraft> }.\nNever invent data that the organizer has not provided.';function Ue(a){if(!a)return"coach";const y=!!(typeof a.title=="string"&&a.title.trim()||a.purpose||a.description||a.category||a.targetAudience),A=Bt.every(k=>{const h=a[k];return h==null?!1:Array.isArray(h)?h.length>0:typeof h=="string"?h.trim().length>0:!0});return y?A?"writer":"editor":"coach"}function Ge(a){var A;if(!a)return"No draft data yet.";const y=[];if(a.title&&y.push(`Title: ${J(a.title)}`),a.subtitle&&y.push(`Subtitle: ${J(a.subtitle)}`),a.purpose&&y.push(`Purpose: ${J(a.purpose)}`),a.description&&y.push(`Description: ${J(a.description)}`),a.startTime&&y.push(`Start: ${a.startTime}`),a.endTime&&y.push(`End: ${a.endTime}`),a.locationText&&y.push(`Location: ${a.locationText}`),a.ticketTypes&&a.ticketTypes.length){const k=a.ticketTypes.map(h=>`${J(h.name)} ¥${h.price??0}`).join(", ");y.push(`Ticketing: ${k}`)}return a.requirements&&a.requirements.length&&y.push(`Requirements: ${a.requirements.map(k=>k.label).join(", ")}`),(A=a.config)!=null&&A.riskNoticeEnabled&&y.push("Risk notice is enabled."),y.length?y.join(`
`):"Draft exists but has no descriptive fields yet."}function J(a){return a==null?"":typeof a=="string"?a:typeof a=="object"&&"original"in a?String(a.original??""):JSON.stringify(a)}function Qe(a){if(!a)return"All fields missing.";const y=Bt.filter(A=>{const k=a[A];return k==null?!0:Array.isArray(k)?k.length===0:typeof k=="string"?k.trim().length===0:!1});return y.length?`Fields still missing: ${y.join(", ")}`:"Required fields are present."}function He(a){const y=a.explicitStage??Ue(a.draft),A=a.locale==="zh"?"回答は簡体字中文でもよいですが、ユーザーの入力言語に合わせてください。":a.locale==="en"?"Respond in English unless the organizer prefers Japanese.":"回答は日本語をベースに、ユーザーの言語に合わせてカスタマイズしてください。",k=[a.userName?`Organizer: ${a.userName}`:null,a.communityName?`Community: ${a.communityName}`:null,a.lastUserUtterance?`Latest user message: ${a.lastUserUtterance}`:null].filter(Boolean).join(`
`),h=[Ve,A,Be[y],`Draft context:
${Ge(a.draft)}`,Qe(a.draft),Je].concat(k?[`
Context:
${k}`]:[]).join(`

`);return{stage:y,prompt:h}}const Ke={class:"assistant-chat-surface"},We={class:"chat-tools"},Ye={class:"status-chip"},Ze={class:"mode-chip"},Xe={key:0,class:"prompt-chip"},ts={key:0,class:"assistant-guide"},es={class:"history-sheet"},ss={key:0,class:"history-empty"},is={key:1,class:"history-list"},ns=["onClick"],ls={class:"history-item-body"},as={class:"history-item-time"},os={key:2,class:"history-preview"},rs={class:"history-preview-summary"},us={key:0,class:"history-preview-desc"},cs={class:"history-preview-links"},ps={class:"history-preview-actions"},ds={key:0,class:"chat-text-block"},vs={class:"chat-text"},ys={key:1,class:"chat-options"},hs={class:"chat-options-question"},fs={key:0,class:"chat-options-note"},gs={key:2,class:"thinking-collapsible"},ms=["onClick"],ks={class:"thinking-toggle__action"},ws={class:"thinking-inline"},bs={class:"thinking-inline-index"},_s={class:"thinking-inline-text"},Ss={key:3,class:"coach-prompts"},Cs={key:4,class:"editor-checklist"},Ts={key:5,class:"writer-summary"},$s={class:"writer-summary-grid"},Ps={key:0},As={key:1},Is={key:2},xs={key:3},Es={key:4},Ls={key:0,class:"writer-confirm"},Ns=["onClick"],Ds={class:"proposal-title"},Rs={class:"proposal-desc"},Os={key:0,class:"proposal-hint"},qs={class:"chat-meta"},Fs={key:3,class:"thinking-banner"},zs={key:4,class:"assistant-error"},Ms={key:0,class:"final-plan-card"},js={class:"final-plan-header"},Vs={class:"final-plan-title"},Bs={key:0,class:"final-plan-section"},Js={class:"final-plan-text"},Us={class:"final-plan-grid"},Gs={key:0},Qs={class:"final-plan-text"},Hs={key:1},Ks={class:"final-plan-text"},Ws={key:1,class:"final-plan-section"},Ys={class:"final-plan-list"},Zs={key:2,class:"final-plan-section"},Xs={class:"final-plan-ticket-list"},ti={key:3,class:"final-plan-section"},ei={class:"final-plan-list"},si={key:4,class:"final-plan-section"},ii={class:"final-plan-list"},ni={class:"assistant-bottom"},li={class:"chat-input-row"},ai=["placeholder"],oi=["disabled"],ri={key:0,class:"final-plan-actions"},ui=["disabled"],ci={class:"plan-preview-panel"},pi={class:"plan-preview-head"},di={class:"plan-preview-title"},vi={class:"plan-preview-scroll"},yi={key:0,class:"plan-preview-section"},hi={class:"plan-preview-text"},fi={class:"plan-preview-grid"},gi={key:0},mi={class:"plan-preview-text"},ki={key:1},wi={class:"plan-preview-text"},bi={key:1,class:"plan-preview-section"},_i={class:"plan-preview-list"},Si={key:2,class:"plan-preview-section"},Ci={class:"plan-preview-ticket-list"},Ti={key:3,class:"plan-preview-section"},$i={class:"plan-preview-list"},Pi={key:4,class:"plan-preview-section"},Ai={class:"plan-preview-list"},jt="console-ai-assistant-history",Vt="console-ai-assistant-drafts",Ii=me({__name:"ConsoleEventAssistantMobile",setup(a){const y=we(),A=qe(),k=ke(),h=g(()=>y.params.communityId);g(()=>{const s=h.value;if(!s)return"";const t=k.communities.value.find(e=>e.id===s);return(t==null?void 0:t.name)??""});const U=v(null),j=v(!1),d=be({baseLanguage:"ja",topic:"",audience:"",style:"",details:""}),G=[{key:"topic",prompt:"どんなイベントを企画していますか？（例：親子BBQ、言語交換など）"},{key:"audience",prompt:"主な対象や届けたい人は誰ですか？"},{key:"style",prompt:"雰囲気やスタイルはどうしたいですか？（family-friendly / casual など）"},{key:"details",prompt:"場所・所要時間・持ち物など、補足したいことを自由にどうぞ。"}],$=v([]),lt=v(null),Y=v(0),Jt=g(()=>({"--keyboard-offset":`${Y.value}px`})),R=v(""),at=v(null),Q=v(!1),V=v(null),r=v(null),P=v(null),B=v(0),ot=v(!1),x=v([]),b=v(null),E=v(!1),H=v(!0),K=v(null),rt=v("collecting"),Z=v("coach-v2"),X=v("coach"),L=v(null),Ut={coach:"模式：Coach（点火）",editor:"模式：Editor（打灯）",writer:"模式：Writer（草稿确认）"},Gt=v(0),Qt=v("ja"),Ht=g(()=>{switch(rt.value){case"ready":return"方案已生成";case"options":return"候选提案";default:return"信息收集中"}}),O=v({baseLanguage:"zh",topic:"コミュニティイベント",audience:"地域の仲間",style:"family-friendly"}),ut=g(()=>{var s;for(let t=$.value.length-1;t>=0;t-=1){const e=$.value[t];if(e.role==="assistant"&&((s=e.coachPrompts)!=null&&s.length))return e.coachPrompts}return[]}),ct=v([]),pt=v([]),dt=(s,t)=>s?f(s.title)||t||"AI 提案":"",vt=s=>{const t=s==null?void 0:s.logistics;if(!t)return[];const e=[];return t.startTime&&e.push({label:"开始时间",value:formatDateTime(t.startTime)}),t.endTime&&e.push({label:"结束时间",value:formatDateTime(t.endTime)}),t.locationText&&e.push({label:"地点",value:t.locationText}),t.locationNote&&e.push({label:"地点备注",value:t.locationNote}),e},yt=s=>(s==null?void 0:s.ticketTypes)??[],ht=s=>(s==null?void 0:s.requirements)??[],ft=s=>(s==null?void 0:s.registrationForm)??[],Kt=g(()=>dt(r.value,d.topic)),gt=g(()=>vt(r.value)),mt=g(()=>yt(r.value)),kt=g(()=>ht(r.value)),wt=g(()=>ft(r.value)),Wt=g(()=>dt(P.value)),bt=g(()=>{var s;return f((s=P.value)==null?void 0:s.description)}),_t=g(()=>{var s;return f((s=P.value)==null?void 0:s.notes)}),St=g(()=>{var s;return f((s=P.value)==null?void 0:s.riskNotice)}),Ct=g(()=>vt(P.value)),Tt=g(()=>yt(P.value)),$t=g(()=>ht(P.value)),Pt=g(()=>ft(P.value)),At=s=>s==null?"免费":`¥${s.toLocaleString("ja-JP")}`,Yt=g(()=>({title:d.topic||"",description:d.details||d.topic,targetAudience:d.audience,vibe:d.style,locationText:d.details,ticketTypes:[],registrationFormSchema:[]})),Zt=g(()=>H.value),Xt=g(()=>L.value?L.value:ut.value.length?ut.value[0]:B.value>=G.length?"追加で伝えたいことや質問を入力してください":G[B.value].prompt);it(()=>h.value,()=>{j.value=!1,xt()}),it(()=>$.value.length,(s,t)=>{t===0&&s>0&&(H.value=!1)}),it(()=>E.value,s=>{s?b.value=x.value[0]??null:b.value=null});const It=()=>{Fe(()=>{const s=lt.value;s&&(s.scrollTop=s.scrollHeight)})},q=(s,t,e,p,m,F,I,z,M,D,u)=>{$.value.push({id:`${Date.now()}-${Math.random().toString(36).slice(2)}`,role:s,type:t,content:e,createdAt:new Date().toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"}),payload:p,action:m,options:F,thinkingSteps:I&&I.length?I:void 0,coachPrompts:z,editorChecklist:M,writerSummary:D,confirmQuestions:u}),$.value.length>200&&$.value.shift(),It()},xt=async()=>{if(!h.value){U.value=null,j.value=!1,await Et();return}try{U.value=await Ee(h.value)}catch(s){console.warn("Failed to load community detail",s),U.value=null}finally{j.value=!1,await Et()}},Et=async()=>{if(j.value)return;j.value=!0;const s=U.value,t=s!=null&&s.description?Le(s.description):"",e=(s==null?void 0:s.name)??"Tokyo Community Organizations Meetup Group",p=t?`コミュニティ紹介：${e}
${t}

上記の背景を踏まえて、主催者が最初のアイデアを話しやすいようCoachモードで歓迎し、最初の質問を投げかけてください。`:"コミュニティ紹介情報はありません。主催者を歓迎し、最初のアイデアを引き出す質問から始めてください。";await Nt(p,{overrideSummary:`コミュニティ紹介: ${e}`})},Lt=async(s="button")=>{var e;if(!R.value.trim()||Q.value)return;const t=R.value.trim();R.value="",s==="button"&&((e=at.value)==null||e.blur(),Y.value=0),q("user","text",t),await se(t)},te=s=>/[\u4e00-\u9fff]/.test(s)?"zh":/[a-zA-Z]/.test(s)?"en":"ja",ee=s=>{const t=te(s);t&&d.baseLanguage!==t&&(d.baseLanguage=t)},se=async s=>{ee(s);const t=G[B.value];t&&(d[t.key]=s),B.value<G.length-1&&(B.value+=1),L.value=null,await Nt(s)},Nt=async(s,t)=>{var D;V.value=null;const e=(t==null?void 0:t.overrideSummary)??Ot(s),{stage:p,prompt:m}=He({draft:Yt.value,locale:d.baseLanguage||"ja",lastUserUtterance:s});X.value=p;const F=ve(),I=`${e}

--- Conversation ---
${F}

--- Assistant Prompt ---
${m}`,z=ye(),M={baseLanguage:N(d.baseLanguage,"baseLanguage"),topic:N(d.topic,"topic"),audience:N(d.audience,"audience"),style:N(d.style,"style"),details:I,conversation:z};Q.value=!0;try{const u=await Ne(M),W=Array.isArray(u.thinkingSteps)?u.thinkingSteps:[];rt.value=u.status,Z.value=u.promptVersion,Gt.value=u.turnCount,Qt.value=u.language,u.stage&&["coach","editor","writer"].includes(u.stage)&&(X.value=u.stage),ct.value=u.editorChecklist??[],pt.value=u.confirmQuestions??[];const C=u.stage==="writer";q("assistant","text",u.message,void 0,void 0,u.options,W,u.coachPrompts,u.editorChecklist,C?u.writerSummary:void 0,u.confirmQuestions),L.value=((D=u.options)==null?void 0:D[0])??null;let w=null;if((u.status==="ready"||u.status==="options"||!!u.proposal)&&u.stage==="writer"){w={...u.proposal??await De({baseLanguage:d.baseLanguage||"ja",topic:d.topic||"コミュニティイベント",audience:d.audience||"地域の仲間",style:d.style||"family-friendly",details:e}),summary:e},r.value=w;const he=f(w.title),fe=f(w.description);q("assistant","proposal","",{title:he,description:fe,raw:r.value})}else r.value=null,L.value=null;await ie(p,e,{status:u.status,promptVersion:u.promptVersion,turnCount:u.turnCount,language:u.language,options:u.options??[],coachPrompts:u.coachPrompts??[],editorChecklist:u.editorChecklist??[],writerSummary:C?u.writerSummary??null:null}),w&&ne(w)}catch(u){V.value=u instanceof Error?u.message:"AI生成に失敗しました。少し時間を置いて再度お試しください。",q("assistant","text",V.value??"AI生成に失敗しました。")}finally{Q.value=!1,L.value||(L.value=null)}},ie=async(s,t,e)=>{if(h.value)try{ot.value=!0;const p=$.value.map(m=>({id:m.id,role:m.role,type:m.type,content:m.content,createdAt:m.createdAt,payload:m.payload?{title:m.payload.title??null,description:m.payload.description??null}:null}));await Re(h.value,{stage:s,summary:t,qaState:JSON.parse(JSON.stringify(d)),messages:p,aiResult:r.value?{title:r.value.title,description:r.value.description,notes:r.value.notes,riskNotice:r.value.riskNotice}:null,promptVersion:e==null?void 0:e.promptVersion,status:e==null?void 0:e.status,turnCount:e==null?void 0:e.turnCount,language:e==null?void 0:e.language,meta:{options:(e==null?void 0:e.options)??[],coachPrompts:(e==null?void 0:e.coachPrompts)??[],editorChecklist:(e==null?void 0:e.editorChecklist)??[],writerSummary:(e==null?void 0:e.writerSummary)??null}})}catch(p){console.warn("Failed to save assistant log",p)}finally{ot.value=!1}},ne=s=>{const t={id:`${Date.now()}-${Math.random().toString(36).slice(2)}`,createdAt:Date.now(),summary:s.summary,title:f(s.title),description:f(s.description),raw:s};x.value=[t,...x.value].slice(0,10),localStorage.setItem(jt,JSON.stringify(x.value))},le=()=>{const s=localStorage.getItem(jt);if(s)try{const t=JSON.parse(s);x.value=t}catch(t){console.warn("Failed to parse assistant history",t)}},ae=s=>{if(!s)return;const t=localStorage.getItem(Vt);let e=[];if(t)try{e=JSON.parse(t)}catch{e=[]}e=[{id:`${Date.now()}-${Math.random().toString(36).slice(2)}`,createdAt:Date.now(),summary:s.summary||"",title:f(s.title),description:f(s.description),raw:s},...e].slice(0,10),localStorage.setItem(Vt,JSON.stringify(e)),q("assistant","text","この案を草稿として保存しました。履歴からいつでも復元できます。")},oe=s=>{s&&(r.value={...s,summary:s.summary||Ot()},st(!0),E.value=!1,b.value=null)},re=s=>{b.value=s},ue=s=>{s&&(r.value={...s.raw,summary:s.summary},q("assistant","proposal","",{title:s.title,description:s.description,raw:r.value}),E.value=!1,b.value=null,It())},tt=()=>{E.value=!E.value,E.value||(b.value=null)},Dt=()=>{H.value=!H.value},ce=s=>{K.value=K.value===s?null:s},et=s=>{s&&(P.value=s)},Rt=()=>{P.value=null},pe=async()=>{try{const s=await Oe();O.value=s.defaults,Z.value=s.version,de()}catch(s){console.warn("Failed to load assistant defaults",s)}},de=()=>{d.baseLanguage||(d.baseLanguage=O.value.baseLanguage),d.topic||(d.topic=O.value.topic),d.audience||(d.audience=O.value.audience),d.style||(d.style=O.value.style)},Ot=s=>`AIの理解：対象は「${N(d.audience,"audience")}」、イベントは「${N(d.topic,"topic")}」、雰囲気は「${N(d.style,"style")}」。補足情報: ${s||d.details||"特記事項なし"}`,ve=()=>$.value.slice(-8).map(s=>{var p,m;const t=s.role==="user"?"User":"Assistant",e=s.type==="text"?s.content:`提案: ${((p=s.payload)==null?void 0:p.title)??""} ${((m=s.payload)==null?void 0:m.description)??""}`;return`${t}: ${e}`}).join(`
`),ye=()=>$.value.slice(-10).map(s=>{var t,e;return{role:s.role,content:s.type==="text"?s.content:`提案: ${((t=s.payload)==null?void 0:t.title)??""} ${((e=s.payload)==null?void 0:e.description)??""}`}}),N=(s,t)=>s&&s.trim()?s:O.value[t],f=s=>s?typeof s=="string"?s:typeof s=="object"&&s.original?s.original:"":"",st=s=>{h.value&&(s&&r.value?sessionStorage.setItem(Mt,JSON.stringify({title:f(r.value.title),subtitle:f(r.value.subtitle),description:f(r.value.description),notes:f(r.value.notes),riskNotice:f(r.value.riskNotice),logistics:r.value.logistics??null,ticketTypes:r.value.ticketTypes??[],requirements:r.value.requirements??[],registrationForm:r.value.registrationForm??[],visibility:r.value.visibility??"public",checklist:ct.value,confirmQuestions:pt.value,generatedAt:Date.now()})):sessionStorage.removeItem(Mt),window.alert("AI案をフォームに送信します。次の画面で各項目を確認してください。"),A.push({name:"ConsoleMobileEventForm",params:{communityId:h.value},query:{source:"ai-assistant"}}))};return _e(async()=>{if(await pe(),await k.loadCommunities(),h.value&&k.setActiveCommunity(h.value),le(),await xt(),typeof window<"u"&&window.visualViewport){const s=()=>{const t=window.visualViewport,e=window.innerHeight,p=Math.max(0,e-t.height-t.offsetTop);Y.value=p};window.visualViewport.addEventListener("resize",s),window.visualViewport.addEventListener("scroll",s),s(),Se(()=>{var t,e;(t=window.visualViewport)==null||t.removeEventListener("resize",s),(e=window.visualViewport)==null||e.removeEventListener("scroll",s)})}}),(s,t)=>(n(),l(_,null,[qt(je,{label:"P6"}),i("div",{class:"assistant-screen",style:Pe(Jt.value)},[i("section",Ke,[i("div",We,[i("span",Ye,o(Ht.value),1),i("span",Ze,o(Ut[X.value]),1),r.value?(n(),l("span",Xe,"Prompt "+o(Z.value),1)):c("",!0),i("button",{type:"button",class:"history-toggle",onClick:tt},[t[10]||(t[10]=i("span",{class:"i-lucide-clock-4"},null,-1)),T(" "+o(b.value?"收起历史":"会话历史"),1)])]),Zt.value?(n(),l("section",ts,[t[11]||(t[11]=i("p",{class:"guide-title"},"SOCIALMORE AI 使用说明",-1)),t[12]||(t[12]=i("ol",null,[i("li",null,[i("strong",null,"Speak"),T("：随便说出你的想法或需求。")]),i("li",null,[i("strong",null,"Guide"),T("：AI Coach/Editor 会提问，逐条回答即可。")]),i("li",null,[i("strong",null,"Write"),T("：完成提问后，AI 会生成方案，并可一键送表单或存草案。")])],-1)),$.value.length?(n(),l("button",{key:0,type:"button",class:"guide-dismiss",onClick:Dt}," 收起说明 ")):c("",!0)])):(n(),l("button",{key:1,type:"button",class:"guide-inline-toggle",onClick:Dt},[...t[13]||(t[13]=[i("span",{class:"i-lucide-info"},null,-1),T(" 查看使用说明 ",-1)])])),E.value?(n(),l("div",{key:2,class:"history-overlay",onClick:Ft(tt,["self"])},[i("section",es,[i("header",{class:"history-head"},[t[14]||(t[14]=i("div",null,[i("p",{class:"history-title"},"历史草案"),i("p",{class:"history-subtitle"},"最近 10 条保存的 AI 方案")],-1)),i("button",{type:"button",class:"history-close",onClick:tt},"关闭")]),x.value.length?(n(),l("div",is,[(n(!0),l(_,null,S(x.value,e=>{var p;return n(),l("article",{key:e.id,class:nt(["history-item",((p=b.value)==null?void 0:p.id)===e.id?"is-active":""]),onClick:m=>re(e)},[i("div",ls,[i("h4",null,o(e.title||"無題の案"),1),i("p",null,o(e.summary),1)]),i("span",as,o(new Date(e.createdAt).toLocaleString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})),1)],10,ns)}),128))])):(n(),l("div",ss,"まだ保存された履歴がありません")),b.value?(n(),l("div",os,[i("h4",null,o(b.value.title||"無題の案"),1),i("p",rs,o(b.value.summary||"暂无摘要"),1),b.value.description?(n(),l("p",us,o(b.value.description),1)):c("",!0),t[15]||(t[15]=i("p",{class:"history-preview-note"},"载入将把该草案插入当前对话；送到表单则直接打开活动编辑页并填入 AI 提案。",-1)),i("div",cs,[i("button",{type:"button",class:"history-preview-link",onClick:t[0]||(t[0]=e=>et(b.value.raw))}," 方案预览 ")]),i("div",ps,[i("button",{type:"button",class:"primary ghost",onClick:t[1]||(t[1]=e=>ue(b.value))}," 载入到对话 "),i("button",{type:"button",class:"primary gradient",onClick:t[2]||(t[2]=e=>oe(b.value.raw))}," 送到表单 ")])])):c("",!0)])])):c("",!0),i("div",{class:"chat-log",ref_key:"chatLogRef",ref:lt},[(n(!0),l(_,null,S($.value,e=>{var p,m,F,I,z,M,D,u,W;return n(),l("div",{key:e.id,class:nt(["chat-bubble",e.role==="user"?"chat-bubble--user":"chat-bubble--assistant"])},[e.type==="text"?(n(),l("div",ds,[i("p",vs,o(e.content),1),e.action==="direct-form"?(n(),l("button",{key:0,type:"button",class:"chat-inline-link",onClick:t[3]||(t[3]=C=>st(!1))}," 直接配置表单 ")):c("",!0),(p=e.options)!=null&&p.length?(n(),l("div",ys,[t[16]||(t[16]=i("p",{class:"chat-options-title"},"当前需要回答的核心问题",-1)),i("p",hs,o(e.options[0]),1),e.options.length>1?(n(),l("p",fs," 还有其他问题，将在你回答完这一条后继续提出。 ")):c("",!0)])):c("",!0),(m=e.thinkingSteps)!=null&&m.length?(n(),l("div",gs,[i("button",{type:"button",class:"thinking-toggle",onClick:C=>ce(e.id)},[t[17]||(t[17]=i("span",null,"AI 思考过程",-1)),i("span",ks,o(K.value===e.id?"收起":"展开"),1)],8,ms),zt(i("div",ws,[t[18]||(t[18]=i("p",{class:"thinking-inline-title"},"AI 思考过程",-1)),i("ol",null,[(n(!0),l(_,null,S(e.thinkingSteps,(C,w)=>(n(),l("li",{key:`${e.id}-thinking-${w}`},[i("span",bs,o(w+1),1),i("span",_s,o(C),1)]))),128))])],512),[[ze,K.value===e.id]])])):c("",!0),(F=e.coachPrompts)!=null&&F.length?(n(),l("div",Ss,[t[19]||(t[19]=i("p",{class:"coach-prompts-title"},"下一步灵感（Coach）",-1)),i("ol",null,[(n(!0),l(_,null,S(e.coachPrompts,(C,w)=>(n(),l("li",{key:`${e.id}-coach-${w}`},o(C),1))),128))])])):c("",!0),(I=e.editorChecklist)!=null&&I.length?(n(),l("div",Cs,[t[21]||(t[21]=i("p",{class:"editor-checklist-title"},"需要补充/确认（Editor）",-1)),i("ul",null,[(n(!0),l(_,null,S(e.editorChecklist,(C,w)=>(n(),l("li",{key:`${e.id}-editor-${w}`},[i("label",null,[t[20]||(t[20]=i("input",{type:"checkbox",disabled:""},null,-1)),i("span",null,o(C),1)])]))),128))])])):c("",!0),e.writerSummary?(n(),l("div",Ts,[t[28]||(t[28]=i("p",{class:"writer-summary-title"},"草稿摘要（Writer）",-1)),i("div",$s,[e.writerSummary.headline?(n(),l("p",Ps,[t[22]||(t[22]=i("strong",null,"标题",-1)),T(o(e.writerSummary.headline),1)])):c("",!0),e.writerSummary.audience?(n(),l("p",As,[t[23]||(t[23]=i("strong",null,"受众",-1)),T(o(e.writerSummary.audience),1)])):c("",!0),e.writerSummary.logistics?(n(),l("p",Is,[t[24]||(t[24]=i("strong",null,"细节",-1)),T(o(e.writerSummary.logistics),1)])):c("",!0),e.writerSummary.riskNotes?(n(),l("p",xs,[t[25]||(t[25]=i("strong",null,"风险",-1)),T(o(e.writerSummary.riskNotes),1)])):c("",!0),e.writerSummary.nextSteps?(n(),l("p",Es,[t[26]||(t[26]=i("strong",null,"下一步",-1)),T(o(e.writerSummary.nextSteps),1)])):c("",!0)]),(z=e.confirmQuestions)!=null&&z.length?(n(),l("div",Ls,[t[27]||(t[27]=i("p",{class:"writer-confirm-label"},"请确认：",-1)),i("ul",null,[(n(!0),l(_,null,S(e.confirmQuestions,(C,w)=>(n(),l("li",{key:`${e.id}-confirm-${w}`},o(C),1))),128))])])):c("",!0)])):c("",!0)])):(n(),l("div",{key:1,class:nt(["proposal-card",{"proposal-card--clickable":!!((M=e.payload)!=null&&M.raw)}]),onClick:C=>{var w;return((w=e.payload)==null?void 0:w.raw)&&et(e.payload.raw)}},[i("p",Ds,o((D=e.payload)==null?void 0:D.title),1),i("p",Rs,o((u=e.payload)==null?void 0:u.description),1),(W=e.payload)!=null&&W.raw?(n(),l("p",Os,"点击查看完整草案")):c("",!0)],10,Ns)),i("span",qs,o(e.createdAt),1)],2)}),128))],512),Q.value?(n(),l("div",Fs,[...t[29]||(t[29]=[i("span",{class:"thinking-spinner"},null,-1),i("p",null,"AI 正在思考...",-1)])])):c("",!0),V.value?(n(),l("div",zs,o(V.value),1)):c("",!0)]),r.value?(n(),l("section",Ms,[i("header",js,[i("div",null,[t[30]||(t[30]=i("p",{class:"final-plan-label"},"AI 活动方案",-1)),i("p",Vs,o(Kt.value),1)]),i("button",{type:"button",class:"plan-preview-link",onClick:t[4]||(t[4]=e=>et(r.value))},"方案预览")]),f(r.value.description)?(n(),l("div",Bs,[t[31]||(t[31]=i("p",{class:"final-plan-subtitle"},"活动亮点",-1)),i("p",Js,o(f(r.value.description)),1)])):c("",!0),i("div",Us,[r.value.notes&&f(r.value.notes)?(n(),l("article",Gs,[t[32]||(t[32]=i("p",{class:"final-plan-subtitle"},"备注/准备",-1)),i("p",Qs,o(f(r.value.notes)),1)])):c("",!0),r.value.riskNotice&&f(r.value.riskNotice)?(n(),l("article",Hs,[t[33]||(t[33]=i("p",{class:"final-plan-subtitle"},"风险提示",-1)),i("p",Ks,o(f(r.value.riskNotice)),1)])):c("",!0)]),gt.value.length?(n(),l("div",Ws,[t[34]||(t[34]=i("p",{class:"final-plan-subtitle"},"时间 & 地点",-1)),i("ul",Ys,[(n(!0),l(_,null,S(gt.value,e=>(n(),l("li",{key:`logistics-${e.label}`},[i("strong",null,o(e.label)+"：",1),T(o(e.value),1)]))),128))])])):c("",!0),mt.value.length?(n(),l("div",Zs,[t[35]||(t[35]=i("p",{class:"final-plan-subtitle"},"票务设置",-1)),i("ul",Xs,[(n(!0),l(_,null,S(mt.value,(e,p)=>(n(),l("li",{key:`ticket-${p}`,class:"final-plan-ticket"},[i("span",null,o(e.name),1),i("span",null,o(At(e.price)),1)]))),128))])])):c("",!0),kt.value.length?(n(),l("div",ti,[t[36]||(t[36]=i("p",{class:"final-plan-subtitle"},"参加要求",-1)),i("ul",ei,[(n(!0),l(_,null,S(kt.value,(e,p)=>(n(),l("li",{key:`req-${p}`},o(e.label)+o(e.type==="must"?"（必需）":""),1))),128))])])):c("",!0),wt.value.length?(n(),l("div",si,[t[37]||(t[37]=i("p",{class:"final-plan-subtitle"},"报名表字段",-1)),i("ul",ii,[(n(!0),l(_,null,S(wt.value,(e,p)=>(n(),l("li",{key:`form-${p}`},o(e.label)+" · "+o(e.type)+o(e.required?"（必填）":""),1))),128))])])):c("",!0)])):c("",!0),i("div",ni,[i("div",li,[zt(i("input",{ref_key:"chatInputRef",ref:at,"onUpdate:modelValue":t[5]||(t[5]=e=>R.value=e),class:"chat-input",type:"text",placeholder:Xt.value,onKeyup:t[6]||(t[6]=$e(e=>Lt("enter"),["enter"]))},null,40,ai),[[Te,R.value]]),t[39]||(t[39]=i("button",{class:"chat-voice",type:"button"},[i("span",{class:"chat-button-label"},"语音")],-1)),i("button",{class:"chat-send",type:"button",onClick:t[7]||(t[7]=e=>Lt("button")),disabled:!R.value.trim()},[...t[38]||(t[38]=[i("span",{class:"chat-button-label"},"发送",-1)])],8,oi)]),r.value?(n(),l("section",ri,[i("button",{class:"primary gradient",type:"button",disabled:!h.value,onClick:t[8]||(t[8]=e=>st(!0))}," 送到表单 ",8,ui),i("button",{class:"primary",type:"button",onClick:t[9]||(t[9]=e=>ae(r.value))},"保存草案")])):c("",!0)])],4),(n(),Ce(xe,{to:"body"},[qt(Ie,{name:"fade"},{default:Ae(()=>[P.value?(n(),l("div",{key:0,class:"plan-preview-overlay",onClick:Ft(Rt,["self"])},[i("section",ci,[i("header",pi,[i("div",null,[t[40]||(t[40]=i("p",{class:"plan-preview-label"},"AI 草案",-1)),i("p",di,o(Wt.value),1)]),i("button",{type:"button",class:"plan-preview-close",onClick:Rt},[...t[41]||(t[41]=[i("span",{class:"i-lucide-x"},null,-1)])])]),i("div",vi,[bt.value?(n(),l("article",yi,[t[42]||(t[42]=i("p",{class:"plan-preview-subtitle"},"活动亮点",-1)),i("p",hi,o(bt.value),1)])):c("",!0),i("div",fi,[_t.value?(n(),l("article",gi,[t[43]||(t[43]=i("p",{class:"plan-preview-subtitle"},"备注/准备",-1)),i("p",mi,o(_t.value),1)])):c("",!0),St.value?(n(),l("article",ki,[t[44]||(t[44]=i("p",{class:"plan-preview-subtitle"},"风险提示",-1)),i("p",wi,o(St.value),1)])):c("",!0)]),Ct.value.length?(n(),l("article",bi,[t[45]||(t[45]=i("p",{class:"plan-preview-subtitle"},"时间 & 地点",-1)),i("ul",_i,[(n(!0),l(_,null,S(Ct.value,e=>(n(),l("li",{key:`preview-logistics-${e.label}`},[i("strong",null,o(e.label)+"：",1),T(o(e.value),1)]))),128))])])):c("",!0),Tt.value.length?(n(),l("article",Si,[t[46]||(t[46]=i("p",{class:"plan-preview-subtitle"},"票务设置",-1)),i("ul",Ci,[(n(!0),l(_,null,S(Tt.value,(e,p)=>(n(),l("li",{key:`preview-ticket-${p}`},[i("span",null,o(e.name),1),i("span",null,o(At(e.price)),1)]))),128))])])):c("",!0),$t.value.length?(n(),l("article",Ti,[t[47]||(t[47]=i("p",{class:"plan-preview-subtitle"},"参加要求",-1)),i("ul",$i,[(n(!0),l(_,null,S($t.value,(e,p)=>(n(),l("li",{key:`preview-req-${p}`},o(e.label)+o(e.type==="must"?"（必需）":""),1))),128))])])):c("",!0),Pt.value.length?(n(),l("article",Pi,[t[48]||(t[48]=i("p",{class:"plan-preview-subtitle"},"报名表字段",-1)),i("ul",Ai,[(n(!0),l(_,null,S(Pt.value,(e,p)=>(n(),l("li",{key:`preview-form-${p}`},o(e.label)+" · "+o(e.type)+o(e.required?"（必填）":""),1))),128))])])):c("",!0)])])])):c("",!0)]),_:1})]))],64))}}),Di=Me(Ii,[["__scopeId","data-v-1f995ed6"]]);export{Di as default};
