import{d as O,l as V,r as l,c as A,z as $,a as i,e as t,h as m,i as w,v as _,x as C,t as o,P as D,Q as U,R as z,S as G,u as B,T as Z,b as r,_ as q}from"./index-X7Vbb3kp.js";const F={class:"login-page"},K={class:"login-card"},M=["disabled"],P={key:0,class:"error"},W={class:"login-card email-card"},Y={key:0,class:"error"},Q=["disabled"],j={key:0,class:"code-block"},H=["disabled"],J={key:1,class:"status"},X={key:2,class:"info"},ee=O({__name:"Login",setup(te){const f=V(),x=$(),S=B(),y=l(""),n=l(""),u=l(""),g=l(!1),b=l(!1),d=l(""),s=l(""),v=l(""),k=l(!1),E=l(!1),c=l(""),L=A(()=>{const a=x.query.redirect;return a&&a.startsWith("/")?a:"/"}),T=async a=>{const e=f.user.value;if(Z(e,a)){await S.replace({name:"auth-setup",query:{redirect:L.value||"/",mode:a}});return}await S.replace(L.value||"/")},I=async()=>{if(!y.value.trim()){c.value="请输入显示名称";return}c.value="",E.value=!0;try{await f.loginDev(y.value.trim()),await T("dev")}catch(a){c.value=a instanceof Error?a.message:"登录失败"}finally{E.value=!1}},N=()=>{if(typeof window>"u")return;window.localStorage.setItem(D,"line"),window.localStorage.setItem(U,L.value||"/");const e="http://192.168.0.149:3000/api/v1".replace(/\/$/,"").replace(/\/api\/v1$/,"");window.location.href=`${e}/api/v1/auth/line/redirect`},h=async()=>{if(!n.value.trim()){v.value="请输入邮箱地址";return}if(!/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/.test(n.value.trim())){v.value="邮箱格式不正确";return}v.value="",d.value="",s.value="",g.value=!0;try{await z(n.value.trim()),k.value=!0,d.value=`验证码已发送至 ${n.value.trim()}，请输入邮件中的 6 位数字。`,s.value=""}catch(a){s.value=a instanceof Error?a.message:"发送验证码失败"}finally{g.value=!1}},R=async()=>{if(!n.value.trim()||!u.value.trim()){s.value="请输入邮箱和验证码";return}if(!/^\d{6}$/.test(u.value.trim())){s.value="请输入 6 位数字验证码";return}b.value=!0,d.value="",s.value="";try{const a=await G(n.value.trim(),u.value.trim());f.setToken(a.accessToken),await f.fetchCurrentUser(),await T("email")}catch(a){s.value=a instanceof Error?a.message:"验证失败"}finally{b.value=!1}};return(a,e)=>(r(),i("div",F,[t("section",K,[e[4]||(e[4]=t("h2",null,"测试环境快捷登录",-1)),e[5]||(e[5]=t("p",null,"输入任意用户名即可体验完整流程。",-1)),t("label",null,[e[3]||(e[3]=w(" 显示名称 ",-1)),_(t("input",{"onUpdate:modelValue":e[0]||(e[0]=p=>y.value=p),type:"text",placeholder:"例如：MORE Test User"},null,512),[[C,y.value]])]),t("button",{type:"button",class:"primary",disabled:E.value,onClick:I},o(E.value?"登录中...":"一键体验"),9,M),c.value?(r(),i("p",P,o(c.value),1)):m("",!0)]),e[13]||(e[13]=t("div",{class:"divider"},[t("span",null,"或")],-1)),t("section",W,[e[8]||(e[8]=t("h2",null,"邮箱注册 / 登录",-1)),e[9]||(e[9]=t("p",null,"输入邮箱获取 6 位验证码，验证通过即可登录。",-1)),t("label",null,[e[6]||(e[6]=w(" 邮箱地址 ",-1)),_(t("input",{"onUpdate:modelValue":e[1]||(e[1]=p=>n.value=p),type:"email",placeholder:"test@example.com"},null,512),[[C,n.value]]),v.value?(r(),i("p",Y,o(v.value),1)):m("",!0)]),t("button",{type:"button",class:"primary",disabled:g.value,onClick:h},o(g.value?"发送中...":k.value?"重新发送":"发送验证码"),9,Q),k.value?(r(),i("div",j,[t("label",null,[e[7]||(e[7]=w(" 验证码 ",-1)),_(t("input",{"onUpdate:modelValue":e[2]||(e[2]=p=>u.value=p),type:"text",placeholder:"输入 6 位数字"},null,512),[[C,u.value]])]),t("button",{type:"button",class:"secondary",disabled:b.value,onClick:R},o(b.value?"验证中...":"确认登录"),9,H)])):m("",!0),s.value?(r(),i("p",J,o(s.value),1)):m("",!0),d.value?(r(),i("p",X,o(d.value),1)):m("",!0)]),t("section",{class:"login-card line-card"},[e[11]||(e[11]=t("h2",null,"使用 LINE 登录",-1)),e[12]||(e[12]=t("p",null,"推荐生产环境使用，完成 LINE 授权后自动登录。",-1)),t("button",{type:"button",class:"line-button",onClick:N},[...e[10]||(e[10]=[t("span",{class:"i-simple-icons-line"},null,-1),w(" LINE 登录 ",-1)])])])]))}}),le=q(ee,[["__scopeId","data-v-9823303f"]]);export{le as default};
