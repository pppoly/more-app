import{d as V,a7 as $,m as z,r as m,c as r,B as j,g as J,D as R,o as U,e as l,A as q,i as s,t as n,j as _,k as w,x as G,y as H,F as f,h as x,aa as K,u as O,f as u,z as T,_ as Q}from"./index-D9GuT0xz.js";import{P as W}from"./PageMarker-CiSmMvmB.js";const X={class:"events-page"},Y={class:"hero-card"},Z={class:"eyebrow"},ee={class:"hero-actions"},te={class:"filter-row"},se={class:"search-box"},ae={class:"segmented"},oe=["onClick"],le={class:"card-list"},ne=["onClick"],ue={class:"event-date"},ie={class:"event-title"},re={class:"event-meta"},ce={key:0,class:"empty"},de={key:1,class:"empty"},ve=V({__name:"ConsoleCommunityEventsMobile",setup(me){const E=j(),p=O(),C=$(),{user:M}=z(),b=m([]),d=m(!1),c=m("open"),L=[{value:"all",label:"すべて"},{value:"open",label:"受付中"},{value:"closed",label:"終了"}],i=m(""),o=r(()=>E.params.communityId),h=r(()=>{const e=C.communities.value.find(a=>a.id===o.value);return(e==null?void 0:e.name)??"未選択"}),D=r(()=>{var e;return!!((e=M.value)!=null&&e.isAdmin)}),S=r(()=>h.value?`${h.value} 的活动`:"社群活动"),v=r(()=>b.value.map(e=>({id:e.id,title:J(e.title),status:e.status,dateTimeText:I(e.startTime,e.endTime),entrySummary:e.visibility==="public"?"公開イベント":"限定公開"}))),g=r(()=>{const e=c.value==="all"?v.value:v.value.filter(t=>t.status===c.value),a=i.value?e.filter(t=>t.title.toLowerCase().includes(i.value.toLowerCase())):e;return c.value==="open"&&a.length===0?i.value?v.value.filter(t=>t.title.toLowerCase().includes(i.value.toLowerCase())):v.value:a}),k=async()=>{if(o.value){d.value=!0;try{b.value=await K(o.value)}catch(e){console.error("Failed to load community events",e)}finally{d.value=!1}}};R(()=>o.value,()=>{o.value&&k()});const B=e=>{p.push({name:"ConsoleMobileEventManage",params:{eventId:e}})},A=()=>{o.value&&p.push({name:"ConsoleMobileEventForm",params:{communityId:o.value}})},F=()=>{o.value&&p.push({name:"ConsoleMobileAssistantDashboard",params:{communityId:o.value}})},I=(e,a)=>{const t=new Date(e).toLocaleString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});if(!a)return t;const y=new Date(a).toLocaleString("ja-JP",{hour:"2-digit",minute:"2-digit"});return`${t}〜${y}`},N=e=>{switch(e){case"open":return"受付中";case"closed":return"終了";default:return"下書き"}},P=e=>{switch(e){case"open":return"pill open";case"closed":return"pill closed";default:return"pill draft"}};return U(async()=>{await C.loadCommunities(),o.value&&k()}),(e,a)=>(u(),l(f,null,[q(W,{label:"P4"}),s("div",X,[s("header",Y,[s("div",null,[s("p",Z,"社群 · "+n(h.value),1),s("h1",null,n(S.value),1),a[1]||(a[1]=s("p",{class:"sub"},"集中管理活动，随时创建和更新。",-1))]),s("div",ee,[s("button",{type:"button",class:"primary",onClick:A},[...a[2]||(a[2]=[s("span",{class:"i-lucide-plus mr-1"},null,-1),w(" 新建活动 ",-1)])]),D.value?(u(),l("button",{key:0,type:"button",class:"ghost",onClick:F},[...a[3]||(a[3]=[s("span",{class:"i-lucide-activity mr-1"},null,-1),w(" 助手仪表盘 ",-1)])])):_("",!0)])]),s("div",te,[s("div",se,[a[4]||(a[4]=s("span",{class:"i-lucide-search"},null,-1)),G(s("input",{"onUpdate:modelValue":a[0]||(a[0]=t=>i.value=t),type:"search",placeholder:"搜索活动名称"},null,512),[[H,i.value]])]),s("div",ae,[(u(),l(f,null,x(L,t=>s("button",{key:t.value,class:T(["seg-btn",{active:t.value===c.value}]),onClick:y=>c.value=t.value},n(t.label),11,oe)),64))])]),s("section",le,[(u(!0),l(f,null,x(g.value,t=>(u(),l("article",{key:t.id,class:"event-card",onClick:y=>B(t.id)},[s("div",{class:T(P(t.status))},n(N(t.status)),3),s("p",ue,n(t.dateTimeText),1),s("h3",ie,n(t.title),1),s("p",re,n(t.entrySummary),1)],8,ne))),128)),!g.value.length&&!d.value?(u(),l("div",ce," 还没有符合筛选的活动，去创建一个吧。 ")):_("",!0),d.value?(u(),l("div",de,"加载中...")):_("",!0)])])],64))}}),ye=Q(ve,[["__scopeId","data-v-469d90ae"]]);export{ye as default};
