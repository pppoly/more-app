import{d as K,u as Q,r as m,a as W,c as _,b as h,g as X,o as Y,e as r,f as n,F as b,h as k,i as o,t as c,j as Z,n as U,k as tt,w as et,l as at,_ as st}from"./index-D9GuT0xz.js";const ot={class:"mobile-events-page"},rt={key:0,class:"state-section"},nt={key:1,class:"state-section"},ct={class:"state-card state-card--error"},it={class:"state-card__body"},lt={class:"state-card__message"},ut=["disabled"],dt={key:2,class:"card-list"},mt={key:0,class:"state-empty"},_t=["onClick"],yt={class:"event-card__cover-meta"},gt={class:"event-card__avatar-stack"},pt=["src"],ft={class:"event-card__capacity-pill"},vt={class:"event-card__details"},ht={class:"event-card__title"},bt={class:"event-card__meta"},kt={class:"event-card__community-row"},Ct=["onClick"],At=["src"],Lt={key:1},xt={class:"event-card__community-name"},St=K({__name:"MobileEvents",setup(Tt){const C=Q(),y=m([]),g=m(!0),l=m(null),u=m(!1),A=async()=>{g.value=!0,l.value=null;try{y.value=await at()}catch(t){console.warn("fetchEvents failed",t),y.value=[],l.value="ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç’°å¢ƒã‚’ç¢ºèªã—ã¦å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚"}finally{g.value=!1}},V=async()=>{u.value=!0,await A(),u.value=!1},D=t=>{const a={parent:"è¦ªå­",sports:"ã‚¹ãƒãƒ¼ãƒ„",language:"èªžå­¦",work:"ã‚¹ã‚­ãƒ«",career:"ã‚­ãƒ£ãƒªã‚¢",kids:"ã‚­ãƒƒã‚º"},e=(t??"").toLowerCase();return a[e]??"ã‚¤ãƒ™ãƒ³ãƒˆ"},p=W(),{slotMap:f}=p,L=_(()=>{const t=p.getListValue("mobile.eventList.cardFallbacks");return t.length?t:f["mobile.eventList.cardFallbacks"].defaultValue??[]}),i=_(()=>p.getStringValue("global.defaultAvatar")||f["global.defaultAvatar"].defaultValue),F=(t,a)=>{let e=0;for(let s=0;s<t.length;s+=1)e=(e<<5)-e+t.charCodeAt(s),e|=0;return Math.abs(e)%a},z=t=>{var s;const a=L.value.length?L.value:f["mobile.eventList.cardFallbacks"].defaultValue??[];if(t.coverImageUrl)return{backgroundImage:`url(${h(t.coverImageUrl)})`,backgroundPosition:"center",backgroundSize:"cover"};const e=F(t.id||((s=t.title)==null?void 0:s.toString())||"fallback",a.length||1);return{backgroundImage:`url(${a[e]})`,backgroundPosition:"center",backgroundSize:"cover"}},N=_(()=>y.value.filter(t=>t.status==="open")),x=_(()=>N.value.map(t=>{var w,I,M,P,E,$;const a=z(t),e=S(t),s=T(t),d=s&&s>0?Math.min(100,Math.round(e/s*100)):null;return{id:t.id,title:X(t.title),categoryLabel:D(t.category),dateText:J(t.startTime),timeText:O(t.startTime),locationText:t.locationText,communityName:((w=t.community)==null?void 0:w.name)??"SOCIALMORE",communitySlug:((I=t.community)==null?void 0:I.slug)??((M=t.community)==null?void 0:M.id)??"club",communityLogo:t.communityLogoUrl?h(t.communityLogoUrl):null,communityInitial:(($=(E=(P=t.community)==null?void 0:P.name)==null?void 0:E.charAt(0))==null?void 0:$.toUpperCase())??"M",statusLabel:j(t.status),statusClass:q(t.status),capacityText:G(t),capacityPercent:d,hasCover:!!t.coverImageUrl,coverStyle:a,attendees:H(t)}})),B=t=>{C.push({name:"event-detail",params:{eventId:t}})},R=t=>{t&&C.push({name:"community-portal",params:{slug:t}})},j=t=>t==="open"?"å‚åŠ å‹Ÿé›†ä¸­":t==="closed"?"å—ä»˜çµ‚äº†":"å‘ŠçŸ¥äºˆå®š",q=t=>t==="open"?"event-card__status--open":t==="closed"?"event-card__status--closed":"event-card__status--info",J=t=>{const a=new Date(t);return`${(a.getMonth()+1).toString().padStart(2,"0")}/${a.getDate().toString().padStart(2,"0")}`},O=t=>new Date(t).toLocaleString("ja-JP",{month:"long",day:"numeric",weekday:"short",hour:"2-digit",minute:"2-digit"}),v=t=>t.config??{},S=t=>{const a=v(t);return typeof a.currentParticipants=="number"?a.currentParticipants:Array.isArray(a.participants)?a.participants.length:0},T=t=>{var e,s;const a=v(t);return typeof a.capacity=="number"?a.capacity:typeof t.maxParticipants=="number"?t.maxParticipants:Array.isArray(t.ticketTypes)&&((e=t.ticketTypes[0])==null?void 0:e.price)!==void 0?((s=t.ticketTypes[0])==null?void 0:s.quota)??null:null},G=t=>{const a=S(t),e=T(t);return e&&e>0?`${a}/${e}`:`${a}äººå‚åŠ ä¸­`},H=t=>{const a=v(t);let e=[];return Array.isArray(a.attendeeAvatars)&&a.attendeeAvatars.length?e=a.attendeeAvatars:Array.isArray(a.participants)&&(e=a.participants.map(s=>(s==null?void 0:s.avatarUrl)||i.value)),!e.length&&Array.isArray(a.attendeePreview)&&(e=a.attendeePreview.map(s=>(s==null?void 0:s.avatarUrl)||i.value)),e.length||(e=[i.value,i.value,i.value]),e.slice(0,5).map(s=>h(s||i.value))};return Y(A),(t,a)=>(n(),r("div",ot,[g.value?(n(),r("section",rt,[(n(),r(b,null,k(3,e=>o("article",{key:e,class:"event-card event-card--skeleton"})),64))])):l.value?(n(),r("section",nt,[o("article",ct,[a[1]||(a[1]=o("div",{class:"state-card__icon"},"ðŸš§",-1)),o("div",it,[a[0]||(a[0]=o("p",{class:"state-card__title"},"æ´»å‹•ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ",-1)),o("p",lt,c(l.value),1)]),o("button",{type:"button",class:"state-card__action",onClick:V,disabled:u.value},c(u.value?"ãƒªãƒˆãƒ©ã‚¤ä¸­â€¦":"å†èª­ã¿è¾¼ã¿"),9,ut)])])):(n(),r("section",dt,[x.value.length?Z("",!0):(n(),r("p",mt,"æ¡ä»¶ã«åˆã†ã‚¤ãƒ™ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚")),(n(!0),r(b,null,k(x.value,e=>(n(),r("article",{key:e.id,class:"event-card",onClick:s=>B(e.id)},[o("figure",{class:"event-card__cover",style:U(e.coverStyle)},[o("div",yt,[o("div",gt,[(n(!0),r(b,null,k(e.attendees,(s,d)=>(n(),r("img",{key:`${e.id}-attendee-${d}`,src:s,alt:"attendee avatar",style:U({zIndex:e.attendees.length-d})},null,12,pt))),128))]),o("span",ft,c(e.capacityText),1)])],4),o("div",vt,[o("h2",ht,c(e.title),1),o("p",bt,[a[2]||(a[2]=o("span",{class:"i-lucide-clock-8 text-xs"},null,-1)),tt(" "+c(e.timeText),1)]),o("div",kt,[o("button",{type:"button",class:"event-card__community-avatar",onClick:et(s=>R(e.communitySlug),["stop"])},[e.communityLogo?(n(),r("img",{key:0,src:e.communityLogo,alt:"community logo"},null,8,At)):(n(),r("span",Lt,c(e.communityInitial),1))],8,Ct),o("p",xt,c(e.communityName),1)])])],8,_t))),128))]))]))}}),It=st(St,[["__scopeId","data-v-e64f55dd"]]);export{It as default};
