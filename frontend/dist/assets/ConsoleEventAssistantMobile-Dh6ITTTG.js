import{ae as me,d as ke,a7 as we,af as be,c as f,B as _e,r as v,C as Se,D as nt,o as Ce,a1 as Te,e as l,A as Ft,i,q as $e,j as c,t as o,k as T,w as zt,F as b,h as _,z as lt,x as Mt,ag as Pe,y as Ae,ah as Ie,n as xe,v as Ee,a2 as Le,a3 as Ne,a9 as De,g as Re,ai as Oe,aj as qe,ak as Fe,al as ze,am as jt,u as Me,a5 as je,f as n,_ as Ve}from"./index-DncFUGrq.js";import{P as Be}from"./PageMarker-B9WMY3Nd.js";const Jt=["title","description","startTime","locationText","ticketTypes","visibility","registrationFormSchema"],Je=`${me}

---
You are the SOCIALMORE Event Creation Assistant.
- Mission: understand the organizer's intention, encourage them when they hesitate, and then help them commit to clear written decisions.
- Persona: warm coach at first, precise editor later. Never turn the conversation into a rigid form.
- Languages: default to Japanese, but mirror the user's input language when possible.
- Process: Listen (感性) → Guide (構造化) → Write (草稿を提示) → Confirm (ユーザーに最終判断を委ねる).`,Ue={coach:`Current stage: 感性モード (Coach).
Goals:
- Surface the organizer's motivation, people they want to help, and desired vibe.
- Translate vague wishes into tangible goals.
- Ask one focused question at a time; do not rush into fields or checklists.
Forbidden:
- Empty hype (e.g., "必ず成功します").
- Ignoring obvious fears or blockers the organizer mentions.`,editor:`Current stage: 理性モード (Editor).
Goals:
- Organize concrete decisions (title, time, location, ticketing, requirements).
- Offer options with pros/cons when the organizer hesitates.
- Highlight contradictions or risks (e.g., "想要開放但又限定費用很高").
Guidelines:
- Provide concise bullet structures or A/B drafts.
- Ask clarifying questions only for the missing fields listed below.`,writer:`Current stage: ライティング / 確認.
Goals:
- Summarize the EventDraft so the organizer can confirm or adjust.
- Clearly list every key field (title, schedule, ticketing, requirements, notes).
- Invite the organizer to edit specific parts instead of rewriting everything.
If something is still missing, politely mention it before presenting the summary.`},Ge='Reply with:\n1) A short natural-language response following the current stage instructions.\n2) If you update the draft, append a JSON block using ```json ... ``` that contains { "type": "event_draft_update", "data": Partial<EventDraft> }.\nNever invent data that the organizer has not provided.';function Qe(a){if(!a)return"coach";const y=!!(typeof a.title=="string"&&a.title.trim()||a.purpose||a.description||a.category||a.targetAudience),I=Jt.every(m=>{const C=a[m];return C==null?!1:Array.isArray(C)?C.length>0:typeof C=="string"?C.trim().length>0:!0});return y?I?"writer":"editor":"coach"}function He(a){var I;if(!a)return"No draft data yet.";const y=[];if(a.title&&y.push(`Title: ${U(a.title)}`),a.subtitle&&y.push(`Subtitle: ${U(a.subtitle)}`),a.purpose&&y.push(`Purpose: ${U(a.purpose)}`),a.description&&y.push(`Description: ${U(a.description)}`),a.startTime&&y.push(`Start: ${a.startTime}`),a.endTime&&y.push(`End: ${a.endTime}`),a.locationText&&y.push(`Location: ${a.locationText}`),a.ticketTypes&&a.ticketTypes.length){const m=a.ticketTypes.map(C=>`${U(C.name)} ¥${C.price??0}`).join(", ");y.push(`Ticketing: ${m}`)}return a.requirements&&a.requirements.length&&y.push(`Requirements: ${a.requirements.map(m=>m.label).join(", ")}`),(I=a.config)!=null&&I.riskNoticeEnabled&&y.push("Risk notice is enabled."),y.length?y.join(`
`):"Draft exists but has no descriptive fields yet."}function U(a){return a==null?"":typeof a=="string"?a:typeof a=="object"&&"original"in a?String(a.original??""):JSON.stringify(a)}function Ke(a){if(!a)return"All fields missing.";const y=Jt.filter(I=>{const m=a[I];return m==null?!0:Array.isArray(m)?m.length===0:typeof m=="string"?m.trim().length===0:!1});return y.length?`Fields still missing: ${y.join(", ")}`:"Required fields are present."}function We(a){const y=a.explicitStage??Qe(a.draft),I=a.locale==="zh"?"回答は簡体字中文でもよいですが、ユーザーの入力言語に合わせてください。":a.locale==="en"?"Respond in English unless the organizer prefers Japanese.":"回答は日本語をベースに、ユーザーの言語に合わせてカスタマイズしてください。",m=[a.userName?`Organizer: ${a.userName}`:null,a.communityName?`Community: ${a.communityName}`:null,a.lastUserUtterance?`Latest user message: ${a.lastUserUtterance}`:null].filter(Boolean).join(`
`),C=[Je,I,Ue[y],`Draft context:
${He(a.draft)}`,Ke(a.draft),Ge].concat(m?[`
Context:
${m}`]:[]).join(`

`);return{stage:y,prompt:C}}const Ye={class:"assistant-chat-surface"},Ze={class:"chat-tools"},Xe={class:"status-chip"},ts={class:"mode-chip"},es={key:0,class:"prompt-chip"},ss={key:0,class:"assistant-guide"},is={class:"history-sheet"},ns={key:0,class:"history-empty"},ls={key:1,class:"history-list"},as=["onClick"],os={class:"history-item-body"},rs={class:"history-item-time"},us={key:2,class:"history-preview"},cs={class:"history-preview-summary"},ps={key:0,class:"history-preview-desc"},ds={class:"history-preview-links"},vs={class:"history-preview-actions"},ys={key:0,class:"chat-text-block"},hs={class:"chat-text"},fs={key:1,class:"chat-options"},gs={class:"chat-options-question"},ms={key:0,class:"chat-options-note"},ks={key:2,class:"thinking-collapsible"},ws=["onClick"],bs={class:"thinking-toggle__action"},_s={class:"thinking-inline"},Ss={class:"thinking-inline-index"},Cs={class:"thinking-inline-text"},Ts={key:3,class:"coach-prompts"},$s={key:4,class:"editor-checklist"},Ps={key:5,class:"writer-summary"},As={class:"writer-summary-grid"},Is={key:0},xs={key:1},Es={key:2},Ls={key:3},Ns={key:4},Ds={key:0,class:"writer-confirm"},Rs=["onClick"],Os={class:"proposal-title"},qs={class:"proposal-desc"},Fs={key:0,class:"proposal-hint"},zs={class:"chat-meta"},Ms={key:3,class:"thinking-banner"},js={key:4,class:"assistant-error"},Vs={key:0,class:"final-plan-card"},Bs={class:"final-plan-header"},Js={class:"final-plan-title"},Us={key:0,class:"final-plan-section"},Gs={class:"final-plan-text"},Qs={class:"final-plan-grid"},Hs={key:0},Ks={class:"final-plan-text"},Ws={key:1},Ys={class:"final-plan-text"},Zs={key:1,class:"final-plan-section"},Xs={class:"final-plan-list"},ti={key:2,class:"final-plan-section"},ei={class:"final-plan-ticket-list"},si={key:3,class:"final-plan-section"},ii={class:"final-plan-list"},ni={key:4,class:"final-plan-section"},li={class:"final-plan-list"},ai={class:"assistant-bottom"},oi={class:"chat-input-row"},ri=["placeholder"],ui=["disabled"],ci={key:0,class:"final-plan-actions"},pi=["disabled"],di={class:"plan-preview-panel"},vi={class:"plan-preview-head"},yi={class:"plan-preview-title"},hi={class:"plan-preview-scroll"},fi={key:0,class:"plan-preview-section"},gi={class:"plan-preview-text"},mi={class:"plan-preview-grid"},ki={key:0},wi={class:"plan-preview-text"},bi={key:1},_i={class:"plan-preview-text"},Si={key:1,class:"plan-preview-section"},Ci={class:"plan-preview-list"},Ti={key:2,class:"plan-preview-section"},$i={class:"plan-preview-ticket-list"},Pi={key:3,class:"plan-preview-section"},Ai={class:"plan-preview-list"},Ii={key:4,class:"plan-preview-section"},xi={class:"plan-preview-list"},Vt="console-ai-assistant-history",Bt="console-ai-assistant-drafts",Ei=ke({__name:"ConsoleEventAssistantMobile",setup(a){const y=_e(),I=Me(),m=we(),C=be(),$=f(()=>y.params.communityId);f(()=>{const s=$.value;if(!s)return"";const t=m.communities.value.find(e=>e.id===s);return(t==null?void 0:t.name)??""});const G=v(null),V=v(!1),d=Se({baseLanguage:"ja",topic:"",audience:"",style:"",details:""}),Q=[{key:"topic",prompt:"どんなイベントを企画していますか？（例：親子BBQ、言語交換など）"},{key:"audience",prompt:"主な対象や届けたい人は誰ですか？"},{key:"style",prompt:"雰囲気やスタイルはどうしたいですか？（family-friendly / casual など）"},{key:"details",prompt:"場所・所要時間・持ち物など、補足したいことを自由にどうぞ。"}],P=v([]),at=v(null),Z=v(0),Ut=f(()=>({"--keyboard-offset":`${Z.value}px`})),O=v(""),ot=v(null),H=v(!1),B=v(null),r=v(null),A=v(null),J=v(0),rt=v(!1),E=v([]),w=v(null),L=v(!1),K=v(!0),W=v(null),ut=v("collecting"),X=v("coach-v2"),tt=v("coach"),N=v(null),Gt={coach:"模式：Coach（点火）",editor:"模式：Editor（打灯）",writer:"模式：Writer（草稿确认）"},Qt=v(0),Ht=v("ja"),Kt=f(()=>{switch(ut.value){case"ready":return"方案已生成";case"options":return"候选提案";default:return"信息收集中"}}),q=v({baseLanguage:"zh",topic:"コミュニティイベント",audience:"地域の仲間",style:"family-friendly"}),ct=f(()=>{var s;for(let t=P.value.length-1;t>=0;t-=1){const e=P.value[t];if(e.role==="assistant"&&((s=e.coachPrompts)!=null&&s.length))return e.coachPrompts}return[]}),pt=v([]),dt=v([]),vt=(s,t)=>s?h(s.title)||t||"AI 提案":"",yt=s=>{const t=s==null?void 0:s.logistics;if(!t)return[];const e=[];return t.startTime&&e.push({label:"开始时间",value:formatDateTime(t.startTime)}),t.endTime&&e.push({label:"结束时间",value:formatDateTime(t.endTime)}),t.locationText&&e.push({label:"地点",value:t.locationText}),t.locationNote&&e.push({label:"地点备注",value:t.locationNote}),e},ht=s=>(s==null?void 0:s.ticketTypes)??[],ft=s=>(s==null?void 0:s.requirements)??[],gt=s=>(s==null?void 0:s.registrationForm)??[],Wt=f(()=>vt(r.value,d.topic)),mt=f(()=>yt(r.value)),kt=f(()=>ht(r.value)),wt=f(()=>ft(r.value)),bt=f(()=>gt(r.value)),Yt=f(()=>vt(A.value)),_t=f(()=>{var s;return h((s=A.value)==null?void 0:s.description)}),St=f(()=>{var s;return h((s=A.value)==null?void 0:s.notes)}),Ct=f(()=>{var s;return h((s=A.value)==null?void 0:s.riskNotice)}),Tt=f(()=>yt(A.value)),$t=f(()=>ht(A.value)),Pt=f(()=>ft(A.value)),At=f(()=>gt(A.value)),It=s=>s==null?"免费":`¥${s.toLocaleString("ja-JP")}`,Zt=f(()=>({title:d.topic||"",description:d.details||d.topic,targetAudience:d.audience,vibe:d.style,locationText:d.details,ticketTypes:[],registrationFormSchema:[]})),Xt=f(()=>K.value),te=f(()=>N.value?N.value:ct.value.length?ct.value[0]:J.value>=Q.length?"追加で伝えたいことや質問を入力してください":Q[J.value].prompt);nt(()=>$.value,()=>{V.value=!1,Et()}),nt(()=>P.value.length,(s,t)=>{t===0&&s>0&&(K.value=!1)}),nt(()=>L.value,s=>{s?w.value=E.value[0]??null:w.value=null});const xt=()=>{je(()=>{const s=at.value;s&&(s.scrollTop=s.scrollHeight)})},F=(s,t,e,p,g,z,x,M,j,R,u)=>{P.value.push({id:`${Date.now()}-${Math.random().toString(36).slice(2)}`,role:s,type:t,content:e,createdAt:new Date().toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"}),payload:p,action:g,options:z,thinkingSteps:x&&x.length?x:void 0,coachPrompts:M,editorChecklist:j,writerSummary:R,confirmQuestions:u}),P.value.length>200&&P.value.shift(),xt()},Et=async()=>{if(!$.value){G.value=null,V.value=!1,await Lt();return}try{G.value=await De($.value)}catch(s){console.warn("Failed to load community detail",s),G.value=null}finally{V.value=!1,await Lt()}},Lt=async()=>{if(V.value)return;V.value=!0;const s=G.value,t=s!=null&&s.description?Re(s.description):"",e=(s==null?void 0:s.name)??"Tokyo Community Organizations Meetup Group",p=t?`コミュニティ紹介：${e}
${t}

上記の背景を踏まえて、主催者が最初のアイデアを話しやすいようCoachモードで歓迎し、最初の質問を投げかけてください。`:"コミュニティ紹介情報はありません。主催者を歓迎し、最初のアイデアを引き出す質問から始めてください。";await Dt(p,{overrideSummary:`コミュニティ紹介: ${e}`})},Nt=async(s="button")=>{var e;if(!O.value.trim()||H.value)return;const t=O.value.trim();O.value="",s==="button"&&((e=ot.value)==null||e.blur(),Z.value=0),F("user","text",t),await ie(t)},ee=s=>/[\u4e00-\u9fff]/.test(s)?"zh":/[a-zA-Z]/.test(s)?"en":"ja",se=s=>{const t=ee(s);t&&d.baseLanguage!==t&&(d.baseLanguage=t)},ie=async s=>{se(s);const t=Q[J.value];t&&(d[t.key]=s),J.value<Q.length-1&&(J.value+=1),N.value=null,await Dt(s)},Dt=async(s,t)=>{var R;B.value=null;const e=(t==null?void 0:t.overrideSummary)??qt(s),{stage:p,prompt:g}=We({draft:Zt.value,locale:d.baseLanguage||"ja",lastUserUtterance:s});tt.value=p;const z=ye(),x=`${e}

--- Conversation ---
${z}

--- Assistant Prompt ---
${g}`,M=he(),j={baseLanguage:D(d.baseLanguage,"baseLanguage"),topic:D(d.topic,"topic"),audience:D(d.audience,"audience"),style:D(d.style,"style"),details:x,conversation:M};H.value=!0;try{const u=await Oe(j),Y=Array.isArray(u.thinkingSteps)?u.thinkingSteps:[];ut.value=u.status,X.value=u.promptVersion,Qt.value=u.turnCount,Ht.value=u.language,u.stage&&["coach","editor","writer"].includes(u.stage)&&(tt.value=u.stage),pt.value=u.editorChecklist??[],dt.value=u.confirmQuestions??[];const S=u.stage==="writer";F("assistant","text",u.message,void 0,void 0,u.options,Y,u.coachPrompts,u.editorChecklist,S?u.writerSummary:void 0,u.confirmQuestions),N.value=((R=u.options)==null?void 0:R[0])??null;let k=null;if((u.status==="ready"||u.status==="options"||!!u.proposal)&&u.stage==="writer"){k={...u.proposal??await qe({baseLanguage:d.baseLanguage||"ja",topic:d.topic||"コミュニティイベント",audience:d.audience||"地域の仲間",style:d.style||"family-friendly",details:e}),summary:e},r.value=k;const fe=h(k.title),ge=h(k.description);F("assistant","proposal","",{title:fe,description:ge,raw:r.value})}else r.value=null,N.value=null;await ne(p,e,{status:u.status,promptVersion:u.promptVersion,turnCount:u.turnCount,language:u.language,options:u.options??[],coachPrompts:u.coachPrompts??[],editorChecklist:u.editorChecklist??[],writerSummary:S?u.writerSummary??null:null}),k&&le(k)}catch(u){B.value=u instanceof Error?u.message:"AI生成に失敗しました。少し時間を置いて再度お試しください。",F("assistant","text",B.value??"AI生成に失敗しました。")}finally{H.value=!1,N.value||(N.value=null)}},ne=async(s,t,e)=>{if($.value)try{rt.value=!0;const p=P.value.map(g=>({id:g.id,role:g.role,type:g.type,content:g.content,createdAt:g.createdAt,payload:g.payload?{title:g.payload.title??null,description:g.payload.description??null}:null}));await Fe($.value,{stage:s,summary:t,qaState:JSON.parse(JSON.stringify(d)),messages:p,aiResult:r.value?{title:r.value.title,description:r.value.description,notes:r.value.notes,riskNotice:r.value.riskNotice}:null,promptVersion:e==null?void 0:e.promptVersion,status:e==null?void 0:e.status,turnCount:e==null?void 0:e.turnCount,language:e==null?void 0:e.language,meta:{options:(e==null?void 0:e.options)??[],coachPrompts:(e==null?void 0:e.coachPrompts)??[],editorChecklist:(e==null?void 0:e.editorChecklist)??[],writerSummary:(e==null?void 0:e.writerSummary)??null}})}catch(p){console.warn("Failed to save assistant log",p)}finally{rt.value=!1}},le=s=>{const t={id:`${Date.now()}-${Math.random().toString(36).slice(2)}`,createdAt:Date.now(),summary:s.summary,title:h(s.title),description:h(s.description),raw:s};E.value=[t,...E.value].slice(0,10),localStorage.setItem(Vt,JSON.stringify(E.value))},ae=()=>{const s=localStorage.getItem(Vt);if(s)try{const t=JSON.parse(s);E.value=t}catch(t){console.warn("Failed to parse assistant history",t)}},oe=s=>{if(!s)return;const t=localStorage.getItem(Bt);let e=[];if(t)try{e=JSON.parse(t)}catch{e=[]}e=[{id:`${Date.now()}-${Math.random().toString(36).slice(2)}`,createdAt:Date.now(),summary:s.summary||"",title:h(s.title),description:h(s.description),raw:s},...e].slice(0,10),localStorage.setItem(Bt,JSON.stringify(e)),F("assistant","text","この案を草稿として保存しました。履歴からいつでも復元できます。")},re=s=>{s&&(r.value={...s,summary:s.summary||qt()},it(!0),L.value=!1,w.value=null)},ue=s=>{w.value=s},ce=s=>{s&&(r.value={...s.raw,summary:s.summary},F("assistant","proposal","",{title:s.title,description:s.description,raw:r.value}),L.value=!1,w.value=null,xt())},et=()=>{L.value=!L.value,L.value||(w.value=null)},Rt=()=>{K.value=!K.value},pe=s=>{W.value=W.value===s?null:s},st=s=>{s&&(A.value=s)},Ot=()=>{A.value=null},de=async()=>{try{const s=await ze();q.value=s.defaults,X.value=s.version,ve()}catch(s){console.warn("Failed to load assistant defaults",s)}},ve=()=>{d.baseLanguage||(d.baseLanguage=q.value.baseLanguage),d.topic||(d.topic=q.value.topic),d.audience||(d.audience=q.value.audience),d.style||(d.style=q.value.style)},qt=s=>`AIの理解：対象は「${D(d.audience,"audience")}」、イベントは「${D(d.topic,"topic")}」、雰囲気は「${D(d.style,"style")}」。補足情報: ${s||d.details||"特記事項なし"}`,ye=()=>P.value.slice(-8).map(s=>{var p,g;const t=s.role==="user"?"User":"Assistant",e=s.type==="text"?s.content:`提案: ${((p=s.payload)==null?void 0:p.title)??""} ${((g=s.payload)==null?void 0:g.description)??""}`;return`${t}: ${e}`}).join(`
`),he=()=>P.value.slice(-10).map(s=>{var t,e;return{role:s.role,content:s.type==="text"?s.content:`提案: ${((t=s.payload)==null?void 0:t.title)??""} ${((e=s.payload)==null?void 0:e.description)??""}`}}),D=(s,t)=>s&&s.trim()?s:q.value[t],h=s=>s?typeof s=="string"?s:typeof s=="object"&&s.original?s.original:"":"",it=s=>{$.value&&(s&&r.value?sessionStorage.setItem(jt,JSON.stringify({title:h(r.value.title),subtitle:h(r.value.subtitle),description:h(r.value.description),notes:h(r.value.notes),riskNotice:h(r.value.riskNotice),logistics:r.value.logistics??null,ticketTypes:r.value.ticketTypes??[],requirements:r.value.requirements??[],registrationForm:r.value.registrationForm??[],visibility:r.value.visibility??"public",checklist:pt.value,confirmQuestions:dt.value,generatedAt:Date.now()})):sessionStorage.removeItem(jt),C.show("AI案をフォームに送信しました。次の画面で項目を確認してください。","info"),I.push({name:"ConsoleMobileEventForm",params:{communityId:$.value},query:{source:"ai-assistant"}}))};return Ce(async()=>{if(await de(),await m.loadCommunities(),$.value&&m.setActiveCommunity($.value),ae(),await Et(),typeof window<"u"&&window.visualViewport){const s=()=>{const t=window.visualViewport,e=window.innerHeight,p=Math.max(0,e-t.height-t.offsetTop);Z.value=p};window.visualViewport.addEventListener("resize",s),window.visualViewport.addEventListener("scroll",s),s(),Te(()=>{var t,e;(t=window.visualViewport)==null||t.removeEventListener("resize",s),(e=window.visualViewport)==null||e.removeEventListener("scroll",s)})}}),(s,t)=>(n(),l(b,null,[Ft(Be,{label:"P6"}),i("div",{class:"assistant-screen",style:xe(Ut.value)},[i("section",Ye,[i("div",Ze,[i("span",Xe,o(Kt.value),1),i("span",ts,o(Gt[tt.value]),1),r.value?(n(),l("span",es,"Prompt "+o(X.value),1)):c("",!0),i("button",{type:"button",class:"history-toggle",onClick:et},[t[10]||(t[10]=i("span",{class:"i-lucide-clock-4"},null,-1)),T(" "+o(w.value?"收起历史":"会话历史"),1)])]),Xt.value?(n(),l("section",ss,[t[11]||(t[11]=i("p",{class:"guide-title"},"SOCIALMORE AI 使用说明",-1)),t[12]||(t[12]=i("ol",null,[i("li",null,[i("strong",null,"Speak"),T("：随便说出你的想法或需求。")]),i("li",null,[i("strong",null,"Guide"),T("：AI Coach/Editor 会提问，逐条回答即可。")]),i("li",null,[i("strong",null,"Write"),T("：完成提问后，AI 会生成方案，并可一键送表单或存草案。")])],-1)),P.value.length?(n(),l("button",{key:0,type:"button",class:"guide-dismiss",onClick:Rt}," 收起说明 ")):c("",!0)])):(n(),l("button",{key:1,type:"button",class:"guide-inline-toggle",onClick:Rt},[...t[13]||(t[13]=[i("span",{class:"i-lucide-info"},null,-1),T(" 查看使用说明 ",-1)])])),L.value?(n(),l("div",{key:2,class:"history-overlay",onClick:zt(et,["self"])},[i("section",is,[i("header",{class:"history-head"},[t[14]||(t[14]=i("div",null,[i("p",{class:"history-title"},"历史草案"),i("p",{class:"history-subtitle"},"最近 10 条保存的 AI 方案")],-1)),i("button",{type:"button",class:"history-close",onClick:et},"关闭")]),E.value.length?(n(),l("div",ls,[(n(!0),l(b,null,_(E.value,e=>{var p;return n(),l("article",{key:e.id,class:lt(["history-item",((p=w.value)==null?void 0:p.id)===e.id?"is-active":""]),onClick:g=>ue(e)},[i("div",os,[i("h4",null,o(e.title||"無題の案"),1),i("p",null,o(e.summary),1)]),i("span",rs,o(new Date(e.createdAt).toLocaleString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})),1)],10,as)}),128))])):(n(),l("div",ns,"まだ保存された履歴がありません")),w.value?(n(),l("div",us,[i("h4",null,o(w.value.title||"無題の案"),1),i("p",cs,o(w.value.summary||"暂无摘要"),1),w.value.description?(n(),l("p",ps,o(w.value.description),1)):c("",!0),t[15]||(t[15]=i("p",{class:"history-preview-note"},"载入将把该草案插入当前对话；送到表单则直接打开活动编辑页并填入 AI 提案。",-1)),i("div",ds,[i("button",{type:"button",class:"history-preview-link",onClick:t[0]||(t[0]=e=>st(w.value.raw))}," 方案预览 ")]),i("div",vs,[i("button",{type:"button",class:"primary ghost",onClick:t[1]||(t[1]=e=>ce(w.value))}," 载入到对话 "),i("button",{type:"button",class:"primary gradient",onClick:t[2]||(t[2]=e=>re(w.value.raw))}," 送到表单 ")])])):c("",!0)])])):c("",!0),i("div",{class:"chat-log",ref_key:"chatLogRef",ref:at},[(n(!0),l(b,null,_(P.value,e=>{var p,g,z,x,M,j,R,u,Y;return n(),l("div",{key:e.id,class:lt(["chat-bubble",e.role==="user"?"chat-bubble--user":"chat-bubble--assistant"])},[e.type==="text"?(n(),l("div",ys,[i("p",hs,o(e.content),1),e.action==="direct-form"?(n(),l("button",{key:0,type:"button",class:"chat-inline-link",onClick:t[3]||(t[3]=S=>it(!1))}," 直接配置表单 ")):c("",!0),(p=e.options)!=null&&p.length?(n(),l("div",fs,[t[16]||(t[16]=i("p",{class:"chat-options-title"},"当前需要回答的核心问题",-1)),i("p",gs,o(e.options[0]),1),e.options.length>1?(n(),l("p",ms," 还有其他问题，将在你回答完这一条后继续提出。 ")):c("",!0)])):c("",!0),(g=e.thinkingSteps)!=null&&g.length?(n(),l("div",ks,[i("button",{type:"button",class:"thinking-toggle",onClick:S=>pe(e.id)},[t[17]||(t[17]=i("span",null,"AI 思考过程",-1)),i("span",bs,o(W.value===e.id?"收起":"展开"),1)],8,ws),Mt(i("div",_s,[t[18]||(t[18]=i("p",{class:"thinking-inline-title"},"AI 思考过程",-1)),i("ol",null,[(n(!0),l(b,null,_(e.thinkingSteps,(S,k)=>(n(),l("li",{key:`${e.id}-thinking-${k}`},[i("span",Ss,o(k+1),1),i("span",Cs,o(S),1)]))),128))])],512),[[Pe,W.value===e.id]])])):c("",!0),(z=e.coachPrompts)!=null&&z.length?(n(),l("div",Ts,[t[19]||(t[19]=i("p",{class:"coach-prompts-title"},"下一步灵感（Coach）",-1)),i("ol",null,[(n(!0),l(b,null,_(e.coachPrompts,(S,k)=>(n(),l("li",{key:`${e.id}-coach-${k}`},o(S),1))),128))])])):c("",!0),(x=e.editorChecklist)!=null&&x.length?(n(),l("div",$s,[t[21]||(t[21]=i("p",{class:"editor-checklist-title"},"需要补充/确认（Editor）",-1)),i("ul",null,[(n(!0),l(b,null,_(e.editorChecklist,(S,k)=>(n(),l("li",{key:`${e.id}-editor-${k}`},[i("label",null,[t[20]||(t[20]=i("input",{type:"checkbox",disabled:""},null,-1)),i("span",null,o(S),1)])]))),128))])])):c("",!0),e.writerSummary?(n(),l("div",Ps,[t[28]||(t[28]=i("p",{class:"writer-summary-title"},"草稿摘要（Writer）",-1)),i("div",As,[e.writerSummary.headline?(n(),l("p",Is,[t[22]||(t[22]=i("strong",null,"标题",-1)),T(o(e.writerSummary.headline),1)])):c("",!0),e.writerSummary.audience?(n(),l("p",xs,[t[23]||(t[23]=i("strong",null,"受众",-1)),T(o(e.writerSummary.audience),1)])):c("",!0),e.writerSummary.logistics?(n(),l("p",Es,[t[24]||(t[24]=i("strong",null,"细节",-1)),T(o(e.writerSummary.logistics),1)])):c("",!0),e.writerSummary.riskNotes?(n(),l("p",Ls,[t[25]||(t[25]=i("strong",null,"风险",-1)),T(o(e.writerSummary.riskNotes),1)])):c("",!0),e.writerSummary.nextSteps?(n(),l("p",Ns,[t[26]||(t[26]=i("strong",null,"下一步",-1)),T(o(e.writerSummary.nextSteps),1)])):c("",!0)]),(M=e.confirmQuestions)!=null&&M.length?(n(),l("div",Ds,[t[27]||(t[27]=i("p",{class:"writer-confirm-label"},"请确认：",-1)),i("ul",null,[(n(!0),l(b,null,_(e.confirmQuestions,(S,k)=>(n(),l("li",{key:`${e.id}-confirm-${k}`},o(S),1))),128))])])):c("",!0)])):c("",!0)])):(n(),l("div",{key:1,class:lt(["proposal-card",{"proposal-card--clickable":!!((j=e.payload)!=null&&j.raw)}]),onClick:S=>{var k;return((k=e.payload)==null?void 0:k.raw)&&st(e.payload.raw)}},[i("p",Os,o((R=e.payload)==null?void 0:R.title),1),i("p",qs,o((u=e.payload)==null?void 0:u.description),1),(Y=e.payload)!=null&&Y.raw?(n(),l("p",Fs,"点击查看完整草案")):c("",!0)],10,Rs)),i("span",zs,o(e.createdAt),1)],2)}),128))],512),H.value?(n(),l("div",Ms,[...t[29]||(t[29]=[i("span",{class:"thinking-spinner"},null,-1),i("p",null,"AI 正在思考...",-1)])])):c("",!0),B.value?(n(),l("div",js,o(B.value),1)):c("",!0)]),r.value?(n(),l("section",Vs,[i("header",Bs,[i("div",null,[t[30]||(t[30]=i("p",{class:"final-plan-label"},"AI 活动方案",-1)),i("p",Js,o(Wt.value),1)]),i("button",{type:"button",class:"plan-preview-link",onClick:t[4]||(t[4]=e=>st(r.value))},"方案预览")]),h(r.value.description)?(n(),l("div",Us,[t[31]||(t[31]=i("p",{class:"final-plan-subtitle"},"活动亮点",-1)),i("p",Gs,o(h(r.value.description)),1)])):c("",!0),i("div",Qs,[r.value.notes&&h(r.value.notes)?(n(),l("article",Hs,[t[32]||(t[32]=i("p",{class:"final-plan-subtitle"},"备注/准备",-1)),i("p",Ks,o(h(r.value.notes)),1)])):c("",!0),r.value.riskNotice&&h(r.value.riskNotice)?(n(),l("article",Ws,[t[33]||(t[33]=i("p",{class:"final-plan-subtitle"},"风险提示",-1)),i("p",Ys,o(h(r.value.riskNotice)),1)])):c("",!0)]),mt.value.length?(n(),l("div",Zs,[t[34]||(t[34]=i("p",{class:"final-plan-subtitle"},"时间 & 地点",-1)),i("ul",Xs,[(n(!0),l(b,null,_(mt.value,e=>(n(),l("li",{key:`logistics-${e.label}`},[i("strong",null,o(e.label)+"：",1),T(o(e.value),1)]))),128))])])):c("",!0),kt.value.length?(n(),l("div",ti,[t[35]||(t[35]=i("p",{class:"final-plan-subtitle"},"票务设置",-1)),i("ul",ei,[(n(!0),l(b,null,_(kt.value,(e,p)=>(n(),l("li",{key:`ticket-${p}`,class:"final-plan-ticket"},[i("span",null,o(e.name),1),i("span",null,o(It(e.price)),1)]))),128))])])):c("",!0),wt.value.length?(n(),l("div",si,[t[36]||(t[36]=i("p",{class:"final-plan-subtitle"},"参加要求",-1)),i("ul",ii,[(n(!0),l(b,null,_(wt.value,(e,p)=>(n(),l("li",{key:`req-${p}`},o(e.label)+o(e.type==="must"?"（必需）":""),1))),128))])])):c("",!0),bt.value.length?(n(),l("div",ni,[t[37]||(t[37]=i("p",{class:"final-plan-subtitle"},"报名表字段",-1)),i("ul",li,[(n(!0),l(b,null,_(bt.value,(e,p)=>(n(),l("li",{key:`form-${p}`},o(e.label)+" · "+o(e.type)+o(e.required?"（必填）":""),1))),128))])])):c("",!0)])):c("",!0),i("div",ai,[i("div",oi,[Mt(i("input",{ref_key:"chatInputRef",ref:ot,"onUpdate:modelValue":t[5]||(t[5]=e=>O.value=e),class:"chat-input",type:"text",placeholder:te.value,onKeyup:t[6]||(t[6]=Ie(e=>Nt("enter"),["enter"]))},null,40,ri),[[Ae,O.value]]),t[39]||(t[39]=i("button",{class:"chat-voice",type:"button"},[i("span",{class:"chat-button-label"},"语音")],-1)),i("button",{class:"chat-send",type:"button",onClick:t[7]||(t[7]=e=>Nt("button")),disabled:!O.value.trim()},[...t[38]||(t[38]=[i("span",{class:"chat-button-label"},"发送",-1)])],8,ui)]),r.value?(n(),l("section",ci,[i("button",{class:"primary gradient",type:"button",disabled:!$.value,onClick:t[8]||(t[8]=e=>it(!0))}," 送到表单 ",8,pi),i("button",{class:"primary",type:"button",onClick:t[9]||(t[9]=e=>oe(r.value))},"保存草案")])):c("",!0)])],4),(n(),$e(Ne,{to:"body"},[Ft(Le,{name:"fade"},{default:Ee(()=>[A.value?(n(),l("div",{key:0,class:"plan-preview-overlay",onClick:zt(Ot,["self"])},[i("section",di,[i("header",vi,[i("div",null,[t[40]||(t[40]=i("p",{class:"plan-preview-label"},"AI 草案",-1)),i("p",yi,o(Yt.value),1)]),i("button",{type:"button",class:"plan-preview-close",onClick:Ot},[...t[41]||(t[41]=[i("span",{class:"i-lucide-x"},null,-1)])])]),i("div",hi,[_t.value?(n(),l("article",fi,[t[42]||(t[42]=i("p",{class:"plan-preview-subtitle"},"活动亮点",-1)),i("p",gi,o(_t.value),1)])):c("",!0),i("div",mi,[St.value?(n(),l("article",ki,[t[43]||(t[43]=i("p",{class:"plan-preview-subtitle"},"备注/准备",-1)),i("p",wi,o(St.value),1)])):c("",!0),Ct.value?(n(),l("article",bi,[t[44]||(t[44]=i("p",{class:"plan-preview-subtitle"},"风险提示",-1)),i("p",_i,o(Ct.value),1)])):c("",!0)]),Tt.value.length?(n(),l("article",Si,[t[45]||(t[45]=i("p",{class:"plan-preview-subtitle"},"时间 & 地点",-1)),i("ul",Ci,[(n(!0),l(b,null,_(Tt.value,e=>(n(),l("li",{key:`preview-logistics-${e.label}`},[i("strong",null,o(e.label)+"：",1),T(o(e.value),1)]))),128))])])):c("",!0),$t.value.length?(n(),l("article",Ti,[t[46]||(t[46]=i("p",{class:"plan-preview-subtitle"},"票务设置",-1)),i("ul",$i,[(n(!0),l(b,null,_($t.value,(e,p)=>(n(),l("li",{key:`preview-ticket-${p}`},[i("span",null,o(e.name),1),i("span",null,o(It(e.price)),1)]))),128))])])):c("",!0),Pt.value.length?(n(),l("article",Pi,[t[47]||(t[47]=i("p",{class:"plan-preview-subtitle"},"参加要求",-1)),i("ul",Ai,[(n(!0),l(b,null,_(Pt.value,(e,p)=>(n(),l("li",{key:`preview-req-${p}`},o(e.label)+o(e.type==="must"?"（必需）":""),1))),128))])])):c("",!0),At.value.length?(n(),l("article",Ii,[t[48]||(t[48]=i("p",{class:"plan-preview-subtitle"},"报名表字段",-1)),i("ul",xi,[(n(!0),l(b,null,_(At.value,(e,p)=>(n(),l("li",{key:`preview-form-${p}`},o(e.label)+" · "+o(e.type)+o(e.required?"（必填）":""),1))),128))])])):c("",!0)])])])):c("",!0)]),_:1})]))],64))}}),Oi=Ve(Ei,[["__scopeId","data-v-add69d96"]]);export{Oi as default};
