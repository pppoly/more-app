import{ae as fe,d as ge,a6 as me,c as g,A as ke,r as v,B as we,C as it,o as be,a0 as _e,b as l,h as i,p as Se,i as c,t as a,j as T,w as qt,F as _,f as S,v as Ft,x as Ce,af as Te,n as $e,z as Pe,s as Ae,a1 as Ie,a2 as xe,a8 as Ee,g as Le,ag as Ne,ah as Re,ai as De,aj as Oe,ak as zt,u as qe,a4 as Fe,e as n,y as nt,al as ze,_ as Me}from"./index-BGcABSEi.js";const Vt=["title","description","startTime","locationText","ticketTypes","visibility","registrationFormSchema"],je=`${fe}

---
You are the SOCIALMORE Event Creation Assistant.
- Mission: understand the organizer's intention, encourage them when they hesitate, and then help them commit to clear written decisions.
- Persona: warm coach at first, precise editor later. Never turn the conversation into a rigid form.
- Languages: default to Japanese, but mirror the user's input language when possible.
- Process: Listen (感性) → Guide (構造化) → Write (草稿を提示) → Confirm (ユーザーに最終判断を委ねる).`,Ve={coach:`Current stage: 感性モード (Coach).
Goals:
- Surface the organizer's motivation, people they want to help, and desired vibe.
- Translate vague wishes into tangible goals.
- Ask one focused question at a time; do not rush into fields or checklists.
Forbidden:
- Empty hype (e.g., "必ず成功します").
- Ignoring obvious fears or blockers the organizer mentions.`,editor:`Current stage: 理性モード (Editor).
Goals:
- Organize concrete decisions (title, time, location, ticketing, requirements).
- Offer options with pros/cons when the organizer hesitates.
- Highlight contradictions or risks (e.g., "想要開放但又限定費用很高").
Guidelines:
- Provide concise bullet structures or A/B drafts.
- Ask clarifying questions only for the missing fields listed below.`,writer:`Current stage: ライティング / 確認.
Goals:
- Summarize the EventDraft so the organizer can confirm or adjust.
- Clearly list every key field (title, schedule, ticketing, requirements, notes).
- Invite the organizer to edit specific parts instead of rewriting everything.
If something is still missing, politely mention it before presenting the summary.`},Be='Reply with:\n1) A short natural-language response following the current stage instructions.\n2) If you update the draft, append a JSON block using ```json ... ``` that contains { "type": "event_draft_update", "data": Partial<EventDraft> }.\nNever invent data that the organizer has not provided.';function Je(o){if(!o)return"coach";const y=!!(typeof o.title=="string"&&o.title.trim()||o.purpose||o.description||o.category||o.targetAudience),A=Vt.every(k=>{const h=o[k];return h==null?!1:Array.isArray(h)?h.length>0:typeof h=="string"?h.trim().length>0:!0});return y?A?"writer":"editor":"coach"}function Ue(o){var A;if(!o)return"No draft data yet.";const y=[];if(o.title&&y.push(`Title: ${J(o.title)}`),o.subtitle&&y.push(`Subtitle: ${J(o.subtitle)}`),o.purpose&&y.push(`Purpose: ${J(o.purpose)}`),o.description&&y.push(`Description: ${J(o.description)}`),o.startTime&&y.push(`Start: ${o.startTime}`),o.endTime&&y.push(`End: ${o.endTime}`),o.locationText&&y.push(`Location: ${o.locationText}`),o.ticketTypes&&o.ticketTypes.length){const k=o.ticketTypes.map(h=>`${J(h.name)} ¥${h.price??0}`).join(", ");y.push(`Ticketing: ${k}`)}return o.requirements&&o.requirements.length&&y.push(`Requirements: ${o.requirements.map(k=>k.label).join(", ")}`),(A=o.config)!=null&&A.riskNoticeEnabled&&y.push("Risk notice is enabled."),y.length?y.join(`
`):"Draft exists but has no descriptive fields yet."}function J(o){return o==null?"":typeof o=="string"?o:typeof o=="object"&&"original"in o?String(o.original??""):JSON.stringify(o)}function Ge(o){if(!o)return"All fields missing.";const y=Vt.filter(A=>{const k=o[A];return k==null?!0:Array.isArray(k)?k.length===0:typeof k=="string"?k.trim().length===0:!1});return y.length?`Fields still missing: ${y.join(", ")}`:"Required fields are present."}function Qe(o){const y=o.explicitStage??Je(o.draft),A=o.locale==="zh"?"回答は簡体字中文でもよいですが、ユーザーの入力言語に合わせてください。":o.locale==="en"?"Respond in English unless the organizer prefers Japanese.":"回答は日本語をベースに、ユーザーの言語に合わせてカスタマイズしてください。",k=[o.userName?`Organizer: ${o.userName}`:null,o.communityName?`Community: ${o.communityName}`:null,o.lastUserUtterance?`Latest user message: ${o.lastUserUtterance}`:null].filter(Boolean).join(`
`),h=[je,A,Ve[y],`Draft context:
${Ue(o.draft)}`,Ge(o.draft),Be].concat(k?[`
Context:
${k}`]:[]).join(`

`);return{stage:y,prompt:h}}const He={class:"assistant-chat-surface"},Ke={class:"chat-tools"},We={class:"status-chip"},Ye={class:"mode-chip"},Ze={key:0,class:"prompt-chip"},Xe={key:0,class:"assistant-guide"},ts={class:"history-sheet"},es={key:0,class:"history-empty"},ss={key:1,class:"history-list"},is=["onClick"],ns={class:"history-item-body"},ls={class:"history-item-time"},os={key:2,class:"history-preview"},as={class:"history-preview-summary"},rs={key:0,class:"history-preview-desc"},us={class:"history-preview-links"},cs={class:"history-preview-actions"},ps={key:0,class:"chat-text-block"},ds={class:"chat-text"},vs={key:1,class:"chat-options"},ys={class:"chat-options-question"},hs={key:0,class:"chat-options-note"},fs={key:2,class:"thinking-collapsible"},gs=["onClick"],ms={class:"thinking-toggle__action"},ks={class:"thinking-inline"},ws={class:"thinking-inline-index"},bs={class:"thinking-inline-text"},_s={key:3,class:"coach-prompts"},Ss={key:4,class:"editor-checklist"},Cs={key:5,class:"writer-summary"},Ts={class:"writer-summary-grid"},$s={key:0},Ps={key:1},As={key:2},Is={key:3},xs={key:4},Es={key:0,class:"writer-confirm"},Ls=["onClick"],Ns={class:"proposal-title"},Rs={class:"proposal-desc"},Ds={key:0,class:"proposal-hint"},Os={class:"chat-meta"},qs={key:3,class:"thinking-banner"},Fs={key:4,class:"assistant-error"},zs={key:0,class:"final-plan-card"},Ms={class:"final-plan-header"},js={class:"final-plan-title"},Vs={key:0,class:"final-plan-section"},Bs={class:"final-plan-text"},Js={class:"final-plan-grid"},Us={key:0},Gs={class:"final-plan-text"},Qs={key:1},Hs={class:"final-plan-text"},Ks={key:1,class:"final-plan-section"},Ws={class:"final-plan-list"},Ys={key:2,class:"final-plan-section"},Zs={class:"final-plan-ticket-list"},Xs={key:3,class:"final-plan-section"},ti={class:"final-plan-list"},ei={key:4,class:"final-plan-section"},si={class:"final-plan-list"},ii={class:"assistant-bottom"},ni={class:"chat-input-row"},li=["placeholder"],oi=["disabled"],ai={key:0,class:"final-plan-actions"},ri=["disabled"],ui={class:"plan-preview-panel"},ci={class:"plan-preview-head"},pi={class:"plan-preview-title"},di={class:"plan-preview-scroll"},vi={key:0,class:"plan-preview-section"},yi={class:"plan-preview-text"},hi={class:"plan-preview-grid"},fi={key:0},gi={class:"plan-preview-text"},mi={key:1},ki={class:"plan-preview-text"},wi={key:1,class:"plan-preview-section"},bi={class:"plan-preview-list"},_i={key:2,class:"plan-preview-section"},Si={class:"plan-preview-ticket-list"},Ci={key:3,class:"plan-preview-section"},Ti={class:"plan-preview-list"},$i={key:4,class:"plan-preview-section"},Pi={class:"plan-preview-list"},Mt="console-ai-assistant-history",jt="console-ai-assistant-drafts",Ai=ge({__name:"ConsoleEventAssistantMobile",setup(o){const y=ke(),A=qe(),k=me(),h=g(()=>y.params.communityId);g(()=>{const s=h.value;if(!s)return"";const t=k.communities.value.find(e=>e.id===s);return(t==null?void 0:t.name)??""});const U=v(null),j=v(!1),d=we({baseLanguage:"ja",topic:"",audience:"",style:"",details:""}),G=[{key:"topic",prompt:"どんなイベントを企画していますか？（例：親子BBQ、言語交換など）"},{key:"audience",prompt:"主な対象や届けたい人は誰ですか？"},{key:"style",prompt:"雰囲気やスタイルはどうしたいですか？（family-friendly / casual など）"},{key:"details",prompt:"場所・所要時間・持ち物など、補足したいことを自由にどうぞ。"}],$=v([]),lt=v(null),Y=v(0),Bt=g(()=>({"--keyboard-offset":`${Y.value}px`})),D=v(""),ot=v(null),Q=v(!1),V=v(null),r=v(null),P=v(null),B=v(0),at=v(!1),x=v([]),b=v(null),E=v(!1),H=v(!0),K=v(null),rt=v("collecting"),Z=v("coach-v2"),X=v("coach"),L=v(null),Jt={coach:"模式：Coach（点火）",editor:"模式：Editor（打灯）",writer:"模式：Writer（草稿确认）"},Ut=v(0),Gt=v("ja"),Qt=g(()=>{switch(rt.value){case"ready":return"方案已生成";case"options":return"候选提案";default:return"信息收集中"}}),O=v({baseLanguage:"zh",topic:"コミュニティイベント",audience:"地域の仲間",style:"family-friendly"}),ut=g(()=>{var s;for(let t=$.value.length-1;t>=0;t-=1){const e=$.value[t];if(e.role==="assistant"&&((s=e.coachPrompts)!=null&&s.length))return e.coachPrompts}return[]}),ct=v([]),pt=v([]),dt=(s,t)=>s?f(s.title)||t||"AI 提案":"",vt=s=>{const t=s==null?void 0:s.logistics;if(!t)return[];const e=[];return t.startTime&&e.push({label:"开始时间",value:formatDateTime(t.startTime)}),t.endTime&&e.push({label:"结束时间",value:formatDateTime(t.endTime)}),t.locationText&&e.push({label:"地点",value:t.locationText}),t.locationNote&&e.push({label:"地点备注",value:t.locationNote}),e},yt=s=>(s==null?void 0:s.ticketTypes)??[],ht=s=>(s==null?void 0:s.requirements)??[],ft=s=>(s==null?void 0:s.registrationForm)??[],Ht=g(()=>dt(r.value,d.topic)),gt=g(()=>vt(r.value)),mt=g(()=>yt(r.value)),kt=g(()=>ht(r.value)),wt=g(()=>ft(r.value)),Kt=g(()=>dt(P.value)),bt=g(()=>{var s;return f((s=P.value)==null?void 0:s.description)}),_t=g(()=>{var s;return f((s=P.value)==null?void 0:s.notes)}),St=g(()=>{var s;return f((s=P.value)==null?void 0:s.riskNotice)}),Ct=g(()=>vt(P.value)),Tt=g(()=>yt(P.value)),$t=g(()=>ht(P.value)),Pt=g(()=>ft(P.value)),At=s=>s==null?"免费":`¥${s.toLocaleString("ja-JP")}`,Wt=g(()=>({title:d.topic||"",description:d.details||d.topic,targetAudience:d.audience,vibe:d.style,locationText:d.details,ticketTypes:[],registrationFormSchema:[]})),Yt=g(()=>H.value),Zt=g(()=>L.value?L.value:ut.value.length?ut.value[0]:B.value>=G.length?"追加で伝えたいことや質問を入力してください":G[B.value].prompt);it(()=>h.value,()=>{j.value=!1,xt()}),it(()=>$.value.length,(s,t)=>{t===0&&s>0&&(H.value=!1)}),it(()=>E.value,s=>{s?b.value=x.value[0]??null:b.value=null});const It=()=>{Fe(()=>{const s=lt.value;s&&(s.scrollTop=s.scrollHeight)})},q=(s,t,e,p,m,F,I,z,M,R,u)=>{$.value.push({id:`${Date.now()}-${Math.random().toString(36).slice(2)}`,role:s,type:t,content:e,createdAt:new Date().toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"}),payload:p,action:m,options:F,thinkingSteps:I&&I.length?I:void 0,coachPrompts:z,editorChecklist:M,writerSummary:R,confirmQuestions:u}),$.value.length>200&&$.value.shift(),It()},xt=async()=>{if(!h.value){U.value=null,j.value=!1,await Et();return}try{U.value=await Ee(h.value)}catch(s){console.warn("Failed to load community detail",s),U.value=null}finally{j.value=!1,await Et()}},Et=async()=>{if(j.value)return;j.value=!0;const s=U.value,t=s!=null&&s.description?Le(s.description):"",e=(s==null?void 0:s.name)??"Tokyo Community Organizations Meetup Group",p=t?`コミュニティ紹介：${e}
${t}

上記の背景を踏まえて、主催者が最初のアイデアを話しやすいようCoachモードで歓迎し、最初の質問を投げかけてください。`:"コミュニティ紹介情報はありません。主催者を歓迎し、最初のアイデアを引き出す質問から始めてください。";await Nt(p,{overrideSummary:`コミュニティ紹介: ${e}`})},Lt=async(s="button")=>{var e;if(!D.value.trim()||Q.value)return;const t=D.value.trim();D.value="",s==="button"&&((e=ot.value)==null||e.blur(),Y.value=0),q("user","text",t),await ee(t)},Xt=s=>/[\u4e00-\u9fff]/.test(s)?"zh":/[a-zA-Z]/.test(s)?"en":"ja",te=s=>{const t=Xt(s);t&&d.baseLanguage!==t&&(d.baseLanguage=t)},ee=async s=>{te(s);const t=G[B.value];t&&(d[t.key]=s),B.value<G.length-1&&(B.value+=1),L.value=null,await Nt(s)},Nt=async(s,t)=>{var R;V.value=null;const e=(t==null?void 0:t.overrideSummary)??Ot(s),{stage:p,prompt:m}=Qe({draft:Wt.value,locale:d.baseLanguage||"ja",lastUserUtterance:s});X.value=p;const F=de(),I=`${e}

--- Conversation ---
${F}

--- Assistant Prompt ---
${m}`,z=ve(),M={baseLanguage:N(d.baseLanguage,"baseLanguage"),topic:N(d.topic,"topic"),audience:N(d.audience,"audience"),style:N(d.style,"style"),details:I,conversation:z};Q.value=!0;try{const u=await Ne(M),W=Array.isArray(u.thinkingSteps)?u.thinkingSteps:[];rt.value=u.status,Z.value=u.promptVersion,Ut.value=u.turnCount,Gt.value=u.language,u.stage&&["coach","editor","writer"].includes(u.stage)&&(X.value=u.stage),ct.value=u.editorChecklist??[],pt.value=u.confirmQuestions??[];const C=u.stage==="writer";q("assistant","text",u.message,void 0,void 0,u.options,W,u.coachPrompts,u.editorChecklist,C?u.writerSummary:void 0,u.confirmQuestions),L.value=((R=u.options)==null?void 0:R[0])??null;let w=null;if((u.status==="ready"||u.status==="options"||!!u.proposal)&&u.stage==="writer"){w={...u.proposal??await Re({baseLanguage:d.baseLanguage||"ja",topic:d.topic||"コミュニティイベント",audience:d.audience||"地域の仲間",style:d.style||"family-friendly",details:e}),summary:e},r.value=w;const ye=f(w.title),he=f(w.description);q("assistant","proposal","",{title:ye,description:he,raw:r.value})}else r.value=null,L.value=null;await se(p,e,{status:u.status,promptVersion:u.promptVersion,turnCount:u.turnCount,language:u.language,options:u.options??[],coachPrompts:u.coachPrompts??[],editorChecklist:u.editorChecklist??[],writerSummary:C?u.writerSummary??null:null}),w&&ie(w)}catch(u){V.value=u instanceof Error?u.message:"AI生成に失敗しました。少し時間を置いて再度お試しください。",q("assistant","text",V.value??"AI生成に失敗しました。")}finally{Q.value=!1,L.value||(L.value=null)}},se=async(s,t,e)=>{if(h.value)try{at.value=!0;const p=$.value.map(m=>({id:m.id,role:m.role,type:m.type,content:m.content,createdAt:m.createdAt,payload:m.payload?{title:m.payload.title??null,description:m.payload.description??null}:null}));await De(h.value,{stage:s,summary:t,qaState:JSON.parse(JSON.stringify(d)),messages:p,aiResult:r.value?{title:r.value.title,description:r.value.description,notes:r.value.notes,riskNotice:r.value.riskNotice}:null,promptVersion:e==null?void 0:e.promptVersion,status:e==null?void 0:e.status,turnCount:e==null?void 0:e.turnCount,language:e==null?void 0:e.language,meta:{options:(e==null?void 0:e.options)??[],coachPrompts:(e==null?void 0:e.coachPrompts)??[],editorChecklist:(e==null?void 0:e.editorChecklist)??[],writerSummary:(e==null?void 0:e.writerSummary)??null}})}catch(p){console.warn("Failed to save assistant log",p)}finally{at.value=!1}},ie=s=>{const t={id:`${Date.now()}-${Math.random().toString(36).slice(2)}`,createdAt:Date.now(),summary:s.summary,title:f(s.title),description:f(s.description),raw:s};x.value=[t,...x.value].slice(0,10),localStorage.setItem(Mt,JSON.stringify(x.value))},ne=()=>{const s=localStorage.getItem(Mt);if(s)try{const t=JSON.parse(s);x.value=t}catch(t){console.warn("Failed to parse assistant history",t)}},le=s=>{if(!s)return;const t=localStorage.getItem(jt);let e=[];if(t)try{e=JSON.parse(t)}catch{e=[]}e=[{id:`${Date.now()}-${Math.random().toString(36).slice(2)}`,createdAt:Date.now(),summary:s.summary||"",title:f(s.title),description:f(s.description),raw:s},...e].slice(0,10),localStorage.setItem(jt,JSON.stringify(e)),q("assistant","text","この案を草稿として保存しました。履歴からいつでも復元できます。")},oe=s=>{s&&(r.value={...s,summary:s.summary||Ot()},st(!0),E.value=!1,b.value=null)},ae=s=>{b.value=s},re=s=>{s&&(r.value={...s.raw,summary:s.summary},q("assistant","proposal","",{title:s.title,description:s.description,raw:r.value}),E.value=!1,b.value=null,It())},tt=()=>{E.value=!E.value,E.value||(b.value=null)},Rt=()=>{H.value=!H.value},ue=s=>{K.value=K.value===s?null:s},et=s=>{s&&(P.value=s)},Dt=()=>{P.value=null},ce=async()=>{try{const s=await Oe();O.value=s.defaults,Z.value=s.version,pe()}catch(s){console.warn("Failed to load assistant defaults",s)}},pe=()=>{d.baseLanguage||(d.baseLanguage=O.value.baseLanguage),d.topic||(d.topic=O.value.topic),d.audience||(d.audience=O.value.audience),d.style||(d.style=O.value.style)},Ot=s=>`AIの理解：対象は「${N(d.audience,"audience")}」、イベントは「${N(d.topic,"topic")}」、雰囲気は「${N(d.style,"style")}」。補足情報: ${s||d.details||"特記事項なし"}`,de=()=>$.value.slice(-8).map(s=>{var p,m;const t=s.role==="user"?"User":"Assistant",e=s.type==="text"?s.content:`提案: ${((p=s.payload)==null?void 0:p.title)??""} ${((m=s.payload)==null?void 0:m.description)??""}`;return`${t}: ${e}`}).join(`
`),ve=()=>$.value.slice(-10).map(s=>{var t,e;return{role:s.role,content:s.type==="text"?s.content:`提案: ${((t=s.payload)==null?void 0:t.title)??""} ${((e=s.payload)==null?void 0:e.description)??""}`}}),N=(s,t)=>s&&s.trim()?s:O.value[t],f=s=>s?typeof s=="string"?s:typeof s=="object"&&s.original?s.original:"":"",st=s=>{h.value&&(s&&r.value?sessionStorage.setItem(zt,JSON.stringify({title:f(r.value.title),subtitle:f(r.value.subtitle),description:f(r.value.description),notes:f(r.value.notes),riskNotice:f(r.value.riskNotice),logistics:r.value.logistics??null,ticketTypes:r.value.ticketTypes??[],requirements:r.value.requirements??[],registrationForm:r.value.registrationForm??[],visibility:r.value.visibility??"public",checklist:ct.value,confirmQuestions:pt.value,generatedAt:Date.now()})):sessionStorage.removeItem(zt),window.alert("AI案をフォームに送信します。次の画面で各項目を確認してください。"),A.push({name:"ConsoleMobileEventForm",params:{communityId:h.value},query:{source:"ai-assistant"}}))};return be(async()=>{if(await ce(),await k.loadCommunities(),h.value&&k.setActiveCommunity(h.value),ne(),await xt(),typeof window<"u"&&window.visualViewport){const s=()=>{const t=window.visualViewport,e=window.innerHeight,p=Math.max(0,e-t.height-t.offsetTop);Y.value=p};window.visualViewport.addEventListener("resize",s),window.visualViewport.addEventListener("scroll",s),s(),_e(()=>{var t,e;(t=window.visualViewport)==null||t.removeEventListener("resize",s),(e=window.visualViewport)==null||e.removeEventListener("scroll",s)})}}),(s,t)=>(n(),l(_,null,[i("div",{class:"assistant-screen",style:$e(Bt.value)},[i("section",He,[i("div",Ke,[i("span",We,a(Qt.value),1),i("span",Ye,a(Jt[X.value]),1),r.value?(n(),l("span",Ze,"Prompt "+a(Z.value),1)):c("",!0),i("button",{type:"button",class:"history-toggle",onClick:tt},[t[10]||(t[10]=i("span",{class:"i-lucide-clock-4"},null,-1)),T(" "+a(b.value?"收起历史":"会话历史"),1)])]),Yt.value?(n(),l("section",Xe,[t[11]||(t[11]=i("p",{class:"guide-title"},"SOCIALMORE AI 使用说明",-1)),t[12]||(t[12]=i("ol",null,[i("li",null,[i("strong",null,"Speak"),T("：随便说出你的想法或需求。")]),i("li",null,[i("strong",null,"Guide"),T("：AI Coach/Editor 会提问，逐条回答即可。")]),i("li",null,[i("strong",null,"Write"),T("：完成提问后，AI 会生成方案，并可一键送表单或存草案。")])],-1)),$.value.length?(n(),l("button",{key:0,type:"button",class:"guide-dismiss",onClick:Rt}," 收起说明 ")):c("",!0)])):(n(),l("button",{key:1,type:"button",class:"guide-inline-toggle",onClick:Rt},[...t[13]||(t[13]=[i("span",{class:"i-lucide-info"},null,-1),T(" 查看使用说明 ",-1)])])),E.value?(n(),l("div",{key:2,class:"history-overlay",onClick:qt(tt,["self"])},[i("section",ts,[i("header",{class:"history-head"},[t[14]||(t[14]=i("div",null,[i("p",{class:"history-title"},"历史草案"),i("p",{class:"history-subtitle"},"最近 10 条保存的 AI 方案")],-1)),i("button",{type:"button",class:"history-close",onClick:tt},"关闭")]),x.value.length?(n(),l("div",ss,[(n(!0),l(_,null,S(x.value,e=>{var p;return n(),l("article",{key:e.id,class:nt(["history-item",((p=b.value)==null?void 0:p.id)===e.id?"is-active":""]),onClick:m=>ae(e)},[i("div",ns,[i("h4",null,a(e.title||"無題の案"),1),i("p",null,a(e.summary),1)]),i("span",ls,a(new Date(e.createdAt).toLocaleString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})),1)],10,is)}),128))])):(n(),l("div",es,"まだ保存された履歴がありません")),b.value?(n(),l("div",os,[i("h4",null,a(b.value.title||"無題の案"),1),i("p",as,a(b.value.summary||"暂无摘要"),1),b.value.description?(n(),l("p",rs,a(b.value.description),1)):c("",!0),t[15]||(t[15]=i("p",{class:"history-preview-note"},"载入将把该草案插入当前对话；送到表单则直接打开活动编辑页并填入 AI 提案。",-1)),i("div",us,[i("button",{type:"button",class:"history-preview-link",onClick:t[0]||(t[0]=e=>et(b.value.raw))}," 方案预览 ")]),i("div",cs,[i("button",{type:"button",class:"primary ghost",onClick:t[1]||(t[1]=e=>re(b.value))}," 载入到对话 "),i("button",{type:"button",class:"primary gradient",onClick:t[2]||(t[2]=e=>oe(b.value.raw))}," 送到表单 ")])])):c("",!0)])])):c("",!0),i("div",{class:"chat-log",ref_key:"chatLogRef",ref:lt},[(n(!0),l(_,null,S($.value,e=>{var p,m,F,I,z,M,R,u,W;return n(),l("div",{key:e.id,class:nt(["chat-bubble",e.role==="user"?"chat-bubble--user":"chat-bubble--assistant"])},[e.type==="text"?(n(),l("div",ps,[i("p",ds,a(e.content),1),e.action==="direct-form"?(n(),l("button",{key:0,type:"button",class:"chat-inline-link",onClick:t[3]||(t[3]=C=>st(!1))}," 直接配置表单 ")):c("",!0),(p=e.options)!=null&&p.length?(n(),l("div",vs,[t[16]||(t[16]=i("p",{class:"chat-options-title"},"当前需要回答的核心问题",-1)),i("p",ys,a(e.options[0]),1),e.options.length>1?(n(),l("p",hs," 还有其他问题，将在你回答完这一条后继续提出。 ")):c("",!0)])):c("",!0),(m=e.thinkingSteps)!=null&&m.length?(n(),l("div",fs,[i("button",{type:"button",class:"thinking-toggle",onClick:C=>ue(e.id)},[t[17]||(t[17]=i("span",null,"AI 思考过程",-1)),i("span",ms,a(K.value===e.id?"收起":"展开"),1)],8,gs),Ft(i("div",ks,[t[18]||(t[18]=i("p",{class:"thinking-inline-title"},"AI 思考过程",-1)),i("ol",null,[(n(!0),l(_,null,S(e.thinkingSteps,(C,w)=>(n(),l("li",{key:`${e.id}-thinking-${w}`},[i("span",ws,a(w+1),1),i("span",bs,a(C),1)]))),128))])],512),[[ze,K.value===e.id]])])):c("",!0),(F=e.coachPrompts)!=null&&F.length?(n(),l("div",_s,[t[19]||(t[19]=i("p",{class:"coach-prompts-title"},"下一步灵感（Coach）",-1)),i("ol",null,[(n(!0),l(_,null,S(e.coachPrompts,(C,w)=>(n(),l("li",{key:`${e.id}-coach-${w}`},a(C),1))),128))])])):c("",!0),(I=e.editorChecklist)!=null&&I.length?(n(),l("div",Ss,[t[21]||(t[21]=i("p",{class:"editor-checklist-title"},"需要补充/确认（Editor）",-1)),i("ul",null,[(n(!0),l(_,null,S(e.editorChecklist,(C,w)=>(n(),l("li",{key:`${e.id}-editor-${w}`},[i("label",null,[t[20]||(t[20]=i("input",{type:"checkbox",disabled:""},null,-1)),i("span",null,a(C),1)])]))),128))])])):c("",!0),e.writerSummary?(n(),l("div",Cs,[t[28]||(t[28]=i("p",{class:"writer-summary-title"},"草稿摘要（Writer）",-1)),i("div",Ts,[e.writerSummary.headline?(n(),l("p",$s,[t[22]||(t[22]=i("strong",null,"标题",-1)),T(a(e.writerSummary.headline),1)])):c("",!0),e.writerSummary.audience?(n(),l("p",Ps,[t[23]||(t[23]=i("strong",null,"受众",-1)),T(a(e.writerSummary.audience),1)])):c("",!0),e.writerSummary.logistics?(n(),l("p",As,[t[24]||(t[24]=i("strong",null,"细节",-1)),T(a(e.writerSummary.logistics),1)])):c("",!0),e.writerSummary.riskNotes?(n(),l("p",Is,[t[25]||(t[25]=i("strong",null,"风险",-1)),T(a(e.writerSummary.riskNotes),1)])):c("",!0),e.writerSummary.nextSteps?(n(),l("p",xs,[t[26]||(t[26]=i("strong",null,"下一步",-1)),T(a(e.writerSummary.nextSteps),1)])):c("",!0)]),(z=e.confirmQuestions)!=null&&z.length?(n(),l("div",Es,[t[27]||(t[27]=i("p",{class:"writer-confirm-label"},"请确认：",-1)),i("ul",null,[(n(!0),l(_,null,S(e.confirmQuestions,(C,w)=>(n(),l("li",{key:`${e.id}-confirm-${w}`},a(C),1))),128))])])):c("",!0)])):c("",!0)])):(n(),l("div",{key:1,class:nt(["proposal-card",{"proposal-card--clickable":!!((M=e.payload)!=null&&M.raw)}]),onClick:C=>{var w;return((w=e.payload)==null?void 0:w.raw)&&et(e.payload.raw)}},[i("p",Ns,a((R=e.payload)==null?void 0:R.title),1),i("p",Rs,a((u=e.payload)==null?void 0:u.description),1),(W=e.payload)!=null&&W.raw?(n(),l("p",Ds,"点击查看完整草案")):c("",!0)],10,Ls)),i("span",Os,a(e.createdAt),1)],2)}),128))],512),Q.value?(n(),l("div",qs,[...t[29]||(t[29]=[i("span",{class:"thinking-spinner"},null,-1),i("p",null,"AI 正在思考...",-1)])])):c("",!0),V.value?(n(),l("div",Fs,a(V.value),1)):c("",!0)]),r.value?(n(),l("section",zs,[i("header",Ms,[i("div",null,[t[30]||(t[30]=i("p",{class:"final-plan-label"},"AI 活动方案",-1)),i("p",js,a(Ht.value),1)]),i("button",{type:"button",class:"plan-preview-link",onClick:t[4]||(t[4]=e=>et(r.value))},"方案预览")]),f(r.value.description)?(n(),l("div",Vs,[t[31]||(t[31]=i("p",{class:"final-plan-subtitle"},"活动亮点",-1)),i("p",Bs,a(f(r.value.description)),1)])):c("",!0),i("div",Js,[r.value.notes&&f(r.value.notes)?(n(),l("article",Us,[t[32]||(t[32]=i("p",{class:"final-plan-subtitle"},"备注/准备",-1)),i("p",Gs,a(f(r.value.notes)),1)])):c("",!0),r.value.riskNotice&&f(r.value.riskNotice)?(n(),l("article",Qs,[t[33]||(t[33]=i("p",{class:"final-plan-subtitle"},"风险提示",-1)),i("p",Hs,a(f(r.value.riskNotice)),1)])):c("",!0)]),gt.value.length?(n(),l("div",Ks,[t[34]||(t[34]=i("p",{class:"final-plan-subtitle"},"时间 & 地点",-1)),i("ul",Ws,[(n(!0),l(_,null,S(gt.value,e=>(n(),l("li",{key:`logistics-${e.label}`},[i("strong",null,a(e.label)+"：",1),T(a(e.value),1)]))),128))])])):c("",!0),mt.value.length?(n(),l("div",Ys,[t[35]||(t[35]=i("p",{class:"final-plan-subtitle"},"票务设置",-1)),i("ul",Zs,[(n(!0),l(_,null,S(mt.value,(e,p)=>(n(),l("li",{key:`ticket-${p}`,class:"final-plan-ticket"},[i("span",null,a(e.name),1),i("span",null,a(At(e.price)),1)]))),128))])])):c("",!0),kt.value.length?(n(),l("div",Xs,[t[36]||(t[36]=i("p",{class:"final-plan-subtitle"},"参加要求",-1)),i("ul",ti,[(n(!0),l(_,null,S(kt.value,(e,p)=>(n(),l("li",{key:`req-${p}`},a(e.label)+a(e.type==="must"?"（必需）":""),1))),128))])])):c("",!0),wt.value.length?(n(),l("div",ei,[t[37]||(t[37]=i("p",{class:"final-plan-subtitle"},"报名表字段",-1)),i("ul",si,[(n(!0),l(_,null,S(wt.value,(e,p)=>(n(),l("li",{key:`form-${p}`},a(e.label)+" · "+a(e.type)+a(e.required?"（必填）":""),1))),128))])])):c("",!0)])):c("",!0),i("div",ii,[i("div",ni,[Ft(i("input",{ref_key:"chatInputRef",ref:ot,"onUpdate:modelValue":t[5]||(t[5]=e=>D.value=e),class:"chat-input",type:"text",placeholder:Zt.value,onKeyup:t[6]||(t[6]=Te(e=>Lt("enter"),["enter"]))},null,40,li),[[Ce,D.value]]),t[39]||(t[39]=i("button",{class:"chat-voice",type:"button"},[i("span",{class:"chat-button-label"},"语音")],-1)),i("button",{class:"chat-send",type:"button",onClick:t[7]||(t[7]=e=>Lt("button")),disabled:!D.value.trim()},[...t[38]||(t[38]=[i("span",{class:"chat-button-label"},"发送",-1)])],8,oi)]),r.value?(n(),l("section",ai,[i("button",{class:"primary gradient",type:"button",disabled:!h.value,onClick:t[8]||(t[8]=e=>st(!0))}," 送到表单 ",8,ri),i("button",{class:"primary",type:"button",onClick:t[9]||(t[9]=e=>le(r.value))},"保存草案")])):c("",!0)])],4),(n(),Se(xe,{to:"body"},[Pe(Ie,{name:"fade"},{default:Ae(()=>[P.value?(n(),l("div",{key:0,class:"plan-preview-overlay",onClick:qt(Dt,["self"])},[i("section",ui,[i("header",ci,[i("div",null,[t[40]||(t[40]=i("p",{class:"plan-preview-label"},"AI 草案",-1)),i("p",pi,a(Kt.value),1)]),i("button",{type:"button",class:"plan-preview-close",onClick:Dt},[...t[41]||(t[41]=[i("span",{class:"i-lucide-x"},null,-1)])])]),i("div",di,[bt.value?(n(),l("article",vi,[t[42]||(t[42]=i("p",{class:"plan-preview-subtitle"},"活动亮点",-1)),i("p",yi,a(bt.value),1)])):c("",!0),i("div",hi,[_t.value?(n(),l("article",fi,[t[43]||(t[43]=i("p",{class:"plan-preview-subtitle"},"备注/准备",-1)),i("p",gi,a(_t.value),1)])):c("",!0),St.value?(n(),l("article",mi,[t[44]||(t[44]=i("p",{class:"plan-preview-subtitle"},"风险提示",-1)),i("p",ki,a(St.value),1)])):c("",!0)]),Ct.value.length?(n(),l("article",wi,[t[45]||(t[45]=i("p",{class:"plan-preview-subtitle"},"时间 & 地点",-1)),i("ul",bi,[(n(!0),l(_,null,S(Ct.value,e=>(n(),l("li",{key:`preview-logistics-${e.label}`},[i("strong",null,a(e.label)+"：",1),T(a(e.value),1)]))),128))])])):c("",!0),Tt.value.length?(n(),l("article",_i,[t[46]||(t[46]=i("p",{class:"plan-preview-subtitle"},"票务设置",-1)),i("ul",Si,[(n(!0),l(_,null,S(Tt.value,(e,p)=>(n(),l("li",{key:`preview-ticket-${p}`},[i("span",null,a(e.name),1),i("span",null,a(At(e.price)),1)]))),128))])])):c("",!0),$t.value.length?(n(),l("article",Ci,[t[47]||(t[47]=i("p",{class:"plan-preview-subtitle"},"参加要求",-1)),i("ul",Ti,[(n(!0),l(_,null,S($t.value,(e,p)=>(n(),l("li",{key:`preview-req-${p}`},a(e.label)+a(e.type==="must"?"（必需）":""),1))),128))])])):c("",!0),Pt.value.length?(n(),l("article",$i,[t[48]||(t[48]=i("p",{class:"plan-preview-subtitle"},"报名表字段",-1)),i("ul",Pi,[(n(!0),l(_,null,S(Pt.value,(e,p)=>(n(),l("li",{key:`preview-form-${p}`},a(e.label)+" · "+a(e.type)+a(e.required?"（必填）":""),1))),128))])])):c("",!0)])])])):c("",!0)]),_:1})]))],64))}}),Li=Me(Ai,[["__scopeId","data-v-7ff43c4f"]]);export{Li as default};
