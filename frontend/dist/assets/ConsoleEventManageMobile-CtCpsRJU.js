import{d as K,c as h,A as O,r as x,g as Q,o as W,b as n,h as t,i as b,t as l,j,y as E,n as P,F as _,f as w,w as X,an as Y,ao as Z,ap as tt,u as et,e as o}from"./index-CT-XDF2b.js";const st={key:0,class:"pb-24"},at={class:"bg-white rounded-2xl p-4 shadow-sm mx-3 mt-3"},lt={class:"flex items-start justify-between"},nt={class:"min-w-0"},ot={class:"text-sm font-semibold text-slate-900 leading-snug line-clamp-2"},it={class:"mt-1 text-[11px] text-slate-500 flex items-center"},ct={class:"mt-0.5 text-[11px] text-slate-500 flex items-center"},rt={key:0,class:"mt-3 mx-3 bg-white rounded-2xl p-4 shadow-sm"},ut={class:"flex items-center justify-between text-[11px] text-slate-500 mb-1"},dt={class:"text-slate-400"},mt={class:"w-full h-1.5 rounded-full bg-slate-100 overflow-hidden mb-2"},xt={class:"space-y-1.5 mt-2"},vt={class:"text-slate-600"},ft={class:"flex-1 mx-2 h-1 bg-slate-100 rounded-full overflow-hidden"},pt={class:"text-slate-900"},ht={class:"mt-3 flex items-center justify-between"},bt={class:"flex -space-x-2"},_t=["src"],wt=["onClick"],yt={class:"w-8 h-8 rounded-full bg-slate-200 overflow-hidden mr-2 flex-shrink-0"},gt=["src"],kt={key:1,class:"w-full h-full flex items-center justify-center text-[11px] text-slate-600"},Ct={class:"flex-1 min-w-0"},St={class:"flex items-center justify-between"},Tt={class:"text-xs font-medium text-slate-900 truncate"},jt={class:"mt-0.5 text-[10px] text-slate-400"},Et={key:0,class:"mt-2 text-center text-[11px] text-slate-400"},Pt={key:1,class:"text-[11px] text-slate-400 text-center mt-2"},Mt={class:"w-full bg-white rounded-t-2xl max-h-[70vh] p-4 overflow-y-auto"},Ut={class:"flex items-center mb-3"},Dt={class:"w-8 h-8 rounded-full bg-slate-200 overflow-hidden mr-2"},Lt=["src"],Rt={key:1,class:"w-full h-full flex items-center justify-center text-[11px] text-slate-600"},At={class:"text-sm font-semibold text-slate-900"},Bt={class:"text-[11px] text-slate-400"},Nt={key:1,class:"p-6 text-center text-slate-400"},$t=K({__name:"ConsoleEventManageMobile",setup(It){const M=O(),U=et(),v=h(()=>M.params.eventId),f=x(!0),u=x(null),d=x(null),y=x([]),i=x(null),g=x(null),c=h(()=>u.value?{id:u.value.id,title:Q(u.value.title),status:u.value.status,dateTimeText:G(u.value.startTime,u.value.endTime),locationText:u.value.locationText}:null),m=h(()=>{var T;if(!d.value)return null;const e=d.value.totalRegistrations,a=d.value.capacity??e,s=a?Math.min(100,Math.round(e/a*100)):0,p=((T=d.value.avatars)==null?void 0:T.slice(0,5))??[],H=d.value.groups??[];return{totalConfirmed:e,capacity:a,paidCount:d.value.paidRegistrations,progressPercent:s,sampleParticipants:p.map(r=>({id:r.userId,avatarUrl:r.avatarUrl??"https://placehold.co/64x64?text=Member"})),tickets:H.map(r=>({id:r.label,name:r.label,confirmed:r.count,capacity:r.capacity??a,progressPercent:r.capacity?Math.min(100,Math.round(r.count/r.capacity*100)):s}))}}),k=h(()=>y.value.map(D));function D(e){var a,s;return{id:e.registrationId,name:e.user.name||"ゲスト",avatarUrl:e.user.avatarUrl??void 0,initials:((a=e.user.name)==null?void 0:a.charAt(0).toUpperCase())??"U",ticketName:((s=e.ticket)==null?void 0:s.name)??"未設定",paymentStatus:e.paymentStatus,attended:e.attended,noShow:e.noShow,createdAtText:new Date(e.createdAt).toLocaleString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}}const L=async()=>{if(v.value){f.value=!0;try{const[e,a,s]=await Promise.all([Y(v.value),Z(v.value),tt(v.value)]);u.value=e,d.value=a,y.value=s.items}finally{f.value=!1}}},R=()=>{c.value&&window.open(`/events/${c.value.id}`,"_blank")},A=()=>{c.value&&U.push({path:`/console/events/${c.value.id}/edit`})},B=e=>{switch(e){case"open":return"受付中";case"closed":return"終了";default:return"下書き"}},N=e=>{switch(e){case"open":return"bg-emerald-100 text-emerald-700";case"closed":return"bg-slate-100 text-slate-500";default:return"bg-amber-100 text-amber-700"}},C=e=>{if(e.attended)return"出席済み";if(e.noShow)return"無断欠席";switch(e.paymentStatus){case"paid":return"支払済み";case"unpaid":return"未払い";default:return e.paymentStatus}},I=e=>e.attended?"bg-emerald-100 text-emerald-700":e.noShow?"bg-rose-100 text-rose-600":e.paymentStatus==="paid"?"bg-slate-800 text-white":"bg-slate-100 text-slate-500",V=()=>{var e;(e=g.value)==null||e.scrollIntoView({behavior:"smooth"})},$=e=>{i.value=e},S=()=>{i.value=null},z=()=>{console.log("Viewing entry detail",i.value)},J=()=>{console.log("Mark check-in",i.value)},F=()=>{console.log("Cancel entry",i.value)},q=()=>{console.log("Start refund",i.value)},G=(e,a)=>{const s=new Date(e).toLocaleString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});if(!a)return s;const p=new Date(a).toLocaleString("ja-JP",{hour:"2-digit",minute:"2-digit"});return`${s}〜${p}`};return W(()=>{L()}),(e,a)=>c.value?(o(),n("div",st,[t("section",at,[t("div",lt,[t("div",nt,[t("h1",ot,l(c.value.title),1),t("p",it,[a[0]||(a[0]=t("span",{class:"i-lucide-calendar mr-1"},null,-1)),j(l(c.value.dateTimeText),1)]),t("p",ct,[a[1]||(a[1]=t("span",{class:"i-lucide-map-pin mr-1"},null,-1)),j(l(c.value.locationText),1)])]),t("span",{class:E(["ml-2 px-2 py-0.5 rounded-full text-[11px]",N(c.value.status)])},l(B(c.value.status)),3)]),t("div",{class:"mt-3 flex gap-2 text-xs"},[t("button",{class:"flex-1 py-1.5 rounded-full border border-slate-200 text-slate-700",onClick:R}," 前台ページを見る "),t("button",{class:"flex-1 py-1.5 rounded-full bg-slate-900 text-white",onClick:A}," イベントを編集 ")])]),m.value?(o(),n("section",rt,[a[2]||(a[2]=t("h2",{class:"text-xs font-semibold text-slate-600 mb-2"},"申込状況",-1)),t("div",ut,[t("span",null,"合計 "+l(m.value.totalConfirmed)+"/"+l(m.value.capacity)+" 人",1),t("span",dt,l(m.value.paidCount)+" 人 支払い済み",1)]),t("div",mt,[t("div",{class:"h-full bg-[#00B900]",style:P({width:m.value.progressPercent+"%"})},null,4)]),t("div",xt,[(o(!0),n(_,null,w(m.value.tickets,s=>(o(),n("div",{key:s.id,class:"flex items-center justify-between text-[11px]"},[t("span",vt,l(s.name),1),t("div",ft,[t("div",{class:"h-full bg-emerald-400",style:P({width:s.progressPercent+"%"})},null,4)]),t("span",pt,l(s.confirmed)+"/"+l(s.capacity),1)]))),128))]),t("div",ht,[t("div",bt,[(o(!0),n(_,null,w(m.value.sampleParticipants,s=>(o(),n("img",{key:s.id,src:s.avatarUrl,class:"w-6 h-6 rounded-full border border-white object-cover",alt:"participant"},null,8,_t))),128))]),t("button",{class:"text-[11px] text-[#00B900]",onClick:V}," 参加者一覧を見る ")])])):b("",!0),t("section",{class:"mt-3 mx-3 bg-white rounded-2xl p-4 shadow-sm",ref_key:"memberListRef",ref:g},[a[3]||(a[3]=t("h2",{class:"text-xs font-semibold text-slate-600 mb-2"},"参加者一覧",-1)),(o(!0),n(_,null,w(k.value,s=>(o(),n("div",{key:s.id,class:"flex items-center py-2 px-2 -mx-2 rounded-xl active:bg-slate-50",onClick:p=>$(s)},[t("div",yt,[s.avatarUrl?(o(),n("img",{key:0,src:s.avatarUrl,class:"w-full h-full object-cover",alt:""},null,8,gt)):(o(),n("span",kt,l(s.initials),1))]),t("div",Ct,[t("div",St,[t("p",Tt,l(s.name),1),t("span",{class:E(["ml-2 px-2 py-0.5 text-[10px] rounded-full",I(s)])},l(C(s)),3)]),t("p",jt,l(s.ticketName)+" · "+l(s.createdAtText),1)])],8,wt))),128)),!k.value.length&&!f.value?(o(),n("div",Et," まだ参加者がいません。 ")):b("",!0),f.value?(o(),n("p",Pt,"読み込み中...")):b("",!0)],512),i.value?(o(),n("div",{key:1,class:"fixed inset-0 bg-black/40 flex items-end z-50",onClick:X(S,["self"])},[t("div",Mt,[a[4]||(a[4]=t("div",{class:"w-10 h-1.5 bg-slate-300 rounded-full mx-auto mb-3"},null,-1)),t("div",Ut,[t("div",Dt,[i.value.avatarUrl?(o(),n("img",{key:0,src:i.value.avatarUrl,class:"w-full h-full object-cover",alt:""},null,8,Lt)):(o(),n("span",Rt,l(i.value.initials),1))]),t("div",null,[t("p",At,l(i.value.name),1),t("p",Bt,l(i.value.ticketName)+" · "+l(C(i.value)),1)])]),t("button",{class:"w-full py-2 text-sm text-left border-b",onClick:z},"詳細を見る"),t("button",{class:"w-full py-2 text-sm text-left border-b",onClick:J},"チェックインにする"),t("button",{class:"w-full py-2 text-sm text-left border-b",onClick:F},"申込を取消"),t("button",{class:"w-full py-2 text-sm text-left text-rose-600",onClick:q},"返金を開始"),t("button",{class:"w-full mt-2 py-2 text-sm text-center rounded-full bg-slate-100 text-slate-600",onClick:S}," 閉じる ")])])):b("",!0)])):(o(),n("div",Nt,"読み込み中..."))}});export{$t as default};
