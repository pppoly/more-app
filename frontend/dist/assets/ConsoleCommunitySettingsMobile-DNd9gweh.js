import{d as Z,A as ee,B as le,r as u,c as se,o as oe,b as r,h as l,q as $,u as te,t as p,i as P,v as h,x as _,F as H,f as N,w as ae,a8 as ne,a as I,g as ie,aa as W,ab as re,e as d,K as de,_ as ce}from"./index-CT-XDF2b.js";const ue={class:"community-settings"},pe={class:"hero-card"},ve={class:"hero-text"},me={class:"hero-status"},ge={class:"form-card"},be={class:"ios-field"},fe={class:"ios-field"},ye={class:"form-card"},he={class:"ios-field"},we={key:0,class:"chip-row"},Ue={class:"form-card"},_e={class:"radio-group"},Ie=["value"],Ce={class:"radio-content"},ke={class:"radio-title"},Le={class:"radio-desc"},xe={class:"form-card"},Fe={class:"upload-grid"},De={class:"upload-card"},Ee={key:0,class:"upload-preview"},Me=["src"],Ve={key:1,class:"upload-empty"},Ae={class:"upload-card"},Se={key:0,class:"upload-preview"},Be=["src"],je={key:1,class:"upload-empty"},Re={class:"form-card"},Te={key:0,class:"form-error"},$e={class:"form-footer"},Pe=["disabled"],He=["disabled"],Ne=Z({__name:"ConsoleCommunitySettingsMobile",setup(We){const q=ee(),D=te(),w=q.params.communityId,s=le({name:"",slug:"",labels:"",visibleLevel:"public",coverImageUrl:"",logoImageUrl:"",description:""}),v=u(null),m=u(null),E=u(null),M=u(null),C=u(!1),k=u(!1),g=u(!1),b=u(null),z=[{value:"public",label:"公開",desc:"誰でも閲覧できる"},{value:"semi-public",label:"社群限定",desc:"Console / 既存メンバーのみ"},{value:"private",label:"非公開",desc:"運営メモ用・外部非公開"}],L=se(()=>s.labels.split(",").map(o=>o.trim()).filter(Boolean)),V=async()=>{if(w)try{const o=await ne(w);s.name=o.name,s.slug=o.slug,s.labels=(o.labels||[]).join(", "),s.visibleLevel=o.visibleLevel??"public",s.coverImageUrl=o.coverImageUrl||"",v.value=s.coverImageUrl?I(s.coverImageUrl):null;const e=typeof o.description=="object"&&o.description?o.description:null;s.description=ie(o.description),s.logoImageUrl=(e==null?void 0:e.logoImageUrl)??"",m.value=s.logoImageUrl?I(s.logoImageUrl):null}catch(o){b.value=o instanceof Error?o.message:"社群情報の取得に失敗しました"}},K=()=>({original:s.description,lang:"ja",translations:{},logoImageUrl:s.logoImageUrl||null}),X=()=>{var o;return(o=E.value)==null?void 0:o.click()},Y=()=>{var o;return(o=M.value)==null?void 0:o.click()},A=(o,e,t)=>new Promise((n,a)=>{const c=new FileReader;c.onload=()=>{const i=new Image;i.onload=()=>{const{width:j,height:x}=i;let f=j,y=f/e;y>x&&(y=x,f=y*e);const O=(j-f)/2,Q=(x-y)/2,F=Math.min(t,f),R=F/e,U=document.createElement("canvas");U.width=F,U.height=R;const T=U.getContext("2d");if(!T){a(new Error("Canvas not supported"));return}T.drawImage(i,O,Q,f,y,0,0,F,R),n(U.toDataURL("image/jpeg",.85))},i.onerror=()=>a(new Error("Failed to load image")),i.src=c.result},c.onerror=()=>a(new Error("Failed to read file")),c.readAsDataURL(o)}),S=async(o,e)=>{const n=await(await fetch(o)).blob();return new File([n],e,{type:n.type||"image/jpeg"})},G=async o=>{var n;const t=(n=o.target.files)==null?void 0:n[0];if(!(!t||C.value)){C.value=!0;try{const a=await A(t,1.7777777777777777,1280);v.value=a;const c=await S(a,`cover-${Date.now()}.jpg`),{imageUrl:i}=await W(c,"cover");s.coverImageUrl=i,v.value=I(i)}catch(a){console.warn(a)}finally{C.value=!1}}},J=async o=>{var n;const t=(n=o.target.files)==null?void 0:n[0];if(!(!t||k.value)){k.value=!0;try{const a=await A(t,1,512);m.value=a;const c=await S(a,`logo-${Date.now()}.jpg`),{imageUrl:i}=await W(c,"logo");s.logoImageUrl=i,m.value=I(i)}catch(a){console.warn(a)}finally{k.value=!1}}},B=async()=>{if(!w)return;g.value=!0,b.value=null;const o={labels:L.value,visibleLevel:s.visibleLevel,coverImageUrl:s.coverImageUrl||null,logoImageUrl:s.logoImageUrl||null,description:K()};try{await re(w,o),await V()}catch(e){b.value=e instanceof Error?e.message:"更新に失敗しました"}finally{g.value=!1}};return oe(V),(o,e)=>(d(),r("div",ue,[l("header",pe,[l("button",{class:"hero-back",type:"button",onClick:e[0]||(e[0]=t=>$(D).back())},[...e[7]||(e[7]=[l("span",{class:"i-lucide-chevron-left"},null,-1)])]),l("div",ve,[e[8]||(e[8]=l("p",{class:"hero-eyebrow"},"社群設定",-1)),l("h1",null,p(s.name||"コミュニティ"),1),e[9]||(e[9]=l("p",{class:"hero-subtext"},"公開情報と AI が参照するプロフィールをここで管理します。",-1))]),l("span",me,p(s.visibleLevel==="private"?"非公開":"公開中"),1)]),l("form",{class:"form-sections",onSubmit:ae(B,["prevent"])},[l("section",ge,[e[12]||(e[12]=l("p",{class:"card-label"},"基本情報",-1)),l("div",be,[e[10]||(e[10]=l("label",null,"社群名称",-1)),h(l("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>s.name=t),type:"text",placeholder:"Tokyo Community...",disabled:""},null,512),[[_,s.name]])]),l("div",fe,[e[11]||(e[11]=l("label",null,"Slug",-1)),h(l("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>s.slug=t),type:"text",disabled:""},null,512),[[_,s.slug]])])]),l("section",ye,[e[14]||(e[14]=l("div",{class:"card-head"},[l("p",{class:"card-label"},"ラベル"),l("p",{class:"card-hint"},"活動領域やキーワードをカンマ区切りで追加")],-1)),l("div",he,[e[13]||(e[13]=l("label",null,"キーワード",-1)),h(l("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>s.labels=t),type:"text",placeholder:"多文化, 親子, コミュニティ"},null,512),[[_,s.labels]])]),L.value.length?(d(),r("div",we,[(d(!0),r(H,null,N(L.value,t=>(d(),r("span",{key:t,class:"chip"},p(t),1))),128))])):P("",!0)]),l("section",Ue,[e[15]||(e[15]=l("div",{class:"card-head"},[l("p",{class:"card-label"},"公開範囲"),l("p",{class:"card-hint"},"ユーザー側にどこまで表示するかを選びます")],-1)),l("div",_e,[(d(),r(H,null,N(z,t=>l("label",{key:t.value,class:"radio-tile"},[h(l("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>s.visibleLevel=n),value:t.value,type:"radio"},null,8,Ie),[[de,s.visibleLevel]]),l("div",Ce,[l("p",ke,p(t.label),1),l("p",Le,p(t.desc),1)])])),64))])]),l("section",xe,[e[20]||(e[20]=l("p",{class:"card-label"},"ビジュアル",-1)),l("div",Fe,[l("div",De,[e[17]||(e[17]=l("p",{class:"upload-title"},"ロゴ",-1)),l("div",{class:"upload-drop",onClick:Y},[l("input",{ref_key:"logoInput",ref:M,type:"file",accept:"image/*",class:"hidden-input",onChange:J},null,544),m.value?(d(),r("div",Ee,[l("img",{src:m.value,alt:"logo preview"},null,8,Me)])):(d(),r("div",Ve,[...e[16]||(e[16]=[l("span",{class:"i-lucide-image-plus"},null,-1),l("p",null,"タップしてアップロード",-1)])]))])]),l("div",Ae,[e[19]||(e[19]=l("p",{class:"upload-title"},"カバー画像",-1)),l("div",{class:"upload-drop",onClick:X},[l("input",{ref_key:"coverInput",ref:E,type:"file",accept:"image/*",class:"hidden-input",onChange:G},null,544),v.value?(d(),r("div",Se,[l("img",{src:v.value,alt:"cover preview"},null,8,Be)])):(d(),r("div",je,[...e[18]||(e[18]=[l("span",{class:"i-lucide-image-plus"},null,-1),l("p",null,"タップしてアップロード",-1)])]))])])])]),l("section",Re,[e[21]||(e[21]=l("div",{class:"card-head"},[l("p",{class:"card-label"},"社群紹介"),l("p",{class:"card-hint"},"AI の憲法/歓迎文にも引用されます")],-1)),h(l("textarea",{"onUpdate:modelValue":e[5]||(e[5]=t=>s.description=t),rows:"6",placeholder:"社群のビジョン・活動内容・歓迎する人などを記載してください。"},null,512),[[_,s.description]])]),b.value?(d(),r("p",Te,p(b.value),1)):P("",!0)],32),l("footer",$e,[l("button",{type:"button",class:"ghost-btn",disabled:g.value,onClick:e[6]||(e[6]=t=>$(D).back())},"戻る",8,Pe),l("button",{type:"button",class:"primary-btn",disabled:g.value,onClick:B},p(g.value?"保存中…":"保存する"),9,He)])]))}}),ze=ce(Ne,[["__scopeId","data-v-15508eb1"]]);export{ze as default};
