import{d as st,a6 as ot,r as g,c as d,a as M,g as at,C as D,o as nt,a8 as lt,b as l,h as t,i as k,t as c,j as F,y as v,F as T,f as N,w as it,z as ct,s as ut,m as rt,a9 as dt,u as vt,aa as mt,e as i,_ as pt}from"./index-BGcABSEi.js";const yt={class:"console-home"},Ct={class:"hero-card"},gt={class:"hero-heading"},bt=["src"],ht={class:"hero-title"},kt={class:"hero-role"},ft={class:"hero-stats"},_t={class:"hero-stat"},wt={class:"hero-stat"},St={class:"hero-stat"},xt={class:"action-grid"},It=["disabled"],Mt={class:"events-section"},Tt={class:"event-cards"},Et=["onClick"],Lt={class:"event-date"},At={class:"event-meta"},Pt={key:0,class:"event-empty"},Ut={class:"picker-sheet"},Rt={class:"picker-list"},Bt={key:0,class:"picker-empty"},Dt=["onClick"],Ft={class:"picker-name"},Nt={class:"picker-slug"},$t={key:0,class:"i-lucide-check"},Ot={key:0,class:"picker-empty"},m="https://raw.githubusercontent.com/moreard/dev-assets/main/socialmore/icon-action-default.png",Vt="https://raw.githubusercontent.com/moreard/dev-assets/main/socialmore/default-event.png",jt=st({__name:"ConsoleHomeMobile",setup(zt){const u=vt(),r=ot(),f=g([]),E=g(!1),h=g(!1),_=g(!1),y=g(null),C=d(()=>r.getActiveCommunity()),L=d(()=>r.communities.value),A=d(()=>r.activeCommunityId.value),$=d(()=>{var s;return((s=C.value)==null?void 0:s.name)??""}),o=d(()=>r.activeCommunityId.value),n=d(()=>!!o.value),O=d(()=>{var s;return y.value?y.value:(s=C.value)!=null&&s.coverImageUrl?M(C.value.coverImageUrl):"https://raw.githubusercontent.com/moreard/dev-assets/main/socialmore/default-community.png"}),V=d(()=>{var e;switch((e=C.value)==null?void 0:e.role){case"owner":return"主催者";case"admin":return"管理者";default:return"メンバー"}}),w=d(()=>({monthRevenueText:"¥0",eventCount:f.value.length,registrationCount:"--"})),P=d(()=>f.value.slice(0,5).map(s=>({id:s.id,title:at(s.title),status:s.status,dateTimeText:X(s.startTime,s.endTime),entrySummary:s.visibility==="public"?"公開イベント":"限定公開",coverUrl:s.coverImageUrl?M(s.coverImageUrl):Vt}))),S=async()=>{if(o.value){E.value=!0;try{f.value=await dt(o.value)}catch(s){console.error("Failed to load console events",s)}finally{E.value=!1}}};D(o,()=>{o.value&&S()});const j=async()=>{h.value=!0,!r.loaded.value&&!r.loading.value&&(_.value=!0,await r.loadCommunities(!0),_.value=!1)},z=s=>{r.setActiveCommunity(s),h.value=!1,I()},x=()=>{h.value=!1},U=()=>{u.push({name:"ConsoleMobileCommunityCreate"})},H=()=>{u.push({name:"ConsoleMobilePayout"})},J=()=>{u.push({name:"ConsoleMobileSubscription"})},R=()=>{o.value&&u.push({name:"ConsoleMobileCommunitySettings",params:{communityId:o.value}})},Q=()=>{var s;(s=C.value)!=null&&s.slug&&u.push({name:"community-portal",params:{slug:C.value.slug}})},q=()=>{u.push({name:"ConsoleTicketScanner"})},B=()=>{o.value&&u.push({name:"ConsoleMobileCommunityEvents",params:{communityId:o.value}})},G=s=>{u.push({name:"ConsoleMobileEventManage",params:{eventId:s}})},K=()=>{o.value&&u.push({name:"ConsoleMobileEventForm",params:{communityId:o.value}})},W=()=>{o.value&&u.push({name:"ConsoleMobileEventCreate",params:{communityId:o.value}})},X=(s,e)=>{const p=new Date(s).toLocaleString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});if(!e)return p;const a=new Date(e).toLocaleString("ja-JP",{hour:"2-digit",minute:"2-digit"});return`${p}〜${a}`},Y=s=>{switch(s){case"open":return"受付中";case"closed":return"終了";default:return"下書き"}},Z=s=>{switch(s){case"open":return"bg-emerald-100 text-emerald-700";case"closed":return"bg-slate-100 text-slate-500";default:return"bg-amber-100 text-amber-700"}},b=g(!1),tt=async()=>{if(!(!o.value||b.value)){b.value=!0;try{const{url:s}=await mt(o.value);window.open(s,"_blank")}catch(s){console.error("Failed to start Stripe onboarding",s),window.alert("Stripe 連携リンクの取得に失敗しました")}finally{b.value=!1}}};nt(async()=>{await r.loadCommunities(),o.value||r.ensureActiveCommunity(),o.value&&(S(),I())}),D(()=>o.value,(s,e)=>{s&&s!==e&&(S(),I()),s||(y.value=null)});const I=async()=>{if(!o.value){y.value=null;return}try{const s=await lt(o.value),e=typeof s.description=="object"&&s.description?s.description:null,p=(e==null?void 0:e.logoImageUrl)||s.coverImageUrl||null;y.value=p?M(p):null}catch{y.value=null}};return(s,e)=>{const p=rt("RouterLink");return i(),l("div",yt,[t("section",Ct,[t("div",gt,[t("img",{src:O.value,alt:"avatar",class:"hero-avatar",onClick:R},null,8,bt),t("div",{class:"hero-heading-text",onClick:R},[t("h1",ht,c($.value||"未選択のコミュニティ"),1),t("p",kt,c(n.value?`役割: ${V.value}`:"まずはコミュニティを登録"),1)]),n.value?(i(),l("button",{key:0,class:"hero-switch inline-switch",type:"button",onClick:j}," 切り替え ")):(i(),l("button",{key:1,class:"hero-switch hero-switch--primary",type:"button",onClick:U},[...e[0]||(e[0]=[t("span",{class:"i-lucide-sparkles"},null,-1),F(" コミュニティを作成 ",-1)])]))]),t("div",ft,[t("div",_t,[e[1]||(e[1]=t("p",null,"今月の収入",-1)),t("strong",null,c(n.value?w.value.monthRevenueText:"---"),1)]),t("div",wt,[e[2]||(e[2]=t("p",null,"今月のイベント",-1)),t("strong",null,c(n.value?w.value.eventCount:"--"),1)]),t("div",St,[e[3]||(e[3]=t("p",null,"申込数",-1)),t("strong",null,c(n.value?w.value.registrationCount:"--"),1)])])]),t("section",xt,[t("button",{class:"action-card",type:"button",onClick:U},[t("div",{class:"action-entry"},[t("div",{class:"action-icon"},[t("img",{src:m,alt:""})]),e[4]||(e[4]=t("div",null,[t("p",{class:"action-title"},"コミュニティ作成"),t("p",{class:"action-desc"},"新しいコミュニティを登録")],-1))])]),t("button",{class:v(["action-card",{"is-disabled":!n.value}]),type:"button",onClick:K},[t("div",{class:"action-entry"},[t("div",{class:"action-icon"},[t("img",{src:m,alt:""})]),e[5]||(e[5]=t("div",null,[t("p",{class:"action-title"},"新しいイベント"),t("p",{class:"action-desc"},"イベントを作成して公開")],-1))])],2),t("button",{class:v(["action-card",{"is-disabled":!n.value}]),type:"button",onClick:W},[t("div",{class:"action-entry"},[t("div",{class:"action-icon"},[t("img",{src:m,alt:""})]),e[6]||(e[6]=t("div",null,[t("p",{class:"action-title"},"AI イベント助手"),t("p",{class:"action-desc"},"SOCIALMORE 憲法で企画")],-1))])],2),t("button",{class:v(["action-card",{"is-disabled":!n.value}]),type:"button",onClick:B},[t("div",{class:"action-entry"},[t("div",{class:"action-icon"},[t("img",{src:m,alt:""})]),e[7]||(e[7]=t("div",null,[t("p",{class:"action-title"},"イベント管理"),t("p",{class:"action-desc"},"登録状況と参加者を確認")],-1))])],2),t("button",{class:v(["action-card",{"is-disabled":!n.value||b.value}]),type:"button",disabled:b.value,onClick:tt},[t("div",{class:"action-entry"},[t("div",{class:"action-icon"},[t("img",{src:m,alt:""})]),e[8]||(e[8]=t("div",null,[t("p",{class:"action-title"},"开通收款"),t("p",{class:"action-desc"},"Stripe 收款・入金")],-1))])],10,It),t("button",{class:v(["action-card",{"is-disabled":!n.value}]),type:"button",onClick:H},[t("div",{class:"action-entry"},[t("div",{class:"action-icon"},[t("img",{src:m,alt:""})]),e[9]||(e[9]=t("div",null,[t("p",{class:"action-title"},"収益と入金"),t("p",{class:"action-desc"},"入金設定・請求を確認")],-1))])],2),t("button",{class:v(["action-card",{"is-disabled":!n.value}]),type:"button",onClick:J},[t("div",{class:"action-entry"},[t("div",{class:"action-icon"},[t("img",{src:m,alt:""})]),e[10]||(e[10]=t("div",null,[t("p",{class:"action-title"},"プランと設定"),t("p",{class:"action-desc"},"プラン変更や通知設定")],-1))])],2),t("button",{class:v(["action-card",{"is-disabled":!n.value}]),type:"button",onClick:Q},[t("div",{class:"action-entry"},[t("div",{class:"action-icon"},[t("img",{src:m,alt:""})]),e[11]||(e[11]=t("div",null,[t("p",{class:"action-title"},"公開ページを見る"),t("p",{class:"action-desc"},"社群ポータルを確認（ユーザー側表示）")],-1))])],2),t("button",{class:v(["action-card",{"is-disabled":!n.value}]),type:"button",onClick:q},[t("div",{class:"action-entry"},[t("div",{class:"action-icon"},[t("img",{src:m,alt:""})]),e[12]||(e[12]=t("div",null,[t("p",{class:"action-title"},"验票扫码"),t("p",{class:"action-desc"},"ストアフロントでQRを読み取る")],-1))])],2)]),t("section",Mt,[t("div",{class:"section-head"},[e[13]||(e[13]=t("div",null,[t("p",{class:"section-label"},"イベントの進行状況"),t("h2",null,"最新イベント")],-1)),t("button",{class:"link-button",type:"button",onClick:B},"一覧を見る")]),t("div",Tt,[(i(!0),l(T,null,N(P.value,a=>(i(),l("button",{key:a.id,class:"event-card",type:"button",onClick:et=>G(a.id)},[t("div",{class:v(["event-status",Z(a.status)])},c(Y(a.status)),3),t("p",Lt,c(a.dateTimeText),1),t("h3",null,c(a.title),1),t("p",At,c(a.entrySummary),1)],8,Et))),128)),P.value.length?k("",!0):(i(),l("div",Pt," まだイベントがありません。新しい企画を始めましょう。 "))])]),h.value?(i(),l("div",{key:0,class:"picker-overlay",onClick:it(x,["self"])},[t("div",Ut,[t("header",{class:"picker-head"},[e[15]||(e[15]=t("p",{class:"picker-title"},"社群を切り替え",-1)),t("button",{type:"button",class:"picker-close",onClick:x},[...e[14]||(e[14]=[t("span",{class:"i-lucide-x"},null,-1)])])]),t("div",Rt,[_.value?(i(),l("div",Bt,"読み込み中…")):(i(),l(T,{key:1},[(i(!0),l(T,null,N(L.value,a=>(i(),l("button",{key:a.id,class:v(["picker-item",{"is-active":a.id===A.value}]),type:"button",onClick:et=>z(a.id)},[t("div",null,[t("p",Ft,c(a.name),1),t("p",Nt,"@"+c(a.slug),1)]),a.id===A.value?(i(),l("span",$t)):k("",!0)],10,Dt))),128)),L.value.length?k("",!0):(i(),l("p",Ot,"まだ社群がありません。")),ct(p,{class:"picker-add",to:{name:"ConsoleMobileCommunityCreate"},onClick:x},{default:ut(()=>[...e[16]||(e[16]=[t("span",{class:"i-lucide-plus"},null,-1),F(" 新しい社群を登録 ",-1)])]),_:1})],64))])])])):k("",!0)])}}}),Jt=pt(jt,[["__scopeId","data-v-3f951d06"]]);export{Jt as default};
