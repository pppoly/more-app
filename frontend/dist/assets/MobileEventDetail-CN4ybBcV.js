import{c,r as p,d as Be,y as Ne,u as ze,l as Oe,z as Je,g as j,A as N,o as je,a as o,b as i,h,t as d,F as b,e as a,i as ce,f as x,n as S,j as I,B as He,C as qe,D as Ve,E as Ge,_ as Ke}from"./index-BPws346P.js";const de="moreapp_favorites";function me(){return typeof window<"u"&&typeof window.localStorage<"u"}const f=p([]);let ve=!1;const Ye=()=>{if(!(ve||!me())){ve=!0;try{const u=window.localStorage.getItem(de);f.value=u?JSON.parse(u):[]}catch(u){console.warn("Failed to load favorites",u),f.value=[]}}},pe=()=>{if(me())try{window.localStorage.setItem(de,JSON.stringify(f.value))}catch(u){console.warn("Failed to save favorites",u)}},ge=u=>u?f.value.some(_=>_.id===u):!1,he=u=>{if(!u.id)return;const _=f.value.findIndex(w=>w.id===u.id);_>=0?f.value[_]=u:f.value.unshift(u),pe()},fe=u=>{f.value=f.value.filter(_=>_.id!==u),pe()},We=u=>{ge(u.id)?fe(u.id):he(u)};function Ze(){Ye();const u=c(()=>f.value.length);return{favorites:f,favoriteCount:u,isFavorite:ge,addFavorite:he,removeFavorite:fe,toggleFavorite:We}}const Qe={class:"event-detail-page"},Xe={key:0,class:"event-state m-text-meta"},et={key:1,class:"event-state error"},tt={class:"m-event-content event-content--with-footer"},at={class:"event-hero"},st={class:"event-carousel"},lt=["src","alt"],nt={key:2,class:"carousel-dots"},ot=["onClick"],it={class:"event-hero-info"},rt={class:"m-text-event-title-main"},ut={class:"event-hero-actions"},ct={key:0,class:"m-chip-row"},vt=["onClick"],dt={class:"m-event-card event-meta-card"},mt={class:"event-schedule-block"},pt={class:"event-meta-row event-meta-row--schedule"},gt={class:"event-schedule"},ht={class:"event-schedule__day"},ft={class:"event-schedule__time"},_t={key:0,class:"event-schedule__badge"},yt={class:"event-meta-row event-meta-row--location"},wt={class:"event-meta-text"},kt={class:"event-location-title"},bt={key:1,class:"event-section"},Tt={class:"m-event-card"},Ct={class:"event-progress-head"},xt={class:"event-progress"},St={key:0,class:"participant-wall"},$t={class:"participant-avatars"},Ut=["src","alt"],Dt={key:1},Ft={class:"sr-only"},Pt={class:"participants-hint"},It={key:1,class:"participants-empty"},Mt={class:"event-section"},Lt={class:"m-event-card event-group-card"},Et={class:"group-main"},At=["disabled"],Rt={class:"group-text"},Bt={class:"group-name"},Nt={key:0,class:"i-lucide-bell-minus"},zt={key:1,class:"i-lucide-bell-plus"},Ot={class:"event-section"},Jt={class:"m-event-card"},jt=["innerHTML"],Ht={key:2,class:"event-section"},qt={class:"m-event-card"},Vt={class:"event-requirements"},Gt={class:"event-footer"},Kt={class:"price-block"},Yt={class:"price"},Wt=["disabled"],Zt={class:"max-h-[80vh] w-[90vw] max-w-md overflow-y-auto rounded-3xl bg-white p-4"},Qt={class:"participant-list"},Xt={class:"participant-list__avatar"},ea=["src","alt"],ta={key:1},aa={class:"participant-list__name"},sa=Be({__name:"MobileEventDetail",setup(u){const _=Ne(),w=ze(),{user:_e}=Oe(),M=Ze(),s=p(null),L=p([]),z=p(!0),E=p(null);p(null),p(!1),p(!1),p(!1),p(null),p(null),p(!1),p(!1),Je({});const $=p(null),y=p(0),O=c(()=>_.params.eventId),A=c(()=>!!_e.value),H=c(()=>{var e;return((e=s.value)==null?void 0:e.registrationFormSchema)??[]}),ye=c(()=>{var t;const e=(t=n.value)==null?void 0:t.id;return e?M.isFavorite(e):!1}),n=c(()=>{var r,m,l,v,k,te,ae,se,le,ne,oe,ie,re,ue;if(!s.value)return null;const e=Q(s.value.startTime),t=s.value.endTime?Q(s.value.endTime):"未定";return{id:s.value.id,status:s.value.status,title:j(s.value.title),categoryLabel:s.value.category??"イベント",timeFullText:`${e} 〜 ${t}`,locationText:s.value.locationText,coverUrl:((r=L.value[0])==null?void 0:r.imageUrl)??"https://placehold.co/640x360?text=Event",regSummary:((m=s.value.config)==null?void 0:m.regSummary)??"参加状況を確認中",capacityText:s.value.maxParticipants?`定員 ${s.value.maxParticipants}名`:"定員未設定",regProgress:((l=s.value.config)==null?void 0:l.regProgress)??40,priceText:((v=s.value.config)==null?void 0:v.priceText)??"無料 / 未定",hostName:((k=s.value.community)==null?void 0:k.name)??"SOCIALMORE Community",communitySlug:((te=s.value.community)==null?void 0:te.slug)??null,descriptionHtml:s.value.descriptionHtml??`<p>${j(s.value.description??s.value.title)}</p>`,mapUrl:typeof s.value.locationLat=="number"&&typeof s.value.locationLng=="number"?`https://www.google.com/maps/dir/?api=1&destination=${s.value.locationLat},${s.value.locationLng}`:`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(s.value.locationText)}`,participants:Array.isArray((ae=s.value.config)==null?void 0:ae.participants)&&((le=(se=s.value.config)==null?void 0:se.participants)!=null&&le.length)?(ne=s.value.config)==null?void 0:ne.participants:[],participantCount:((oe=s.value.config)==null?void 0:oe.participantCount)??((re=(ie=s.value.config)==null?void 0:ie.participants)==null?void 0:re.length)??null,showParticipants:((ue=s.value.config)==null?void 0:ue.showRegistrationStatus)!==!1}}),g=c(()=>{var t;if(L.value.length)return L.value.map((r,m)=>({id:r.id??`gallery-${m}`,imageUrl:r.imageUrl}));const e=(t=n.value)==null?void 0:t.coverUrl;return e?[{id:"cover",imageUrl:e}]:[]}),q=c(()=>{var e,t,r;return g.value.length?((t=g.value[y.value])==null?void 0:t.imageUrl)??((r=g.value[0])==null?void 0:r.imageUrl)??"":((e=n.value)==null?void 0:e.coverUrl)??""}),we=c(()=>q.value?{backgroundImage:`url(${q.value})`}:{}),J=c(()=>{var v;if(!n.value||!((v=s.value)!=null&&v.startTime))return"";const e=ee(s.value.startTime),t=ee(s.value.endTime??s.value.startTime);if(!e||!t)return"";const r=encodeURIComponent(n.value.title),m=encodeURIComponent(n.value.locationText??""),l=encodeURIComponent(j(s.value.description??s.value.title)??n.value.title);return`https://calendar.google.com/calendar/render?action=TEMPLATE&text=${r}&dates=${e}/${t}&location=${m}&details=${l}`}),U=c(()=>{var m;if(!s.value)return[];const e={id:s.value.id,label:F(s.value.startTime),meta:X(s.value.startTime,s.value.endTime)},t=(s.value.occurrences??((m=s.value.config)==null?void 0:m.occurrences))||[],r=Array.isArray(t)?t.map((l,v)=>{var k;return{id:`occ-${v}`,label:F(l.start??l.startTime??((k=s.value)==null?void 0:k.startTime)),meta:X(l.start??l.startTime,l.end??l.endTime)}}):[];return[e,...r]});N(U,e=>{e.length&&!$.value&&($.value=e[0].id)},{immediate:!0});const V=c(()=>U.value.find(e=>e.id===$.value)??U.value[0]),R=c(()=>n.value?{id:n.value.id,title:n.value.title,coverUrl:n.value.coverUrl,timeText:n.value.timeFullText,locationText:n.value.locationText}:null),ke=c(()=>{var r,m;if(!((r=s.value)!=null&&r.startTime)||!((m=s.value)!=null&&m.endTime))return!1;const e=new Date(s.value.startTime),t=new Date(s.value.endTime);return e.toDateString()!==t.toDateString()}),G=c(()=>{var r;const e=((r=s.value)==null?void 0:r.status)??"draft";return{open:{label:"受付中",variant:"is-live"},pending:{label:"受付前",variant:"is-pending"},soldout:{label:"満席",variant:"is-soldout"},closed:{label:"受付終了",variant:"is-closed"},ended:{label:"終了",variant:"is-closed"},draft:{label:"準備中",variant:"is-pending"}}[e]??{label:"ステータス未設定",variant:"is-closed"}}),be=c(()=>{var e;return!!((e=n.value)!=null&&e.showParticipants)}),T=c(()=>{var e;return((e=n.value)==null?void 0:e.participants)??[]}),K=c(()=>{var e;return((e=n.value)==null?void 0:e.participantCount)??T.value.length??0}),C=c(()=>T.value.slice(0,20)),Te=c(()=>T.value.length>C.value.length),Ce=c(()=>Math.max(T.value.length-C.value.length,0)),xe=c(()=>K.value?`${K.value}名`:`${C.value.length}名`),B=p(!1),Se=async()=>{if(O.value){z.value=!0,E.value=null;try{const[e,t]=await Promise.all([Ve(O.value),Ge(O.value)]);s.value=e,L.value=t}catch(e){E.value=e instanceof Error?e.message:"イベント情報の取得に失敗しました"}finally{z.value=!1}}};N(()=>g.value.length,()=>{y.value=0});const $e=()=>{navigator.share&&n.value&&navigator.share({title:n.value.title,url:window.location.href}).catch(()=>{})},Ue=()=>{if(!(!n.value||!R.value)){if(!A.value){typeof window<"u"&&(window.localStorage.setItem("favorite:redirect",_.fullPath),window.localStorage.setItem("favorite:data",JSON.stringify(R.value))),w.push({name:"organizer-apply",query:{redirect:_.fullPath}});return}M.toggleFavorite(R.value)}},De=e=>{e<0||e>=g.value.length||(y.value=e)},Fe=()=>{g.value.length&&(y.value=(y.value-1+g.value.length)%g.value.length)},Pe=()=>{g.value.length&&(y.value=(y.value+1)%g.value.length)},Ie=()=>{J.value&&window.open(J.value,"_blank")},D=p(!1),Me=()=>{D.value=!D.value},Le=()=>{var e;(e=n.value)!=null&&e.communitySlug&&w.push({name:"community-portal",params:{slug:n.value.communitySlug}})},Y=e=>e?e.charAt(0).toUpperCase():"G",W=()=>{C.value.length&&(B.value=!0)},Z=()=>{B.value=!1},Ee=()=>{var e;(e=n.value)!=null&&e.mapUrl&&window.open(n.value.mapUrl,"_blank")},Ae=()=>{if(!n.value)return;const e={name:"MobileEventRegister",params:{eventId:n.value.id}},t=w.resolve(e).href;if(n.value.status==="open"){if(!A.value){typeof window<"u"&&window.localStorage.setItem("booking:redirect",t),w.push({name:"organizer-apply",query:{redirect:t}});return}w.push(e)}},Re=(e,t)=>e.id??`${e.label??"field"}-${t}`,Q=e=>new Date(e).toLocaleString("ja-JP",{month:"short",day:"numeric",weekday:"short",hour:"2-digit",minute:"2-digit"}),F=e=>e?new Date(e).toLocaleDateString("ja-JP",{month:"long",day:"numeric",weekday:"short"}):"",X=(e,t)=>{if(!e)return"";const r=new Date(e),m=r.toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"});if(!t)return`${F(e)} ${m} 開始`;const l=new Date(t),v=l.toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"});return r.toDateString()===l.toDateString()?`${m} - ${v}`:`${F(e)} ${m} 〜 ${F(t)} ${v}`},P=e=>e.toString().padStart(2,"0"),ee=e=>{if(!e)return"";const t=new Date(e);return`${t.getUTCFullYear()}${P(t.getUTCMonth()+1)}${P(t.getUTCDate())}T${P(t.getUTCHours())}${P(t.getUTCMinutes())}${P(t.getUTCSeconds())}Z`};return je(Se),N(()=>{var e;return[A.value,(e=n.value)==null?void 0:e.id]},()=>{if(!(typeof window>"u")&&A.value&&n.value&&R.value){const e=window.localStorage.getItem("favorite:data");if(e)try{const t=JSON.parse(e);t.id===n.value.id&&!M.isFavorite(t.id)&&M.addFavorite(t)}catch(t){console.warn("Failed to process pending favorite",t)}finally{window.localStorage.removeItem("favorite:data")}}},{immediate:!0}),N(T,e=>{e.length||(B.value=!1)},{immediate:!0}),(e,t)=>{var r,m;return i(),o("div",Qe,[z.value?(i(),o("div",Xe,"読み込み中...")):E.value?(i(),o("div",et,d(E.value),1)):n.value?(i(),o(b,{key:2},[a("main",tt,[a("section",at,[t[4]||(t[4]=a("div",{class:"event-hero__overlay"},null,-1)),a("div",{class:"event-cover-wrapper",style:ce(we.value)},[a("div",st,[(i(!0),o(b,null,x(g.value,(l,v)=>(i(),o("div",{key:l.id||l.imageUrl||v,class:S(["event-carousel__slide",{"is-active":v===y.value}])},[a("img",{src:l.imageUrl,class:"event-cover",alt:`event cover ${v+1}`},null,8,lt)],2))),128)),g.value.length>1?(i(),o("button",{key:0,class:"carousel-nav carousel-nav--prev",type:"button",onClick:Fe},[...t[0]||(t[0]=[a("span",{class:"i-lucide-chevron-left"},null,-1)])])):h("",!0),g.value.length>1?(i(),o("button",{key:1,class:"carousel-nav carousel-nav--next",type:"button",onClick:Pe},[...t[1]||(t[1]=[a("span",{class:"i-lucide-chevron-right"},null,-1)])])):h("",!0),g.value.length>1?(i(),o("div",nt,[(i(!0),o(b,null,x(g.value,(l,v)=>(i(),o("button",{key:l.id||l.imageUrl||`dot-${v}`,class:S(["carousel-dot",{"is-active":v===y.value}]),onClick:k=>De(v)},null,10,ot))),128))])):h("",!0)]),a("span",{class:S(["event-status-badge",G.value.variant])},d(G.value.label),3)],4),a("div",it,[a("h1",rt,d(n.value.title),1),a("div",ut,[a("button",{class:"event-action",type:"button",onClick:$e},[...t[2]||(t[2]=[a("span",{class:"i-lucide-share-2"},null,-1),I(" 共有する ",-1)])]),a("button",{class:S(["event-action",{"is-active":ye.value}]),type:"button",onClick:Ue},[...t[3]||(t[3]=[a("span",{class:"i-lucide-bookmark"},null,-1),I(" お気に入り ",-1)])],2)])])]),U.value.length>1?(i(),o("div",ct,[(i(!0),o(b,null,x(U.value,l=>(i(),o("button",{key:l.id,class:S(["m-chip",{"is-active":l.id===$.value}]),onClick:v=>$.value=l.id},d(l.label),11,vt))),128))])):h("",!0),a("section",dt,[a("div",mt,[a("div",pt,[t[5]||(t[5]=a("div",{class:"event-meta-icon"},[a("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none"},[a("rect",{x:"3",y:"4",width:"18",height:"17",rx:"3",stroke:"currentColor","stroke-width":"1.5"}),a("path",{d:"M3 9h18M8 2v4M16 2v4",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round"})])],-1)),a("div",gt,[a("p",ht,d(((r=V.value)==null?void 0:r.label)??n.value.timeFullText),1),a("p",ft,d(((m=V.value)==null?void 0:m.meta)??n.value.timeFullText),1)]),ke.value?(i(),o("span",_t,"複数日程")):h("",!0)]),J.value?(i(),o("button",{key:0,class:"event-schedule__cta",type:"button",onClick:Ie},[...t[6]||(t[6]=[a("span",{class:"i-lucide-calendar-plus"},null,-1),I(" カレンダーに追加 ",-1)])])):h("",!0)]),t[9]||(t[9]=a("div",{class:"m-divider"},null,-1)),a("div",yt,[t[8]||(t[8]=He('<div class="event-meta-icon" data-v-3498a396><svg width="20" height="20" viewBox="0 0 24 24" fill="none" data-v-3498a396><path d="M12 21c4.418 0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7 3.582 7 8 7z" stroke="currentColor" stroke-width="1.5" data-v-3498a396></path><path d="M12 11v6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" data-v-3498a396></path><path d="M7 3h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" data-v-3498a396></path></svg></div>',1)),a("div",wt,[a("div",kt,d(n.value.locationText),1)]),a("button",{class:"event-map-button",type:"button",onClick:Ee},[...t[7]||(t[7]=[a("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true"},[a("path",{d:"M12 21c4.418 0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7 3.582 7 8 7z",stroke:"currentColor","stroke-width":"1.5"}),a("path",{d:"M12 11v6",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round"}),a("path",{d:"M7 3h10",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round"})],-1),I(" ルートを見る ",-1)])])])]),be.value?(i(),o("section",bt,[t[10]||(t[10]=a("h2",{class:"m-section-title"},"参加状況",-1)),a("div",Tt,[a("div",Ct,[a("span",null,d(n.value.regSummary),1),a("span",null,d(n.value.capacityText),1)]),a("div",xt,[a("div",{class:"event-progress__bar",style:ce({width:`${n.value.regProgress}%`})},null,4)]),C.value.length?(i(),o("div",St,[a("div",$t,[(i(!0),o(b,null,x(C.value,l=>(i(),o("button",{key:l.id||l.name,class:"participant-avatar",type:"button",onClick:W},[l.avatarUrl?(i(),o("img",{key:0,src:l.avatarUrl,alt:l.name},null,8,Ut)):(i(),o("span",Dt,d(Y(l.name)),1)),a("span",Ft,d(l.name),1)]))),128)),Te.value?(i(),o("button",{key:0,class:"participant-more",type:"button",onClick:W}," +"+d(Ce.value),1)):h("",!0)]),a("p",Pt,"最近の参加者（"+d(xe.value)+"）",1)])):(i(),o("p",It,"表示できる参加者がまだいません。"))])])):h("",!0),a("section",Mt,[t[14]||(t[14]=a("h2",{class:"m-section-title"},"主催コミュニティ",-1)),a("div",Lt,[a("div",Et,[a("button",{class:"group-info",type:"button",onClick:Le,disabled:!n.value.communitySlug},[t[12]||(t[12]=a("div",{class:"group-avatar"},null,-1)),a("div",Rt,[a("div",Bt,d(n.value.hostName),1),t[11]||(t[11]=a("div",{class:"m-text-meta"},"最新ニュースとイベント情報",-1))])],8,At),a("button",{class:S(["group-follow",{"is-active":D.value}]),type:"button",onClick:Me},[D.value?(i(),o("span",Nt)):(i(),o("span",zt)),I(" "+d(D.value?"フォロー中":"フォロー"),1)],2)]),t[13]||(t[13]=a("p",{class:"group-hint"},"このコミュニティをフォローすると最新イベントやアナウンスを受け取れます。",-1))])]),a("section",Ot,[t[15]||(t[15]=a("h2",{class:"m-section-title"},"About",-1)),a("div",Jt,[a("div",{class:"m-text-body prose prose-sm max-w-none",innerHTML:n.value.descriptionHtml},null,8,jt)])]),H.value.length?(i(),o("section",Ht,[t[16]||(t[16]=a("h2",{class:"m-section-title"},"申込時の必須情報",-1)),a("div",qt,[a("ul",Vt,[(i(!0),o(b,null,x(H.value,(l,v)=>(i(),o("li",{key:Re(l,v)},"・"+d(l.label),1))),128))])])])):h("",!0)]),a("footer",Gt,[a("div",Kt,[a("p",Yt,d(n.value.priceText),1)]),a("button",{class:"rails-cta",type:"button",disabled:n.value.status!=="open",onClick:Ae},[a("span",null,d(n.value.status==="open"?"イベントに申し込む":"受付終了"),1)],8,Wt)])],64)):h("",!0),B.value?(i(),o("div",{key:3,class:"fixed inset-0 z-40 flex items-center justify-center bg-black/50",onClick:qe(Z,["self"])},[a("div",Zt,[a("div",{class:"mb-3 flex items-center justify-between"},[t[18]||(t[18]=a("h3",{class:"text-base font-semibold"},"参加者一覧",-1)),a("button",{class:"participant-close",type:"button",onClick:Z},[...t[17]||(t[17]=[a("span",{class:"i-lucide-x text-lg"},null,-1)])])]),a("ul",Qt,[(i(!0),o(b,null,x(T.value,l=>(i(),o("li",{key:l.id||l.name,class:"participant-list__item"},[a("div",Xt,[l.avatarUrl?(i(),o("img",{key:0,src:l.avatarUrl,alt:l.name},null,8,ea)):(i(),o("span",ta,d(Y(l.name)),1))]),a("div",aa,d(l.name||"ゲスト"),1)]))),128))])])])):h("",!0)])}}}),na=Ke(sa,[["__scopeId","data-v-3498a396"]]);export{na as default};
