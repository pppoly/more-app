import{d as M,r as v,c as _,A as S,C as B,o as F,b as a,h as s,t as e,F as p,f as g,u as L,ax as P,e as r,n as A,i as j,_ as E}from"./index-BGcABSEi.js";const J={class:"ai-detail"},R={class:"hero"},U={class:"hero-desc"},V={key:0,class:"error-card"},$={key:1,class:"loading-card"},z={key:2,class:"content"},T={class:"metrics-card"},W={class:"metric-grid"},q={class:"metric"},G={class:"metric"},H={class:"metric"},K={class:"metric"},O={class:"metric"},Q={class:"metric"},X={class:"metric"},Y={class:"card breakdown-card"},Z={class:"breakdown"},ss={class:"bar"},ts={class:"card breakdown-card"},es={class:"breakdown"},ls={class:"bar bar--secondary"},ns={class:"card session-card"},os={class:"session-list"},as={class:"session-community"},rs={class:"session-user"},us={class:"session-meta"},is={key:0,class:"session-summary"},ds={class:"session-turns"},cs=M({__name:"AdminAiModuleDetail",setup(ms){const C=L(),D=S(),o=v(null),d=v(null),b=v(!1),c=_(()=>D.params.moduleId),i=n=>typeof n!="number"?"-":new Intl.NumberFormat("ja-JP").format(n),y=n=>n?new Date(n).toLocaleString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):null,h=_(()=>{var n;return((n=o.value)==null?void 0:n.breakdown.stage.reduce((t,u)=>t+u.count,0))??0}),f=_(()=>{var n;return((n=o.value)==null?void 0:n.breakdown.language.reduce((t,u)=>t+u.count,0))??0}),N=n=>h.value?`${Math.round(n/h.value*100)}%`:"0%",x=n=>f.value?`${Math.round(n/f.value*100)}%`:"0%",I=()=>{C.back()},m=async()=>{if(c.value){b.value=!0,d.value=null;try{o.value=await P(c.value)}catch(n){console.error(n),d.value="无法加载该模块的使用数据。"}finally{b.value=!1}}};return B(c,()=>{o.value=null,m()}),F(()=>{m()}),(n,t)=>{var u,k,w;return r(),a("main",J,[s("section",R,[s("button",{type:"button",class:"ghost-button",onClick:I},[...t[0]||(t[0]=[s("span",{class:"i-lucide-chevron-left"},null,-1)])]),t[1]||(t[1]=s("p",{class:"hero-eyebrow"},"AI 模块",-1)),s("h1",null,e(((u=o.value)==null?void 0:u.module.name)??"加载中…"),1),s("p",U,e(((k=o.value)==null?void 0:k.module.description)??"正在获取最新数据"),1)]),d.value?(r(),a("section",V,[s("p",null,e(d.value),1),s("button",{type:"button",onClick:m},"重试")])):o.value?(r(),a("section",z,[s("section",T,[t[10]||(t[10]=s("h2",null,"关键指标",-1)),s("div",W,[s("div",q,[t[3]||(t[3]=s("p",null,"会话总数",-1)),s("strong",null,e(i(o.value.metrics.totalLogs)),1)]),s("div",G,[t[4]||(t[4]=s("p",null,"24h",-1)),s("strong",null,e(i(o.value.metrics.last24h)),1)]),s("div",H,[t[5]||(t[5]=s("p",null,"7天",-1)),s("strong",null,e(i(o.value.metrics.last7d)),1)]),s("div",K,[t[6]||(t[6]=s("p",null,"活跃社群",-1)),s("strong",null,e(i(o.value.metrics.activeCommunities)),1)]),s("div",O,[t[7]||(t[7]=s("p",null,"活跃用户",-1)),s("strong",null,e(i(o.value.metrics.activeUsers)),1)]),s("div",Q,[t[8]||(t[8]=s("p",null,"平均轮次",-1)),s("strong",null,e(((w=o.value.metrics.avgTurns)==null?void 0:w.toFixed(1))??"-"),1)]),s("div",X,[t[9]||(t[9]=s("p",null,"最新记录",-1)),s("strong",null,e(y(o.value.metrics.lastActivityAt)??"—"),1)])])]),s("section",Y,[t[11]||(t[11]=s("header",null,[s("div",null,[s("p",{class:"section-eyebrow"},"阶段占比"),s("h3",null,"Coach / Editor / Writer")])],-1)),s("div",Z,[(r(!0),a(p,null,g(o.value.breakdown.stage,l=>(r(),a("div",{key:l.label,class:"breakdown-row"},[s("p",null,e(l.label),1),s("div",ss,[s("div",{class:"fill",style:A({width:N(l.count)})},null,4)]),s("span",null,e(l.count),1)]))),128))])]),s("section",ts,[t[12]||(t[12]=s("header",null,[s("div",null,[s("p",{class:"section-eyebrow"},"语言分布"),s("h3",null,"用户输入语言")])],-1)),s("div",es,[(r(!0),a(p,null,g(o.value.breakdown.language,l=>(r(),a("div",{key:l.label,class:"breakdown-row"},[s("p",null,e(l.label),1),s("div",ls,[s("div",{class:"fill",style:A({width:x(l.count)})},null,4)]),s("span",null,e(l.count),1)]))),128))])]),s("section",ns,[t[13]||(t[13]=s("header",null,[s("div",null,[s("p",{class:"section-eyebrow"},"最近会话"),s("h3",null,"最新 25 条")])],-1)),s("div",os,[(r(!0),a(p,null,g(o.value.recentSessions,l=>(r(),a("article",{key:l.id,class:"session-row"},[s("div",null,[s("p",as,e(l.communityName),1),s("p",rs,e(l.userName),1),s("p",us,e(y(l.createdAt))+" · "+e(l.stage??"未知阶段")+" · "+e(l.status??"状态未知"),1),l.summary?(r(),a("p",is,e(l.summary),1)):j("",!0)]),s("span",ds,e(l.turnCount??"-")+" 回合",1)]))),128))])])])):(r(),a("section",$,[...t[2]||(t[2]=[s("p",null,"数据加载中...",-1)])]))])}}}),_s=E(cs,[["__scopeId","data-v-7c5e73ee"]]);export{_s as default};
