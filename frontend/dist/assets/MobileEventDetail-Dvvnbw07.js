import{d as Ge,A as Ye,u as Ke,l as Ze,r as m,B as Qe,c,a as _e,g as K,C as A,o as We,b as i,e as r,i as h,D as ye,t as v,F as _,h as a,n as Z,f as C,y as $,j as Q,w as ke,E as Xe,G as et,H as tt,_ as at}from"./index-BGcABSEi.js";import{u as st}from"./useFavorites-jHI8j8eS.js";const nt={class:"event-detail-page"},lt={key:0,class:"event-skeleton"},ot={key:1,class:"event-state error"},it={class:"m-event-content event-content--with-footer"},rt={class:"event-hero"},ut={class:"event-carousel"},ct=["src","alt"],vt={key:2,class:"carousel-dots"},dt=["onClick"],mt={class:"event-hero-info"},pt={class:"m-text-event-title-main"},ht={class:"event-hero-meta"},gt={class:"event-hero-meta__left"},ft={class:"view-count"},_t={class:"event-hero-actions"},yt={key:0,class:"event-hero-toast"},kt={key:0,class:"m-chip-row"},wt=["onClick"],bt={class:"m-event-card event-meta-card"},Tt={class:"event-schedule-block"},Ct={class:"event-meta-row event-meta-row--schedule"},$t={class:"event-schedule"},St={class:"event-schedule__day"},Ut={class:"event-schedule__time"},xt={key:0,class:"event-schedule__badge"},Mt={class:"event-meta-row event-meta-row--location"},Dt={class:"event-meta-text"},At={class:"event-location-title"},Pt={key:1,class:"event-section"},It={class:"m-event-card"},Lt={class:"event-progress-head"},Ft={class:"event-progress"},Et={key:0,class:"participant-wall"},Rt={class:"participant-avatars"},Nt=["src","alt"],Bt={key:1},zt={class:"sr-only"},Ht={class:"participants-hint"},Ot={key:1,class:"participants-empty"},Jt={class:"event-section"},jt={class:"m-event-card event-group-card"},Vt={class:"group-main"},qt=["disabled"],Gt={class:"group-text"},Yt={class:"group-name"},Kt={key:0,class:"i-lucide-bell-minus"},Zt={key:1,class:"i-lucide-bell-plus"},Qt={class:"event-section"},Wt={class:"m-event-card"},Xt=["innerHTML"],ea={key:2,class:"event-section"},ta={class:"m-event-card"},aa={class:"event-requirements"},sa={class:"event-footer"},na={class:"price-block"},la={class:"price"},oa=["disabled"],ia={class:"participant-sheet__body"},ra={class:"participant-list"},ua={class:"participant-list__avatar"},ca=["src","alt"],va={key:1},da={class:"participant-list__name"},ma=Ge({__name:"MobileEventDetail",setup(pa){const j=Ye(),P=Ke(),{user:I}=Ze(),L=st(),o=m(null),F=m([]),V=m(!0),E=m(null);m(null),m(!1),m(!1),m(!1),m(null),m(null),m(!1),m(!1),Qe({});const S=m(null),g=m(0),U=m(null),R=m(!1),f=c(()=>j.params.eventId),q=c(()=>!!I.value),W=c(()=>{var e;return((e=o.value)==null?void 0:e.registrationFormSchema)??[]}),X=c(()=>{var t;const e=(t=n.value)==null?void 0:t.id;return e?L.isFavorite(e):!1}),N=c(()=>!!U.value),we=c(()=>{var e;return R.value&&!N.value?"読み込み中…":N.value?"申込済み・チケットを見る":((e=n.value)==null?void 0:e.status)==="open"?"イベントに申し込む":"受付終了"}),be=c(()=>N.value?!1:n.value?n.value.status!=="open"||R.value:!0),n=c(()=>{var de,me,pe,he,ge,fe;if(!o.value)return null;const e=ie(o.value.startTime),t=o.value.endTime?ie(o.value.endTime):"未定",l=o.value.config??{},d="https://raw.githubusercontent.com/moreard/dev-assets/main/socialmore/default-avatar.png",s=Math.max(0,Number(l.currentParticipants??l.currentAttendees??l.regCount??0)),u=typeof o.value.maxParticipants=="number"?o.value.maxParticipants:l.capacity??null,b=typeof l.regSummary=="string"&&l.regSummary.trim().length?l.regSummary:`${s}名が参加予定`,je=u&&u>0?Math.min(100,Math.round(s/u*100)):0,ce=Array.isArray(l.attendeeAvatars)?l.attendeeAvatars:[],ve=Array.isArray(l.participants)?l.participants:[],Ve=(ve.length>0?ve:ce.map((T,J)=>({id:`avatar-${J}`,name:`参加者${J+1}`,avatarUrl:T}))).map((T,J)=>({id:T.id??`participant-${J}`,name:T.name??"ゲスト",avatarUrl:T.avatarUrl?_e(T.avatarUrl):""})),qe=l.participantCount??((de=l.participants)==null?void 0:de.length)??ce.length??(u?Math.min(s,u):s);return{id:o.value.id,status:o.value.status,title:K(o.value.title),categoryLabel:o.value.category??"イベント",timeFullText:`${e} 〜 ${t}`,locationText:o.value.locationText,coverUrl:((me=F.value[0])==null?void 0:me.imageUrl)??"https://placehold.co/640x360?text=Event",regSummary:b,capacityText:u?`定員 ${u}名・現在 ${s}名`:`現在 ${s}名`,regProgress:je,priceText:((pe=o.value.config)==null?void 0:pe.priceText)??"無料 / 未定",hostName:((he=o.value.community)==null?void 0:he.name)??"SOCIALMORE Community",communitySlug:((ge=o.value.community)==null?void 0:ge.slug)??null,communityAvatar:_e(l.communityLogoUrl||((fe=o.value.community)==null?void 0:fe.coverImageUrl)||l.communityLogo||l.communityAvatar)||d,descriptionHtml:o.value.descriptionHtml??`<p>${K(o.value.description??o.value.title)}</p>`,mapUrl:typeof o.value.locationLat=="number"&&typeof o.value.locationLng=="number"?`https://www.google.com/maps/dir/?api=1&destination=${o.value.locationLat},${o.value.locationLng}`:`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(o.value.locationText)}`,participantCount:qe,showParticipants:l.showRegistrationStatus!==!1,config:l,participants:Ve}}),p=c(()=>{var t;if(F.value.length)return F.value.map((l,d)=>({id:l.id??`gallery-${d}`,imageUrl:l.imageUrl}));const e=(t=n.value)==null?void 0:t.coverUrl;return e?[{id:"cover",imageUrl:e}]:[]}),ee=c(()=>{var e,t,l;return p.value.length?((t=p.value[g.value])==null?void 0:t.imageUrl)??((l=p.value[0])==null?void 0:l.imageUrl)??"":((e=n.value)==null?void 0:e.coverUrl)??""}),Te=c(()=>ee.value?{backgroundImage:`url(${ee.value})`}:{}),G=c(()=>{var u;if(!n.value||!((u=o.value)!=null&&u.startTime))return"";const e=ue(o.value.startTime),t=ue(o.value.endTime??o.value.startTime);if(!e||!t)return"";const l=encodeURIComponent(n.value.title),d=encodeURIComponent(n.value.locationText??""),s=encodeURIComponent(K(o.value.description??o.value.title)??n.value.title);return`https://calendar.google.com/calendar/render?action=TEMPLATE&text=${l}&dates=${e}/${t}&location=${d}&details=${s}`}),x=c(()=>{var d;if(!o.value)return[];const e={id:o.value.id,label:M(o.value.startTime),meta:re(o.value.startTime,o.value.endTime)},t=(o.value.occurrences??((d=o.value.config)==null?void 0:d.occurrences))||[],l=Array.isArray(t)?t.map((s,u)=>{var b;return{id:`occ-${u}`,label:M(s.start??s.startTime??((b=o.value)==null?void 0:b.startTime)),meta:re(s.start??s.startTime,s.end??s.endTime)}}):[];return[e,...l]});A(x,e=>{e.length&&!S.value&&(S.value=e[0].id)},{immediate:!0});const te=c(()=>x.value.find(e=>e.id===S.value)??x.value[0]),B=c(()=>n.value?{id:n.value.id,title:n.value.title,coverUrl:n.value.coverUrl,timeText:n.value.timeFullText,locationText:n.value.locationText}:null),Ce=c(()=>{var l,d;if(!((l=o.value)!=null&&l.startTime)||!((d=o.value)!=null&&d.endTime))return!1;const e=new Date(o.value.startTime),t=new Date(o.value.endTime);return e.toDateString()!==t.toDateString()}),ae=c(()=>{var l;const e=((l=o.value)==null?void 0:l.status)??"draft";return{open:{label:"受付中",variant:"is-live"},pending:{label:"受付前",variant:"is-pending"},soldout:{label:"満席",variant:"is-soldout"},closed:{label:"受付終了",variant:"is-closed"},ended:{label:"終了",variant:"is-closed"},draft:{label:"準備中",variant:"is-pending"}}[e]??{label:"ステータス未設定",variant:"is-closed"}}),$e=c(()=>{var l,d,s,u;const e=((d=(l=n.value)==null?void 0:l.config)==null?void 0:d.viewCount)??((u=(s=n.value)==null?void 0:s.config)==null?void 0:u.views)??0;return`${typeof e=="number"&&!Number.isNaN(e)?e:0}人想去`}),Se=c(()=>{var e;return!!((e=n.value)!=null&&e.showParticipants)}),y=c(()=>{var e;return((e=n.value)==null?void 0:e.participants)??[]}),se=c(()=>{var e;return((e=n.value)==null?void 0:e.participantCount)??y.value.length??0}),k=c(()=>y.value.slice(0,20)),Ue=c(()=>y.value.length>k.value.length),xe=c(()=>Math.max(y.value.length-k.value.length,0)),Me=c(()=>se.value?`${se.value}名`:`${k.value.length}名`),z=m(!1),De=async()=>{if(f.value){V.value=!0,E.value=null;try{const[e,t]=await Promise.all([Xe(f.value),et(f.value)]);o.value=e,F.value=t}catch(e){E.value=e instanceof Error?e.message:"イベント情報の取得に失敗しました"}finally{V.value=!1}}},Ae=async()=>{if(!I.value||!f.value){U.value=null;return}R.value=!0;try{const e=await tt();U.value=e.find(t=>t.event.id===f.value)??null}catch{U.value=null}finally{R.value=!1}};A(()=>p.value.length,()=>{g.value=0});const Pe=async()=>{var l;if(!n.value)return;const e={title:n.value.title,url:window.location.href};if(navigator.share)try{await navigator.share(e),O("已分享");return}catch{}const t=`https://social-plugins.line.me/lineit/share?url=${encodeURIComponent(e.url)}`;window.open(t,"_blank"),O("已打开 LINE 分享");try{(l=navigator.clipboard)!=null&&l.writeText&&await navigator.clipboard.writeText(e.url)}catch{}};let Y=null;const H=m(""),O=e=>{H.value=e,Y&&window.clearTimeout(Y),Y=window.setTimeout(()=>{H.value=""},2e3)},Ie=()=>{if(!(!n.value||!B.value)){if(!q.value){typeof window<"u"&&(window.localStorage.setItem("favorite:redirect",j.fullPath),window.localStorage.setItem("favorite:data",JSON.stringify(B.value))),P.push({name:"organizer-apply",query:{redirect:j.fullPath}});return}L.toggleFavorite(B.value),O(X.value?"已收藏":"已取消收藏")}},Le=e=>{e<0||e>=p.value.length||(g.value=e)},Fe=()=>{p.value.length&&(g.value=(g.value-1+p.value.length)%p.value.length)},Ee=()=>{p.value.length&&(g.value=(g.value+1)%p.value.length)},Re=()=>{G.value&&window.open(G.value,"_blank")},w=m(!1),Ne=()=>{w.value=!w.value,O(w.value?"已关注":"已取消关注")},Be=c(()=>{var t;const e=(t=n.value)==null?void 0:t.communityAvatar;return e?{backgroundImage:`url(${e})`,backgroundSize:"cover",backgroundPosition:"center",backgroundColor:"#f8fafc"}:{}}),ze=()=>{var e;(e=n.value)!=null&&e.communitySlug&&P.push({name:"community-portal",params:{slug:n.value.communitySlug}})},ne=e=>e?e.charAt(0).toUpperCase():"G",le=()=>{k.value.length&&(z.value=!0)},oe=()=>{z.value=!1},He=()=>{var e;(e=n.value)!=null&&e.mapUrl&&window.open(n.value.mapUrl,"_blank")},Oe=()=>{if(n.value){if(N.value){P.push({name:"my-events"});return}n.value.status==="open"&&P.push({name:"MobileEventRegister",params:{eventId:n.value.id}})}},Je=(e,t)=>e.id??`${e.label??"field"}-${t}`,ie=e=>new Date(e).toLocaleString("ja-JP",{month:"short",day:"numeric",weekday:"short",hour:"2-digit",minute:"2-digit"}),M=e=>e?new Date(e).toLocaleDateString("ja-JP",{month:"long",day:"numeric",weekday:"short"}):"",re=(e,t)=>{if(!e)return"";const l=new Date(e),d=l.toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"});if(!t)return`${M(e)} ${d} 開始`;const s=new Date(t),u=s.toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"});return l.toDateString()===s.toDateString()?`${d} - ${u}`:`${M(e)} ${d} 〜 ${M(t)} ${u}`},D=e=>e.toString().padStart(2,"0"),ue=e=>{if(!e)return"";const t=new Date(e);return`${t.getUTCFullYear()}${D(t.getUTCMonth()+1)}${D(t.getUTCDate())}T${D(t.getUTCHours())}${D(t.getUTCMinutes())}${D(t.getUTCSeconds())}Z`};return We(De),A(()=>{var e;return[(e=I.value)==null?void 0:e.id,f.value]},()=>{I.value&&f.value?Ae():U.value=null},{immediate:!0}),A(()=>{var e;return[q.value,(e=n.value)==null?void 0:e.id]},()=>{if(!(typeof window>"u")&&q.value&&n.value&&B.value){const e=window.localStorage.getItem("favorite:data");if(e)try{const t=JSON.parse(e);t.id===n.value.id&&!L.isFavorite(t.id)&&L.addFavorite(t)}catch(t){console.warn("Failed to process pending favorite",t)}finally{window.localStorage.removeItem("favorite:data")}}},{immediate:!0}),A(y,e=>{e.length||(z.value=!1)},{immediate:!0}),(e,t)=>{var l,d;return r(),i("div",nt,[V.value?(r(),i("div",lt,[...t[1]||(t[1]=[ye('<div class="skeleton-hero shimmer" data-v-94667932></div><div class="skeleton-content" data-v-94667932><div class="skeleton-title shimmer" data-v-94667932></div><div class="skeleton-button-row" data-v-94667932><span class="skeleton-button shimmer" data-v-94667932></span><span class="skeleton-button shimmer" data-v-94667932></span></div><div class="skeleton-card shimmer" data-v-94667932></div><div class="skeleton-card shimmer" data-v-94667932></div><div class="skeleton-card skeleton-card--short shimmer" data-v-94667932></div></div>',2)])])):E.value?(r(),i("div",ot,v(E.value),1)):n.value?(r(),i(_,{key:2},[a("main",it,[a("section",rt,[t[6]||(t[6]=a("div",{class:"event-hero__overlay"},null,-1)),a("div",{class:"event-cover-wrapper",style:Z(Te.value)},[a("div",ut,[(r(!0),i(_,null,C(p.value,(s,u)=>(r(),i("div",{key:s.id||s.imageUrl||u,class:$(["event-carousel__slide",{"is-active":u===g.value}])},[a("img",{src:s.imageUrl,class:"event-cover",alt:`event cover ${u+1}`},null,8,ct)],2))),128)),p.value.length>1?(r(),i("button",{key:0,class:"carousel-nav carousel-nav--prev",type:"button",onClick:Fe},[...t[2]||(t[2]=[a("span",{class:"i-lucide-chevron-left"},null,-1)])])):h("",!0),p.value.length>1?(r(),i("button",{key:1,class:"carousel-nav carousel-nav--next",type:"button",onClick:Ee},[...t[3]||(t[3]=[a("span",{class:"i-lucide-chevron-right"},null,-1)])])):h("",!0),p.value.length>1?(r(),i("div",vt,[(r(!0),i(_,null,C(p.value,(s,u)=>(r(),i("button",{key:s.id||s.imageUrl||`dot-${u}`,class:$(["carousel-dot",{"is-active":u===g.value}]),onClick:b=>Le(u)},null,10,dt))),128))])):h("",!0)])],4),a("div",mt,[a("h1",pt,v(n.value.title),1),a("div",ht,[a("div",gt,[a("span",{class:$(["event-status-badge",ae.value.variant])},v(ae.value.label),3),a("span",ft,v($e.value),1)]),a("div",_t,[a("button",{class:"event-action-icon",type:"button",onClick:Pe},[...t[4]||(t[4]=[a("span",{class:"i-lucide-share-2"},null,-1)])]),a("button",{class:$(["event-action-icon",{"is-active":X.value}]),type:"button",onClick:Ie},[...t[5]||(t[5]=[a("span",{class:"i-lucide-bookmark"},null,-1)])],2)])]),H.value?(r(),i("p",yt,v(H.value),1)):h("",!0)])]),x.value.length>1?(r(),i("div",kt,[(r(!0),i(_,null,C(x.value,s=>(r(),i("button",{key:s.id,class:$(["m-chip",{"is-active":s.id===S.value}]),onClick:u=>S.value=s.id},v(s.label),11,wt))),128))])):h("",!0),a("section",bt,[a("div",Tt,[a("div",Ct,[t[7]||(t[7]=a("div",{class:"event-meta-icon"},[a("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none"},[a("rect",{x:"3",y:"4",width:"18",height:"17",rx:"3",stroke:"currentColor","stroke-width":"1.5"}),a("path",{d:"M3 9h18M8 2v4M16 2v4",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round"})])],-1)),a("div",$t,[a("p",St,v(((l=te.value)==null?void 0:l.label)??n.value.timeFullText),1),a("p",Ut,v(((d=te.value)==null?void 0:d.meta)??n.value.timeFullText),1)]),Ce.value?(r(),i("span",xt,"複数日程")):h("",!0)]),G.value?(r(),i("button",{key:0,class:"event-schedule__cta",type:"button",onClick:Re},[...t[8]||(t[8]=[a("span",{class:"i-lucide-calendar-plus"},null,-1),Q(" カレンダーに追加 ",-1)])])):h("",!0)]),t[11]||(t[11]=a("div",{class:"m-divider"},null,-1)),a("div",Mt,[t[10]||(t[10]=ye('<div class="event-meta-icon" data-v-94667932><svg width="20" height="20" viewBox="0 0 24 24" fill="none" data-v-94667932><path d="M12 21c4.418 0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7 3.582 7 8 7z" stroke="currentColor" stroke-width="1.5" data-v-94667932></path><path d="M12 11v6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" data-v-94667932></path><path d="M7 3h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" data-v-94667932></path></svg></div>',1)),a("div",Dt,[a("div",At,v(n.value.locationText),1)]),a("button",{class:"event-map-button",type:"button",onClick:He},[...t[9]||(t[9]=[a("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true"},[a("path",{d:"M12 21c4.418 0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7 3.582 7 8 7z",stroke:"currentColor","stroke-width":"1.5"}),a("path",{d:"M12 11v6",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round"}),a("path",{d:"M7 3h10",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round"})],-1),Q(" ルートを見る ",-1)])])])]),Se.value?(r(),i("section",Pt,[t[12]||(t[12]=a("h2",{class:"m-section-title"},"参加状況",-1)),a("div",It,[a("div",Lt,[a("span",null,v(n.value.regSummary),1),a("span",null,v(n.value.capacityText),1)]),a("div",Ft,[a("div",{class:"event-progress__bar",style:Z({width:`${n.value.regProgress}%`})},null,4)]),k.value.length?(r(),i("div",Et,[a("div",Rt,[(r(!0),i(_,null,C(k.value,s=>(r(),i("button",{key:s.id||s.name,class:"participant-avatar",type:"button",onClick:le},[s.avatarUrl?(r(),i("img",{key:0,src:s.avatarUrl,alt:s.name},null,8,Nt)):(r(),i("span",Bt,v(ne(s.name)),1)),a("span",zt,v(s.name),1)]))),128)),Ue.value?(r(),i("button",{key:0,class:"participant-more",type:"button",onClick:le}," +"+v(xe.value),1)):h("",!0)]),a("p",Ht,"最近の参加者（"+v(Me.value)+"）",1)])):(r(),i("p",Ot,"表示できる参加者がまだいません。"))])])):h("",!0),a("section",Jt,[t[15]||(t[15]=a("h2",{class:"m-section-title"},"主催コミュニティ",-1)),a("div",jt,[a("div",Vt,[a("button",{class:"group-info",type:"button",onClick:ze,disabled:!n.value.communitySlug},[a("div",{class:"group-avatar",style:Z(Be.value)},null,4),a("div",Gt,[a("div",Yt,v(n.value.hostName),1),t[13]||(t[13]=a("div",{class:"m-text-meta"},"最新ニュースとイベント情報",-1))])],8,qt),a("button",{class:$(["group-follow",{"is-active":w.value}]),type:"button",onClick:Ne},[w.value?(r(),i("span",Kt)):(r(),i("span",Zt)),Q(" "+v(w.value?"フォロー中":"フォロー"),1)],2)]),t[14]||(t[14]=a("p",{class:"group-hint"},"このコミュニティをフォローすると最新イベントやアナウンスを受け取れます。",-1))])]),a("section",Qt,[t[16]||(t[16]=a("h2",{class:"m-section-title"},"About",-1)),a("div",Wt,[a("div",{class:"m-text-body prose prose-sm max-w-none",innerHTML:n.value.descriptionHtml},null,8,Xt)])]),W.value.length?(r(),i("section",ea,[t[17]||(t[17]=a("h2",{class:"m-section-title"},"申込時の必須情報",-1)),a("div",ta,[a("ul",aa,[(r(!0),i(_,null,C(W.value,(s,u)=>(r(),i("li",{key:Je(s,u)},"・"+v(s.label),1))),128))])])])):h("",!0)]),a("footer",sa,[a("div",na,[a("p",la,v(n.value.priceText),1)]),a("button",{class:"rails-cta",type:"button",disabled:be.value,onClick:Oe},[a("span",null,v(we.value),1)],8,oa)])],64)):h("",!0),z.value?(r(),i("div",{key:3,class:"participant-backdrop",onClick:ke(oe,["self"])},[a("div",{class:"participant-sheet",onClick:t[0]||(t[0]=ke(()=>{},["stop"]))},[t[20]||(t[20]=a("div",{class:"participant-sheet__handle"},null,-1)),a("div",{class:"participant-sheet__header"},[t[19]||(t[19]=a("h3",null,"参加者一覧",-1)),a("button",{class:"participant-close",type:"button",onClick:oe},[...t[18]||(t[18]=[a("span",{class:"i-lucide-x text-lg"},null,-1)])])]),a("div",ia,[a("ul",ra,[(r(!0),i(_,null,C(y.value,s=>(r(),i("li",{key:s.id||s.name,class:"participant-list__item"},[a("div",ua,[s.avatarUrl?(r(),i("img",{key:0,src:s.avatarUrl,alt:s.name},null,8,ca)):(r(),i("span",va,v(ne(s.name)),1))]),a("div",da,v(s.name||"ゲスト"),1)]))),128))])])])])):h("",!0)])}}}),_a=at(ma,[["__scopeId","data-v-94667932"]]);export{_a as default};
