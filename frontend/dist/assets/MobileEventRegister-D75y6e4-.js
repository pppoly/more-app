import{d as G,a as l,M as le,q as L,h as f,N as ne,p as O,O as J,b as a,l as oe,r as h,z as re,c as D,y as ie,o as ce,u as ue,g as de,e as o,t as d,j as b,n as K,F as q,f as E,s as S,G as ve,v as me,H as he,I as ye,x as F,w as T,D as pe,J as fe,K as _e,L as ge,_ as be}from"./index-BPws346P.js";const ke=["disabled"],Ce={key:0,class:"mr-2 inline-flex items-center text-lg"},xe={key:1,class:"ml-2 inline-flex items-center text-lg"},we="inline-flex items-center justify-center font-medium rounded-full transition-all duration-150 active:scale-[0.98] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 disabled:opacity-50 disabled:cursor-not-allowed gap-2",V=G({__name:"Button",props:{variant:{default:"primary"},size:{default:"md"},disabled:{type:Boolean,default:!1},iconLeft:{},iconRight:{}},setup(_){const A=_,M={primary:"bg-gradient-to-r from-[#0090D9] via-[#22BBAA] to-[#E4C250] text-white shadow-lg shadow-cyan-500/20 hover:brightness-110 active:brightness-95",outline:"bg-white text-[#0088CC] border-[1.5px] border-[#0088CC] hover:bg-[#E8F6FF]",ghost:"bg-[#F2FBFF] text-[#0088CC] border border-[#BEE3F8] hover:bg-[#E8F6FF]"},j={sm:"h-8 px-4 text-xs",md:"h-10 px-5 text-sm",lg:"h-12 px-6 text-base"},{variant:v,size:x}=A;return(y,k)=>(a(),l("button",le({class:[we,M[L(v)],j[L(x)]],disabled:_.disabled},y.$attrs),[_.iconLeft?(a(),l("span",Ce,[(a(),O(J(_.iconLeft)))])):f("",!0),ne(y.$slots,"default"),_.iconRight?(a(),l("span",xe,[(a(),O(J(_.iconRight)))])):f("",!0)],16,ke))}}),qe={class:"mobile-register"},Ee={class:"register-header"},Fe={class:"header-info"},Te={key:0,class:"state-card"},Ve={key:1,class:"state-card state-card--error"},Ae={key:2,class:"register-content"},Me={class:"summary-card"},Re={class:"summary-title"},$e={class:"summary-time"},ze={class:"summary-location"},Be={class:"summary-price"},Se={class:"steps"},je={key:0,class:"form-card"},Ie={key:0,class:"form-hint"},Ue={key:1,class:"form-fields"},De={class:"field-label"},Le={key:0,class:"required"},Pe=["type","required","onUpdate:modelValue"],Ne=["required","onUpdate:modelValue"],Oe=["required","onUpdate:modelValue"],Je=["value"],Ke={key:3,class:"choice-list"},Ge=["name","value","onUpdate:modelValue","required"],He={key:4,class:"choice-list"},Qe=["checked","onChange"],We={key:5,class:"checkbox-row"},Xe=["checked","onChange"],Ye={class:"form-actions"},Ze={key:1,class:"confirm-card"},et={key:0,class:"confirm-list"},tt={class:"confirm-label"},st={class:"confirm-value"},at={key:1,class:"form-hint"},lt={class:"confirm-actions"},nt={key:2,class:"payment-card"},ot={key:0,class:"payment-actions"},rt={key:3,class:"state-card state-card--error"},it=G({__name:"MobileEventRegister",setup(_){const A=ie(),M=ue(),{user:j}=oe(),v=h(null),x=h(!0),y=h(null),k=h(1),r=re({}),R=h(!1),m=h(null),p=h(null),w=h(null),$=h(!1),z=h(!1),B=D(()=>A.params.eventId),P=async()=>{if(!B.value){y.value="イベントが見つかりませんでした。";return}x.value=!0,y.value=null;try{v.value=await pe(B.value),H()}catch(e){y.value=e instanceof Error?e.message:"イベント情報の取得に失敗しました"}finally{x.value=!1}};ce(()=>{if(!j.value){M.replace({name:"organizer-apply",query:{redirect:A.fullPath}});return}P()});const C=D(()=>{var n;if(!v.value)return null;const e=N(v.value.startTime),s=v.value.endTime?N(v.value.endTime):"未定";return{id:v.value.id,title:de(v.value.title),timeText:`${e} 〜 ${s}`,locationText:v.value.locationText,priceText:((n=v.value.config)==null?void 0:n.priceText)??"無料 / 未定"}}),g=D(()=>{var e;return((e=v.value)==null?void 0:e.registrationFormSchema)??[]}),H=()=>{Object.keys(r).forEach(e=>delete r[e]),g.value.forEach((e,s)=>{const n=u(e,s);e.type==="checkbox"?r[n]=!1:e.type==="multiChoice"?r[n]=[]:r[n]=""})},Q=()=>{W()&&(k.value=2)},W=()=>{m.value=null;for(let e=0;e<g.value.length;e+=1){const s=g.value[e],n=u(s,e),t=r[n];if(s.required){if(s.type==="multiChoice"){if(!Array.isArray(t)||!t.length)return m.value=`${s.label} を入力してください`,!1}else if(!t)return m.value=`${s.label} を入力してください`,!1}}return!0},X=async()=>{if(B.value){R.value=!0,m.value=null;try{const e=await fe(B.value,{formAnswers:{...r}});Y(e)}catch(e){m.value=e instanceof Error?e.message:"申込に失敗しました"}finally{R.value=!1}}},Y=e=>{e.paymentRequired?(p.value={registrationId:e.registrationId,amount:e.amount},w.value="お支払いを完了すると参加が確定します。"):(p.value=null,w.value="お申込みありがとうございます！このまま最新情報をお待ちください。")},Z=async()=>{if(p.value){$.value=!0,m.value=null;try{await _e(p.value.registrationId),p.value=null,w.value="お支払いが完了しました。参加が確定です。"}catch(e){m.value=e instanceof Error?e.message:"決済処理に失敗しました"}finally{$.value=!1}}},ee=async()=>{var e,s;if(p.value){z.value=!0,m.value=null;try{const{checkoutUrl:n}=await ge(p.value.registrationId);window.location.href=n}catch(n){const t=((s=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:s.message)??(n instanceof Error?n.message:"Stripe Checkoutの開始に失敗しました");m.value=t,z.value=!1}}},u=(e,s)=>e.id??`${e.label??"field"}-${s}`,I=e=>Array.isArray(e.options)?e.options:[],te=(e,s,n,t)=>{const i=u(e,s);Array.isArray(r[i])||(r[i]=[]),t?r[i].includes(n)||r[i].push(n):r[i]=r[i].filter(c=>c!==n)},se=e=>{switch(e){case"email":return"email";case"phone":return"tel";case"number":return"number";case"date":return"date";default:return"text"}},ae=(e,s)=>{const n=r[u(e,s)];return Array.isArray(n)?n.join(", "):typeof n=="boolean"?n?"はい":"いいえ":n||"未入力"},N=e=>new Date(e).toLocaleString("ja-JP",{month:"short",day:"numeric",weekday:"short",hour:"2-digit",minute:"2-digit"});return(e,s)=>{var n;return a(),l("div",qe,[o("header",Ee,[o("button",{class:"back-button",type:"button",onClick:s[0]||(s[0]=t=>L(M).back())},[...s[2]||(s[2]=[o("span",{class:"i-lucide-chevron-left text-lg"},null,-1)])]),o("div",Fe,[s[3]||(s[3]=o("p",{class:"header-label"},"イベント申込",-1)),o("h1",null,d((n=C.value)==null?void 0:n.title),1)])]),x.value?(a(),l("section",Te,"読み込み中...")):y.value?(a(),l("section",Ve,[b(d(y.value)+" ",1),o("button",{onClick:P},"再試行")])):C.value?(a(),l("section",Ae,[o("div",Me,[o("p",Re,d(C.value.title),1),o("p",$e,d(C.value.timeText),1),o("p",ze,d(C.value.locationText),1),o("p",Be,d(C.value.priceText),1)]),o("div",Se,[o("div",{class:K(["step",{"is-active":k.value===1}])},"1. 情報入力",2),o("div",{class:K(["step",{"is-active":k.value===2}])},"2. 確認・決済",2)]),k.value===1?(a(),l("div",je,[g.value.length?(a(),l("div",Ue,[(a(!0),l(q,null,E(g.value,(t,i)=>(a(),l("label",{key:u(t,i),class:"field"},[o("span",De,[b(d(t.label)+" ",1),t.required?(a(),l("span",Le,"*")):f("",!0)]),["text","email","phone","number","date"].includes(t.type)?S((a(),l("input",{key:0,type:se(t.type),class:"field-input",required:t.required,"onUpdate:modelValue":c=>r[u(t,i)]=c},null,8,Pe)),[[ve,r[u(t,i)]]]):t.type==="textarea"?S((a(),l("textarea",{key:1,rows:"3",class:"field-input",required:t.required,"onUpdate:modelValue":c=>r[u(t,i)]=c},null,8,Ne)),[[me,r[u(t,i)]]]):t.type==="select"?S((a(),l("select",{key:2,class:"field-input",required:t.required,"onUpdate:modelValue":c=>r[u(t,i)]=c},[s[4]||(s[4]=o("option",{value:""},"選択してください",-1)),(a(!0),l(q,null,E(I(t),c=>(a(),l("option",{key:c,value:c},d(c),9,Je))),128))],8,Oe)),[[he,r[u(t,i)]]]):t.type==="singleChoice"?(a(),l("div",Ke,[(a(!0),l(q,null,E(I(t),c=>(a(),l("label",{key:c,class:"choice-item"},[S(o("input",{type:"radio",name:u(t,i),value:c,"onUpdate:modelValue":U=>r[u(t,i)]=U,required:t.required},null,8,Ge),[[ye,r[u(t,i)]]]),o("span",null,d(c),1)]))),128))])):t.type==="multiChoice"?(a(),l("div",He,[(a(!0),l(q,null,E(I(t),c=>(a(),l("label",{key:c,class:"choice-item"},[o("input",{type:"checkbox",checked:Array.isArray(r[u(t,i)])&&r[u(t,i)].includes(c),onChange:U=>te(t,i,c,U.target.checked)},null,40,Qe),o("span",null,d(c),1)]))),128))])):t.type==="checkbox"?(a(),l("label",We,[o("input",{type:"checkbox",checked:!!r[u(t,i)],onChange:c=>r[u(t,i)]=c.target.checked},null,40,Xe),o("span",null,d(t.label),1)])):f("",!0)]))),128))])):(a(),l("p",Ie,"追加の入力は不要です。「次へ」をタップしてください。")),o("div",Ye,[F(V,{variant:"primary",size:"lg",class:"w-full justify-center",onClick:Q},{default:T(()=>[...s[5]||(s[5]=[b(" 次へ ",-1)])]),_:1})])])):(a(),l("div",Ze,[s[7]||(s[7]=o("h2",null,"入力内容の確認",-1)),g.value.length?(a(),l("ul",et,[(a(!0),l(q,null,E(g.value,(t,i)=>(a(),l("li",{key:u(t,i)},[o("span",tt,d(t.label),1),o("span",st,d(ae(t,i)),1)]))),128))])):(a(),l("p",at,"特別な入力はありません。")),o("div",lt,[F(V,{variant:"ghost",size:"md",class:"flex-1 justify-center",onClick:s[1]||(s[1]=t=>k.value=1)},{default:T(()=>[...s[6]||(s[6]=[b("戻る",-1)])]),_:1}),F(V,{variant:"primary",size:"md",class:"flex-1 justify-center",disabled:R.value,onClick:X},{default:T(()=>[b(d(R.value?"送信中…":"申込を確定"),1)]),_:1},8,["disabled"])]),w.value?(a(),l("div",nt,[o("p",null,d(w.value),1),p.value?(a(),l("div",ot,[F(V,{variant:"primary",size:"md",class:"flex-1 justify-center",disabled:z.value,onClick:ee},{default:T(()=>[b(d(z.value?"Stripeへ移動中…":"Stripeで支払う"),1)]),_:1},8,["disabled"]),F(V,{variant:"outline",size:"md",class:"flex-1 justify-center",disabled:$.value,onClick:Z},{default:T(()=>[b(d($.value?"Mock 決済中…":"Mock 支払い（デモ）"),1)]),_:1},8,["disabled"])])):f("",!0)])):f("",!0),m.value?(a(),l("p",rt,d(m.value),1)):f("",!0)]))])):f("",!0)])}}}),ut=be(it,[["__scopeId","data-v-fdc85337"]]);export{ut as default};
