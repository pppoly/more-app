import{d as M,a6 as L,c as N,r as d,o as P,b as l,h as s,i as p,j as g,v as S,J as R,F as v,f as _,x as B,t as a,a7 as T,e as n,y as I,_ as j}from"./index-CT-XDF2b.js";const E={class:"staff-page"},F={class:"staff-head"},J=["disabled"],U={class:"control-card"},z=["value"],G={class:"manual-entry"},O=["disabled"],W={key:0,class:"stats-grid"},$={class:"stat-card"},q={class:"stat-card"},H={class:"stat-card"},K={key:1,class:"breakdown"},Q={class:"breakdown-card"},X={class:"breakdown-card"},Y={class:"logs-section"},Z={class:"logs-head"},ss={key:0},ts={key:0,class:"error-banner"},es={key:1,class:"placeholder"},ls={key:2,class:"log-list"},as=["onClick"],ns={class:"log-title"},os={class:"log-sub"},us={key:0,class:"log-body"},is={class:"log-badge"},rs={class:"conversation"},ds={class:"message-role"},cs={key:0,class:"message-content"},ps={key:1,class:"proposal-snippet"},vs={key:0,class:"write-panel"},_s={class:"draft-json"},ms=M({__name:"MobileStaff",setup(ys){const h=L(),b=N(()=>h.communities.value),r=d(null),c=d(""),u=d(null),m=d(!1),y=d(null),k=d(null),w=()=>{u.value=null,f()},f=async()=>{if(r.value){m.value=!0,y.value=null;try{u.value=await T(r.value)}catch(i){y.value=i instanceof Error?i.message:"加载仪表盘失败"}finally{m.value=!1}}};P(async()=>{await h.loadCommunities(),b.value.length&&(r.value=b.value[0].id,f())});const D=()=>{c.value.trim()&&(r.value=c.value.trim(),f())},V=i=>{k.value=k.value===i?null:i},A=i=>JSON.stringify(i,null,2);return(i,t)=>(n(),l("div",E,[s("header",F,[t[3]||(t[3]=s("div",null,[s("p",{class:"staff-label"},"AI 调试"),s("h1",null,"助手运行面板"),s("p",{class:"staff-desc"},"仅供公司员工验证 Prompt & API 状态")],-1)),s("button",{type:"button",class:"outline",onClick:f,disabled:m.value},[...t[2]||(t[2]=[s("span",{class:"i-lucide-refresh-cw mr-1"},null,-1),g(" 刷新 ",-1)])],8,J)]),s("section",U,[s("label",null,[t[5]||(t[5]=g(" 选定社区 ",-1)),S(s("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>r.value=e),onChange:w},[t[4]||(t[4]=s("option",{value:"",disabled:""},"请选择",-1)),(n(!0),l(v,null,_(b.value,e=>(n(),l("option",{key:e.id,value:e.id},a(e.name),9,z))),128))],544),[[R,r.value]])]),s("label",null,[t[6]||(t[6]=g(" 或输入社区 ID ",-1)),s("div",G,[S(s("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>c.value=e),type:"text",placeholder:"例如：cmty_xxx"},null,512),[[B,c.value]]),s("button",{type:"button",class:"outline",onClick:D,disabled:!c.value.trim()}," 查看 ",8,O)])]),t[7]||(t[7]=s("p",{class:"helper"},"管理员可直接输入任意社区 ID 查看 AI 日志。",-1))]),u.value?(n(),l("section",W,[s("article",$,[t[8]||(t[8]=s("p",null,"对话总数",-1)),s("strong",null,a(u.value.stats.totalSessions),1)]),s("article",q,[t[9]||(t[9]=s("p",null,"方案完成",-1)),s("strong",null,a(u.value.stats.readySessions),1),s("span",null,a(u.value.stats.readyRate)+"%",1)]),s("article",H,[t[10]||(t[10]=s("p",null,"平均回合",-1)),s("strong",null,a(u.value.stats.averageTurns),1)])])):p("",!0),u.value?(n(),l("section",K,[s("div",Q,[t[11]||(t[11]=s("h3",null,"Prompt 版本",-1)),s("ul",null,[(n(!0),l(v,null,_(u.value.stats.promptVersions,(e,o)=>(n(),l("li",{key:o},[s("span",null,a(o),1),s("strong",null,a(e),1)]))),128))])]),s("div",X,[t[12]||(t[12]=s("h3",null,"语言分布",-1)),s("ul",null,[(n(!0),l(v,null,_(u.value.stats.languages,(e,o)=>(n(),l("li",{key:o},[s("span",null,a(o),1),s("strong",null,a(e),1)]))),128))])])])):p("",!0),s("section",Y,[s("div",Z,[t[13]||(t[13]=s("h2",null,"最近调试对话",-1)),m.value?(n(),l("span",ss,"读取中...")):p("",!0)]),y.value?(n(),l("div",ts,a(y.value),1)):u.value?(n(),l("ul",ls,[(n(!0),l(v,null,_(u.value.logs,e=>(n(),l("li",{key:e.id,class:"log-item"},[s("div",{class:"log-meta",onClick:o=>V(e.id)},[s("div",null,[s("p",ns,a(e.summary||"未命名草案"),1),s("p",os," Prompt: "+a(e.promptVersion||"未知")+" · 回合: "+a(e.turnCount??0)+" · 时间: "+a(new Date(e.createdAt).toLocaleString()),1)]),s("span",{class:I(["log-status",e.status])},a(e.status??"collecting"),3)],8,as),k.value===e.id?(n(),l("div",us,[s("div",is,"Stage: "+a(e.stage),1),s("div",rs,[t[14]||(t[14]=s("p",{class:"conversation-title"},"对话轨迹（Speak）",-1)),s("ul",null,[(n(!0),l(v,null,_(e.messages,o=>{var C,x;return n(),l("li",{key:o.id,class:I(["message",o.role==="user"?"message-user":"message-assistant"])},[s("span",ds,a(o.role==="user"?"用户 Speak":"AI Guide"),1),o.type==="text"?(n(),l("p",cs,a(o.content),1)):(n(),l("div",ps,[s("p",null,"标题: "+a((C=o.payload)==null?void 0:C.title),1),s("p",null,a((x=o.payload)==null?void 0:x.description),1)]))],2)}),128))])]),e.aiResult?(n(),l("div",vs,[t[15]||(t[15]=s("p",{class:"conversation-title"},"结构化 Draft（Write）",-1)),s("pre",_s,a(A(e.aiResult)),1)])):p("",!0)])):p("",!0)]))),128))])):(n(),l("div",es,"请选择社区以加载数据"))])]))}}),bs=j(ms,[["__scopeId","data-v-23e9b5bc"]]);export{bs as default};
