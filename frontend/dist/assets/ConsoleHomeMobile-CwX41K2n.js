import{d as tt,a6 as et,r as g,c as d,a as M,g as st,C as B,o as ot,a8 as nt,b as a,h as t,i as h,t as c,j as D,y as v,F as S,f as N,w as at,z as lt,s as it,m as ct,a9 as ut,u as rt,e as l,_ as dt}from"./index-CT-XDF2b.js";const vt={class:"console-home"},mt={class:"hero-card"},pt={class:"hero-heading"},yt=["src"],Ct={class:"hero-title"},gt={class:"hero-role"},bt={class:"hero-stats"},ht={class:"hero-stat"},kt={class:"hero-stat"},ft={class:"hero-stat"},_t={class:"action-grid"},wt={class:"events-section"},xt={class:"event-cards"},It=["onClick"],Mt={class:"event-date"},St={class:"event-meta"},Tt={key:0,class:"event-empty"},Et={class:"picker-sheet"},At={class:"picker-list"},Lt={key:0,class:"picker-empty"},Pt=["onClick"],Ut={class:"picker-name"},Rt={class:"picker-slug"},Bt={key:0,class:"i-lucide-check"},Dt={key:0,class:"picker-empty"},m="https://raw.githubusercontent.com/moreard/dev-assets/main/socialmore/icon-action-default.png",Nt="https://raw.githubusercontent.com/moreard/dev-assets/main/socialmore/default-event.png",$t=tt({__name:"ConsoleHomeMobile",setup(Ft){const u=rt(),r=et(),k=g([]),T=g(!1),b=g(!1),f=g(!1),y=g(null),C=d(()=>r.getActiveCommunity()),E=d(()=>r.communities.value),A=d(()=>r.activeCommunityId.value),$=d(()=>{var s;return((s=C.value)==null?void 0:s.name)??""}),o=d(()=>r.activeCommunityId.value),i=d(()=>!!o.value),F=d(()=>{var s;return y.value?y.value:(s=C.value)!=null&&s.coverImageUrl?M(C.value.coverImageUrl):"https://raw.githubusercontent.com/moreard/dev-assets/main/socialmore/default-community.png"}),V=d(()=>{var e;switch((e=C.value)==null?void 0:e.role){case"owner":return"主催者";case"admin":return"管理者";default:return"メンバー"}}),_=d(()=>({monthRevenueText:"¥0",eventCount:k.value.length,registrationCount:"--"})),L=d(()=>k.value.slice(0,5).map(s=>({id:s.id,title:st(s.title),status:s.status,dateTimeText:W(s.startTime,s.endTime),entrySummary:s.visibility==="public"?"公開イベント":"限定公開",coverUrl:s.coverImageUrl?M(s.coverImageUrl):Nt}))),w=async()=>{if(o.value){T.value=!0;try{k.value=await ut(o.value)}catch(s){console.error("Failed to load console events",s)}finally{T.value=!1}}};B(o,()=>{o.value&&w()});const j=async()=>{b.value=!0,!r.loaded.value&&!r.loading.value&&(f.value=!0,await r.loadCommunities(!0),f.value=!1)},z=s=>{r.setActiveCommunity(s),b.value=!1,I()},x=()=>{b.value=!1},P=()=>{u.push({name:"ConsoleMobileCommunityCreate"})},H=()=>{u.push({name:"ConsoleMobilePayout"})},J=()=>{u.push({name:"ConsoleMobileSubscription"})},U=()=>{o.value&&u.push({name:"ConsoleMobileCommunitySettings",params:{communityId:o.value}})},O=()=>{var s;(s=C.value)!=null&&s.slug&&u.push({name:"community-portal",params:{slug:C.value.slug}})},Q=()=>{u.push({name:"ConsoleTicketScanner"})},R=()=>{o.value&&u.push({name:"ConsoleMobileCommunityEvents",params:{communityId:o.value}})},q=s=>{u.push({name:"ConsoleMobileEventManage",params:{eventId:s}})},G=()=>{o.value&&u.push({name:"ConsoleMobileEventForm",params:{communityId:o.value}})},K=()=>{o.value&&u.push({name:"ConsoleMobileEventCreate",params:{communityId:o.value}})},W=(s,e)=>{const p=new Date(s).toLocaleString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});if(!e)return p;const n=new Date(e).toLocaleString("ja-JP",{hour:"2-digit",minute:"2-digit"});return`${p}〜${n}`},X=s=>{switch(s){case"open":return"受付中";case"closed":return"終了";default:return"下書き"}},Y=s=>{switch(s){case"open":return"bg-emerald-100 text-emerald-700";case"closed":return"bg-slate-100 text-slate-500";default:return"bg-amber-100 text-amber-700"}};ot(async()=>{await r.loadCommunities(),o.value||r.ensureActiveCommunity(),o.value&&(w(),I())}),B(()=>o.value,(s,e)=>{s&&s!==e&&(w(),I()),s||(y.value=null)});const I=async()=>{if(!o.value){y.value=null;return}try{const s=await nt(o.value),e=typeof s.description=="object"&&s.description?s.description:null,p=(e==null?void 0:e.logoImageUrl)||s.coverImageUrl||null;y.value=p?M(p):null}catch{y.value=null}};return(s,e)=>{const p=ct("RouterLink");return l(),a("div",vt,[t("section",mt,[t("div",pt,[t("img",{src:F.value,alt:"avatar",class:"hero-avatar",onClick:U},null,8,yt),t("div",{class:"hero-heading-text",onClick:U},[t("h1",Ct,c($.value||"未選択のコミュニティ"),1),t("p",gt,c(i.value?`役割: ${V.value}`:"まずはコミュニティを登録"),1)]),i.value?(l(),a("button",{key:0,class:"hero-switch inline-switch",type:"button",onClick:j}," 切り替え ")):(l(),a("button",{key:1,class:"hero-switch hero-switch--primary",type:"button",onClick:P},[...e[0]||(e[0]=[t("span",{class:"i-lucide-sparkles"},null,-1),D(" コミュニティを作成 ",-1)])]))]),t("div",bt,[t("div",ht,[e[1]||(e[1]=t("p",null,"今月の収入",-1)),t("strong",null,c(i.value?_.value.monthRevenueText:"---"),1)]),t("div",kt,[e[2]||(e[2]=t("p",null,"今月のイベント",-1)),t("strong",null,c(i.value?_.value.eventCount:"--"),1)]),t("div",ft,[e[3]||(e[3]=t("p",null,"申込数",-1)),t("strong",null,c(i.value?_.value.registrationCount:"--"),1)])])]),t("section",_t,[t("button",{class:"action-card",type:"button",onClick:P},[t("div",{class:"action-entry"},[t("div",{class:"action-icon"},[t("img",{src:m,alt:""})]),e[4]||(e[4]=t("div",null,[t("p",{class:"action-title"},"コミュニティ作成"),t("p",{class:"action-desc"},"新しいコミュニティを登録")],-1))])]),t("button",{class:v(["action-card",{"is-disabled":!i.value}]),type:"button",onClick:G},[t("div",{class:"action-entry"},[t("div",{class:"action-icon"},[t("img",{src:m,alt:""})]),e[5]||(e[5]=t("div",null,[t("p",{class:"action-title"},"新しいイベント"),t("p",{class:"action-desc"},"イベントを作成して公開")],-1))])],2),t("button",{class:v(["action-card",{"is-disabled":!i.value}]),type:"button",onClick:K},[t("div",{class:"action-entry"},[t("div",{class:"action-icon"},[t("img",{src:m,alt:""})]),e[6]||(e[6]=t("div",null,[t("p",{class:"action-title"},"AI イベント助手"),t("p",{class:"action-desc"},"SOCIALMORE 憲法で企画")],-1))])],2),t("button",{class:v(["action-card",{"is-disabled":!i.value}]),type:"button",onClick:R},[t("div",{class:"action-entry"},[t("div",{class:"action-icon"},[t("img",{src:m,alt:""})]),e[7]||(e[7]=t("div",null,[t("p",{class:"action-title"},"イベント管理"),t("p",{class:"action-desc"},"登録状況と参加者を確認")],-1))])],2),t("button",{class:v(["action-card",{"is-disabled":!i.value}]),type:"button",onClick:H},[t("div",{class:"action-entry"},[t("div",{class:"action-icon"},[t("img",{src:m,alt:""})]),e[8]||(e[8]=t("div",null,[t("p",{class:"action-title"},"収益と入金"),t("p",{class:"action-desc"},"入金設定・請求を確認")],-1))])],2),t("button",{class:v(["action-card",{"is-disabled":!i.value}]),type:"button",onClick:J},[t("div",{class:"action-entry"},[t("div",{class:"action-icon"},[t("img",{src:m,alt:""})]),e[9]||(e[9]=t("div",null,[t("p",{class:"action-title"},"プランと設定"),t("p",{class:"action-desc"},"プラン変更や通知設定")],-1))])],2),t("button",{class:v(["action-card",{"is-disabled":!i.value}]),type:"button",onClick:O},[t("div",{class:"action-entry"},[t("div",{class:"action-icon"},[t("img",{src:m,alt:""})]),e[10]||(e[10]=t("div",null,[t("p",{class:"action-title"},"公開ページを見る"),t("p",{class:"action-desc"},"社群ポータルを確認（ユーザー側表示）")],-1))])],2),t("button",{class:v(["action-card",{"is-disabled":!i.value}]),type:"button",onClick:Q},[t("div",{class:"action-entry"},[t("div",{class:"action-icon"},[t("img",{src:m,alt:""})]),e[11]||(e[11]=t("div",null,[t("p",{class:"action-title"},"验票扫码"),t("p",{class:"action-desc"},"ストアフロントでQRを読み取る")],-1))])],2)]),t("section",wt,[t("div",{class:"section-head"},[e[12]||(e[12]=t("div",null,[t("p",{class:"section-label"},"イベントの進行状況"),t("h2",null,"最新イベント")],-1)),t("button",{class:"link-button",type:"button",onClick:R},"一覧を見る")]),t("div",xt,[(l(!0),a(S,null,N(L.value,n=>(l(),a("button",{key:n.id,class:"event-card",type:"button",onClick:Z=>q(n.id)},[t("div",{class:v(["event-status",Y(n.status)])},c(X(n.status)),3),t("p",Mt,c(n.dateTimeText),1),t("h3",null,c(n.title),1),t("p",St,c(n.entrySummary),1)],8,It))),128)),L.value.length?h("",!0):(l(),a("div",Tt," まだイベントがありません。新しい企画を始めましょう。 "))])]),b.value?(l(),a("div",{key:0,class:"picker-overlay",onClick:at(x,["self"])},[t("div",Et,[t("header",{class:"picker-head"},[e[14]||(e[14]=t("p",{class:"picker-title"},"社群を切り替え",-1)),t("button",{type:"button",class:"picker-close",onClick:x},[...e[13]||(e[13]=[t("span",{class:"i-lucide-x"},null,-1)])])]),t("div",At,[f.value?(l(),a("div",Lt,"読み込み中…")):(l(),a(S,{key:1},[(l(!0),a(S,null,N(E.value,n=>(l(),a("button",{key:n.id,class:v(["picker-item",{"is-active":n.id===A.value}]),type:"button",onClick:Z=>z(n.id)},[t("div",null,[t("p",Ut,c(n.name),1),t("p",Rt,"@"+c(n.slug),1)]),n.id===A.value?(l(),a("span",Bt)):h("",!0)],10,Pt))),128)),E.value.length?h("",!0):(l(),a("p",Dt,"まだ社群がありません。")),lt(p,{class:"picker-add",to:{name:"ConsoleMobileCommunityCreate"},onClick:x},{default:it(()=>[...e[15]||(e[15]=[t("span",{class:"i-lucide-plus"},null,-1),D(" 新しい社群を登録 ",-1)])]),_:1})],64))])])])):h("",!0)])}}}),jt=dt($t,[["__scopeId","data-v-268b6df5"]]);export{jt as default};
