import{d as tt,c as h,B as st,r as p,g as at,a as et,o as lt,e as n,A as nt,i as t,j as f,E as w,F as m,h as k,t as l,k as C,z as D,n as L,w as it,ar as ot,as as ct,at as rt,u as dt,f as i,_ as vt}from"./index-D9GuT0xz.js";import{P as ut}from"./PageMarker-CiSmMvmB.js";const pt={class:"page"},mt={key:0,class:"skeleton-overlay","aria-hidden":"true"},ht={class:"skeleton-stack"},bt={class:"panel skeleton-panel"},kt={class:"ticket-breakdown mt-3"},_t={class:"panel skeleton-panel"},gt={key:1,class:"panel error-panel"},yt={class:"panel-title"},ft={class:"hero-card"},wt={class:"hero-content"},Ct={class:"hero-head"},xt={class:"hero-text"},St={class:"hero-title line-clamp-2"},Pt={class:"chip-row"},Tt={class:"chip"},Et={class:"chip"},Mt={key:0,class:"panel"},Ut={class:"panel-head"},At={class:"panel-title"},Dt={class:"muted"},Lt={class:"pill"},Rt={class:"progress"},Vt={class:"stat-grid"},Nt={class:"stat-card"},Bt={class:"stat-value"},It={class:"stat-hint"},$t={class:"stat-card"},jt={class:"stat-value"},zt={key:0,class:"ticket-breakdown"},Ft={class:"ticket-meta"},Jt={class:"ticket-name"},qt={class:"ticket-progress"},Gt={class:"ticket-count"},Ht={class:"participants"},Kt={class:"avatar-stack"},Ot=["src"],Qt={key:1,class:"panel muted-panel"},Wt={class:"panel-head"},Xt={class:"pill light"},Yt=["onClick"],Zt={class:"avatar-shell"},ts=["src"],ss={key:1,class:"avatar empty"},as={class:"entry-main"},es={class:"entry-head"},ls={class:"entry-name"},ns={class:"entry-sub"},is={key:0,class:"empty-state"},os={class:"sheet"},cs={class:"flex items-center mb-3"},rs={class:"avatar-shell"},ds=["src"],vs={key:1,class:"avatar empty"},us={class:"ml-2"},ps={class:"sheet-name"},ms={class:"sheet-sub"},hs=tt({__name:"ConsoleEventManageMobile",setup(bs){const R=st(),V=dt(),_=h(()=>R.params.eventId),g=p(!0),b=p(""),N=h(()=>g.value||!r.value&&!b.value),v=p(null),u=p(null),S=p([]),o=p(null),P=p(null),r=h(()=>v.value?{id:v.value.id,title:at(v.value.title),status:v.value.status,dateTimeText:X(v.value.startTime,v.value.endTime),locationText:v.value.locationText}:null),T=et(),{slotMap:B}=T,I=h(()=>T.getStringValue("mobile.console.memberAvatar")||B["mobile.console.memberAvatar"].defaultValue),c=h(()=>{var A;if(!u.value)return null;const a=u.value.totalRegistrations,s=u.value.capacity??a,e=s?Math.min(100,Math.round(a/s*100)):0,y=((A=u.value.avatars)==null?void 0:A.slice(0,5))??[],Z=u.value.groups??[];return{totalConfirmed:a,capacity:s,paidCount:u.value.paidRegistrations,progressPercent:e,sampleParticipants:y.map(d=>({id:d.userId,avatarUrl:d.avatarUrl??I.value})),tickets:Z.map(d=>({id:d.label,name:d.label,confirmed:d.count,capacity:d.capacity??s,progressPercent:d.capacity?Math.min(100,Math.round(d.count/d.capacity*100)):e}))}}),x=h(()=>S.value.map($));function $(a){var s,e;return{id:a.registrationId,name:a.user.name||"ゲスト",avatarUrl:a.user.avatarUrl??void 0,initials:((s=a.user.name)==null?void 0:s.charAt(0).toUpperCase())??"U",ticketName:((e=a.ticket)==null?void 0:e.name)??"未設定",paymentStatus:a.paymentStatus,attended:a.attended,noShow:a.noShow,createdAtText:new Date(a.createdAt).toLocaleString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}}const E=async()=>{if(_.value){g.value=!0,b.value="";try{const[a,s,e]=await Promise.all([ot(_.value),ct(_.value),rt(_.value)]);v.value=a,u.value=s,S.value=e.items}catch(a){console.error("Failed to load event manage page",a),b.value=a instanceof Error?a.message:"数据获取失败"}finally{g.value=!1}}},j=()=>{r.value&&window.open(`/events/${r.value.id}`,"_blank")},z=()=>{r.value&&V.push({path:`/console/events/${r.value.id}/edit`})},F=a=>{switch(a){case"open":return"受付中";case"closed":return"終了";default:return"下書き"}},J=a=>{switch(a){case"open":return"bg-emerald-100 text-emerald-700";case"closed":return"bg-slate-100 text-slate-500";default:return"bg-amber-100 text-amber-700"}},M=a=>{if(a.attended)return"出席済み";if(a.noShow)return"無断欠席";switch(a.paymentStatus){case"paid":return"支払済み";case"unpaid":return"未払い";default:return a.paymentStatus}},q=a=>a.attended?"bg-emerald-100 text-emerald-700":a.noShow?"bg-rose-100 text-rose-600":a.paymentStatus==="paid"?"bg-slate-800 text-white":"bg-slate-100 text-slate-500",G=()=>{var a;(a=P.value)==null||a.scrollIntoView({behavior:"smooth"})},H=a=>{o.value=a},U=()=>{o.value=null},K=()=>{console.log("Viewing entry detail",o.value)},O=()=>{console.log("Mark check-in",o.value)},Q=()=>{console.log("Cancel entry",o.value)},W=()=>{console.log("Start refund",o.value)},X=(a,s)=>{const e=new Date(a).toLocaleString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});if(!s)return e;const y=new Date(s).toLocaleString("ja-JP",{hour:"2-digit",minute:"2-digit"});return`${e}〜${y}`};lt(()=>{E()});const Y=()=>E();return(a,s)=>(i(),n(m,null,[nt(ut,{label:"P7"}),t("div",pt,[N.value?(i(),n("div",mt,[t("div",ht,[s[4]||(s[4]=w('<section class="hero-card skeleton-card" data-v-7c8b9a54><div class="hero-bg faded" data-v-7c8b9a54></div><div class="hero-content" data-v-7c8b9a54><div class="skeleton-line short" data-v-7c8b9a54></div><div class="skeleton-line long mt-3" data-v-7c8b9a54></div><div class="chip-row mt-3" data-v-7c8b9a54><span class="chip skeleton-chip" data-v-7c8b9a54></span><span class="chip skeleton-chip" data-v-7c8b9a54></span></div><div class="hero-actions mt-4" data-v-7c8b9a54><span class="btn ghost skeleton-line" data-v-7c8b9a54></span><span class="btn solid skeleton-line" data-v-7c8b9a54></span></div></div></section>',1)),t("section",bt,[s[1]||(s[1]=w('<div class="skeleton-line medium" data-v-7c8b9a54></div><div class="skeleton-line long mt-2" data-v-7c8b9a54></div><div class="progress mt-4" data-v-7c8b9a54><div class="progress-bar shimmer" style="width:65%;" data-v-7c8b9a54></div></div><div class="stat-grid mt-2" data-v-7c8b9a54><div class="stat-card" data-v-7c8b9a54><div class="skeleton-line medium" data-v-7c8b9a54></div><div class="skeleton-line short mt-3" data-v-7c8b9a54></div></div><div class="stat-card" data-v-7c8b9a54><div class="skeleton-line medium" data-v-7c8b9a54></div><div class="skeleton-line short mt-3" data-v-7c8b9a54></div></div></div>',4)),t("div",kt,[(i(),n(m,null,k(2,e=>t("div",{class:"ticket-row",key:e},[...s[0]||(s[0]=[w('<div class="ticket-meta" data-v-7c8b9a54><span class="ticket-dot" data-v-7c8b9a54></span><span class="skeleton-line short" data-v-7c8b9a54></span></div><div class="ticket-progress shimmer" data-v-7c8b9a54></div><span class="skeleton-line tiny" data-v-7c8b9a54></span>',3)])])),64))])]),t("section",_t,[s[3]||(s[3]=t("div",{class:"skeleton-line medium"},null,-1)),(i(),n(m,null,k(4,e=>t("div",{class:"skeleton-entry",key:"entry-"+e},[...s[2]||(s[2]=[w('<div class="avatar-shell" data-v-7c8b9a54><span class="avatar empty shimmer" data-v-7c8b9a54></span></div><div class="entry-main" data-v-7c8b9a54><div class="skeleton-line medium" data-v-7c8b9a54></div><div class="skeleton-line long mt-2" data-v-7c8b9a54></div></div>',2)])])),64))])])])):b.value?(i(),n("section",gt,[s[5]||(s[5]=t("p",{class:"eyebrow"},"加载失败",-1)),t("p",yt,l(b.value),1),t("button",{class:"btn solid mt-3 w-full",onClick:Y},"重试加载")])):r.value?(i(),n(m,{key:2},[t("section",ft,[s[11]||(s[11]=t("div",{class:"hero-bg"},null,-1)),t("div",wt,[t("div",Ct,[t("div",xt,[s[8]||(s[8]=t("p",{class:"eyebrow"},"Console · イベント管理",-1)),t("h1",St,l(r.value.title),1),t("div",Pt,[t("span",Tt,[s[6]||(s[6]=t("span",{class:"i-lucide-calendar mr-1"},null,-1)),C(l(r.value.dateTimeText),1)]),t("span",Et,[s[7]||(s[7]=t("span",{class:"i-lucide-map-pin mr-1"},null,-1)),C(l(r.value.locationText),1)])])]),t("span",{class:D(["status-chip",J(r.value.status)])},l(F(r.value.status)),3)]),t("div",{class:"hero-actions"},[t("button",{class:"btn ghost",onClick:j},[...s[9]||(s[9]=[t("span",{class:"i-lucide-external-link mr-1.5"},null,-1),C(" 前台ページを見る ",-1)])]),t("button",{class:"btn solid",onClick:z},[...s[10]||(s[10]=[t("span",{class:"i-lucide-pencil mr-1.5"},null,-1),C(" イベントを編集 ",-1)])])])])]),c.value?(i(),n("section",Mt,[t("div",Ut,[t("div",null,[s[12]||(s[12]=t("p",{class:"eyebrow"},"申込状況",-1)),t("h2",At,"合計 "+l(c.value.totalConfirmed)+"/"+l(c.value.capacity)+" 人",1),t("p",Dt,"うち "+l(c.value.paidCount)+" 人が支払い済み",1)]),t("div",Lt,"進捗 "+l(c.value.progressPercent)+"%",1)]),t("div",Rt,[t("div",{class:"progress-bar",style:L({width:c.value.progressPercent+"%"})},null,4)]),t("div",Vt,[t("div",Nt,[s[13]||(s[13]=t("p",{class:"stat-label"},"現在の確定",-1)),t("p",Bt,l(c.value.totalConfirmed),1),t("p",It,"目標 "+l(c.value.capacity)+" 人",1)]),t("div",$t,[s[14]||(s[14]=t("p",{class:"stat-label"},"支払い済み",-1)),t("p",jt,l(c.value.paidCount),1),s[15]||(s[15]=t("p",{class:"stat-hint"},"リアルタイム更新",-1))])]),c.value.tickets.length?(i(),n("div",zt,[s[17]||(s[17]=t("p",{class:"eyebrow mb-2"},"チケット別",-1)),(i(!0),n(m,null,k(c.value.tickets,e=>(i(),n("div",{key:e.id,class:"ticket-row"},[t("div",Ft,[s[16]||(s[16]=t("span",{class:"ticket-dot"},null,-1)),t("span",Jt,l(e.name),1)]),t("div",qt,[t("div",{class:"ticket-progress-bar",style:L({width:e.progressPercent+"%"})},null,4)]),t("span",Gt,l(e.confirmed)+"/"+l(e.capacity),1)]))),128))])):f("",!0),t("div",Ht,[t("div",Kt,[(i(!0),n(m,null,k(c.value.sampleParticipants,e=>(i(),n("img",{key:e.id,src:e.avatarUrl,class:"avatar",alt:"participant"},null,8,Ot))),128))]),t("button",{class:"link-btn",onClick:G},"参加者一覧を見る")])])):(i(),n("section",Qt,[...s[18]||(s[18]=[t("p",{class:"eyebrow"},"申込状況",-1),t("h2",{class:"panel-title"},"まだデータがありません",-1),t("p",{class:"muted"},"发布或有报名后，会自动呈现进度和票种分布。",-1)])])),t("section",{class:"panel",ref_key:"memberListRef",ref:P},[t("div",Wt,[s[19]||(s[19]=t("div",null,[t("p",{class:"eyebrow"},"参加者"),t("h2",{class:"panel-title"},"リスト")],-1)),t("span",Xt,l(x.value.length)+" 人",1)]),(i(!0),n(m,null,k(x.value,e=>(i(),n("div",{key:e.id,class:"entry-row",onClick:y=>H(e)},[t("div",Zt,[e.avatarUrl?(i(),n("img",{key:0,src:e.avatarUrl,class:"avatar",alt:""},null,8,ts)):(i(),n("span",ss,l(e.initials),1))]),t("div",as,[t("div",es,[t("p",ls,l(e.name),1),t("span",{class:D(["entry-chip",q(e)])},l(M(e)),3)]),t("p",ns,l(e.ticketName)+" · "+l(e.createdAtText),1)]),s[20]||(s[20]=t("span",{class:"i-lucide-chevron-right text-slate-300"},null,-1))],8,Yt))),128)),!x.value.length&&!g.value?(i(),n("div",is,"まだ参加者がいません。")):f("",!0)],512),o.value?(i(),n("div",{key:2,class:"sheet-mask",onClick:it(U,["self"])},[t("div",os,[s[21]||(s[21]=t("div",{class:"sheet-handle"},null,-1)),t("div",cs,[t("div",rs,[o.value.avatarUrl?(i(),n("img",{key:0,src:o.value.avatarUrl,class:"avatar",alt:""},null,8,ds)):(i(),n("span",vs,l(o.value.initials),1))]),t("div",us,[t("p",ps,l(o.value.name),1),t("p",ms,l(o.value.ticketName)+" · "+l(M(o.value)),1)])]),t("button",{class:"sheet-action",onClick:K},"詳細を見る"),t("button",{class:"sheet-action",onClick:O},"チェックインにする"),t("button",{class:"sheet-action",onClick:Q},"申込を取消"),t("button",{class:"sheet-action danger",onClick:W},"返金を開始"),t("button",{class:"sheet-close",onClick:U},"閉じる")])])):f("",!0)],64)):f("",!0)])],64))}}),gs=vt(hs,[["__scopeId","data-v-7c8b9a54"]]);export{gs as default};
