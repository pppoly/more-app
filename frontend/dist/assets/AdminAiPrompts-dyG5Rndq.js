import{d as T,r as c,o as w,e as m,i as e,j as h,t as _,k as P,F as k,h as C,x as a,y as n,K as S,aB as A,aC as I,aH as N,f as p,_ as B}from"./index-DncFUGrq.js";const D={class:"prompt-page"},M={class:"page-head"},O={class:"actions"},L=["disabled"],j=["disabled"],E={key:0,class:"banner error"},J={key:1,class:"banner success"},$={class:"toolbar"},z={class:"hint"},F=["aria-busy"],R={class:"row"},H=["onUpdate:modelValue"],K={class:"row grid2"},q=["onUpdate:modelValue"],G=["onUpdate:modelValue"],Q={class:"row"},W=["onUpdate:modelValue"],X={class:"row grid2"},Y=["onUpdate:modelValue"],Z=["onUpdate:modelValue"],ee={class:"row"},te=["onUpdate:modelValue"],se={class:"row"},le=["onUpdate:modelValue"],oe={class:"row"},ae=["onUpdate:modelValue"],ne={class:"row grid2"},ie=["onUpdate:modelValue"],de=["onUpdate:modelValue"],ue={class:"card-footer"},re={class:"muted"},ce=["onClick"],me=T({__name:"AdminAiPrompts",setup(pe){const d=c(!1),i=c(null),v=c(null),b=c([]),u=c([]),x=o=>o.map(t=>({...t,metaText:t.meta?JSON.stringify(t.meta,null,2):"",paramsText:(t.params??[]).join(","),tagsText:(t.tags??[]).join(",")})),g=o=>o.map(t=>{var r;let s;return t.metaText&&t.metaText.trim().length&&(s=JSON.parse(t.metaText)),{id:t.id.trim(),name:((r=t.name)==null?void 0:r.trim())||t.id,description:t.description??"",version:t.version??"",system:t.system??"",instructions:t.instructions??"",params:t.paramsText?t.paramsText.split(",").map(l=>l.trim()).filter(Boolean):[],tags:t.tagsText?t.tagsText.split(",").map(l=>l.trim()).filter(Boolean):[],meta:s}}),y=async()=>{d.value=!0,i.value=null;try{const[o,t]=await Promise.all([A(),I()]);u.value=x(o),b.value=t.supported??[]}catch(o){console.error(o),i.value="加载 Prompt 失败，请稍后重试。"}finally{d.value=!1}},V=async()=>{v.value=null,i.value=null;try{const o=g(u.value);o.forEach(t=>{if(!t.id||!t.system)throw new Error("Prompt ID 和 System 不能为空")}),await N(o),v.value="已保存 Prompt 更新",await y()}catch(o){console.error(o),i.value=(o==null?void 0:o.message)||"保存失败"}},f=()=>{u.value.push({id:`prompt-${Date.now()}`,name:"",version:"",description:"",system:"",metaText:"",status:"draft"})},U=o=>{u.value.splice(o,1)};return w(()=>{y()}),(o,t)=>(p(),m("main",D,[e("header",M,[t[1]||(t[1]=e("div",null,[e("p",{class:"eyebrow"},"SOCIALMORE · AI PROMPTS"),e("h1",null,"Prompt 管理"),e("p",{class:"subhead"}," 查看和更新各场景的 Prompt。修改会直接影响模型调用，请谨慎保存并保持版本说明。 ")],-1)),e("div",O,[e("button",{type:"button",class:"ghost",disabled:d.value,onClick:y},"重新加载",8,L),e("button",{type:"button",class:"primary",disabled:d.value,onClick:V},"保存全部",8,j)])]),i.value?(p(),m("section",E,[e("span",null,_(i.value),1),e("button",{type:"button",class:"ghost",onClick:t[0]||(t[0]=s=>i.value=null)},"关闭")])):h("",!0),v.value?(p(),m("section",J,[e("span",null,_(v.value),1)])):h("",!0),e("section",$,[e("button",{type:"button",class:"outline",onClick:f},[...t[2]||(t[2]=[e("span",{class:"i-lucide-plus"},null,-1),P(" 新建 Prompt ",-1)])]),e("p",z,"支持语言："+_(b.value.join(", ")),1)]),e("section",{class:"prompt-list","aria-busy":d.value},[(p(!0),m(k,null,C(u.value,(s,r)=>(p(),m("article",{key:s.id,class:"prompt-card"},[e("div",R,[t[3]||(t[3]=e("label",null,"Prompt ID",-1)),a(e("input",{"onUpdate:modelValue":l=>s.id=l,type:"text",placeholder:"唯一 ID"},null,8,H),[[n,s.id]])]),e("div",K,[e("div",null,[t[4]||(t[4]=e("label",null,"名称",-1)),a(e("input",{"onUpdate:modelValue":l=>s.name=l,type:"text",placeholder:"显示名称"},null,8,q),[[n,s.name]])]),e("div",null,[t[5]||(t[5]=e("label",null,"版本",-1)),a(e("input",{"onUpdate:modelValue":l=>s.version=l,type:"text",placeholder:"如 2024-11-22"},null,8,G),[[n,s.version]])])]),e("div",Q,[t[6]||(t[6]=e("label",null,"描述",-1)),a(e("input",{"onUpdate:modelValue":l=>s.description=l,type:"text",placeholder:"用途说明"},null,8,W),[[n,s.description]])]),e("div",X,[e("div",null,[t[7]||(t[7]=e("label",null,"版本",-1)),a(e("input",{"onUpdate:modelValue":l=>s.version=l,type:"text",placeholder:"如 2024-11-22"},null,8,Y),[[n,s.version]])]),e("div",null,[t[9]||(t[9]=e("label",null,"状态",-1)),a(e("select",{"onUpdate:modelValue":l=>s.status=l},[...t[8]||(t[8]=[e("option",{value:"draft"},"draft",-1),e("option",{value:"published"},"published",-1)])],8,Z),[[S,s.status]])])]),e("div",ee,[t[10]||(t[10]=e("label",null,"System Prompt",-1)),a(e("textarea",{"onUpdate:modelValue":l=>s.system=l,rows:"5",placeholder:"系统提示词"},null,8,te),[[n,s.system]])]),e("div",se,[t[11]||(t[11]=e("label",null,"Instructions（可选）",-1)),a(e("textarea",{"onUpdate:modelValue":l=>s.instructions=l,rows:"2",placeholder:"补充指示"},null,8,le),[[n,s.instructions]])]),e("div",oe,[t[12]||(t[12]=e("label",null,"Meta (JSON)",-1)),a(e("textarea",{"onUpdate:modelValue":l=>s.metaText=l,rows:"3",placeholder:'{"target":"events"}'},null,8,ae),[[n,s.metaText]])]),e("div",ne,[e("div",null,[t[13]||(t[13]=e("label",null,"参数列表（逗号分隔）",-1)),a(e("input",{"onUpdate:modelValue":l=>s.paramsText=l,type:"text",placeholder:"如 source_lang,target_lang,content"},null,8,ie),[[n,s.paramsText]])]),e("div",null,[t[14]||(t[14]=e("label",null,"标签（逗号分隔）",-1)),a(e("input",{"onUpdate:modelValue":l=>s.tagsText=l,type:"text",placeholder:"translation,event"},null,8,de),[[n,s.tagsText]])])]),e("div",ue,[e("span",re,"索引："+_(r+1),1),e("button",{type:"button",class:"ghost danger",onClick:l=>U(r)},"删除",8,ce)])]))),128))],8,F)]))}}),_e=B(me,[["__scopeId","data-v-81f2e3a8"]]);export{_e as default};
