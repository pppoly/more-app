import{d as le,c as M,A as oe,B as se,r as u,o as ae,b as r,h as e,t as p,i as q,v as _,x as C,F as H,f as W,w as te,a8 as ne,a as I,ab as $,ac as ie,ad as re,u as de,e as d,K as ce,_ as ue}from"./index-BGcABSEi.js";const pe={class:"community-form"},ve={class:"hero-card"},me={class:"hero-text"},ge={class:"hero-eyebrow"},be={class:"hero-status"},fe={class:"form-card"},ye={class:"ios-field"},he={class:"ios-field"},_e=["disabled"],we={class:"form-card"},Ue={class:"ios-field"},Ce={key:0,class:"chip-row"},Ie={class:"form-card"},ke={class:"radio-group"},xe=["value"],Le={class:"radio-content"},Fe={class:"radio-title"},Ee={class:"radio-desc"},Me={class:"form-card"},Be={class:"upload-grid"},De={class:"upload-card"},Ve={key:0,class:"upload-preview"},Ae=["src"],Pe={key:1,class:"upload-empty"},Re={class:"upload-card"},Se={key:0,class:"upload-preview"},Te=["src"],Ne={key:1,class:"upload-empty"},je={class:"form-card"},qe={key:0,class:"form-error"},He={class:"form-footer"},We=["disabled"],$e=le({__name:"ConsoleCommunityCreateMobile",setup(ze){const z=oe(),B=de(),v=M(()=>z.params.communityId),m=M(()=>!!v.value),o=se({name:"",slug:"",labels:"",visibleLevel:"public",coverImageUrl:"",logoImageUrl:"",description:""}),D=u(null),V=u(null),g=u(null),b=u(null),k=u(!1),x=u(!1),w=u(!1),f=u(null),G=[{value:"public",label:"公開",desc:"誰でも閲覧できる"},{value:"semi-public",label:"社群内公開",desc:"Console / 既存メンバーのみ"},{value:"private",label:"非公開",desc:"運営メモ用・外部非公開"}],L=M(()=>o.labels.split(",").map(s=>s.trim()).filter(Boolean)),K=async()=>{if(v.value)try{const s=await ne(v.value);o.name=s.name,o.slug=s.slug,o.visibleLevel=s.visibleLevel||"public",o.labels=(s.labels||[]).join(", "),o.coverImageUrl=s.coverImageUrl||"",b.value=o.coverImageUrl?I(o.coverImageUrl):null;const l=typeof s.description=="object"&&s.description?s.description:null;o.description=(l==null?void 0:l.original)??"",o.logoImageUrl=(l==null?void 0:l.logoImageUrl)??"",g.value=o.logoImageUrl?I(o.logoImageUrl):null}catch(s){f.value=s instanceof Error?s.message:"読み込みに失敗しました"}},X=()=>({original:o.description,lang:"ja",translations:{},logoImageUrl:o.logoImageUrl||null}),Y=()=>{var s;(s=D.value)==null||s.click()},J=()=>{var s;(s=V.value)==null||s.click()},A=(s,l,a)=>new Promise((n,t)=>{const c=new FileReader;c.onload=()=>{const i=new Image;i.onload=()=>{const{width:T,height:F}=i;let y=T,h=y/l;h>F&&(h=F,y=h*l);const Z=(T-y)/2,ee=(F-h)/2,E=Math.min(a,y),N=E/l,U=document.createElement("canvas");U.width=E,U.height=N;const j=U.getContext("2d");if(!j){t(new Error("Canvas not supported"));return}j.drawImage(i,Z,ee,y,h,0,0,E,N),n(U.toDataURL("image/jpeg",.85))},i.onerror=()=>t(new Error("Failed to load image")),i.src=c.result},c.onerror=()=>t(new Error("Failed to read file")),c.readAsDataURL(s)}),P=async(s,l)=>{const n=await(await fetch(s)).blob();return new File([n],l,{type:n.type||"image/jpeg"})},O=async s=>{var n;const a=(n=s.target.files)==null?void 0:n[0];if(!(!a||k.value)){k.value=!0;try{const t=await A(a,1,512);g.value=t;const c=await P(t,`logo-${Date.now()}.jpg`),{imageUrl:i}=await $(c,"logo");o.logoImageUrl=i,g.value=I(i)}catch(t){console.warn(t)}finally{k.value=!1}}},Q=async s=>{var n;const a=(n=s.target.files)==null?void 0:n[0];if(!(!a||x.value)){x.value=!0;try{const t=await A(a,1.7777777777777777,1280);b.value=t;const c=await P(t,`cover-${Date.now()}.jpg`),{imageUrl:i}=await $(c,"cover");o.coverImageUrl=i,b.value=I(i)}catch(t){console.warn(t)}finally{x.value=!1}}},R=async()=>{w.value=!0,f.value=null;const s={name:o.name,slug:o.slug,labels:L.value,visibleLevel:o.visibleLevel,coverImageUrl:o.coverImageUrl||null,logoImageUrl:o.logoImageUrl||null,description:X()};try{m.value&&v.value?await ie(v.value,s):await re(s),B.replace({name:"console-communities"})}catch(l){f.value=l instanceof Error?l.message:"保存に失敗しました"}finally{w.value=!1}},S=()=>{B.back()};return ae(K),(s,l)=>(d(),r("div",pe,[e("header",ve,[e("button",{class:"hero-back",type:"button",onClick:S},[...l[5]||(l[5]=[e("span",{class:"i-lucide-chevron-left"},null,-1)])]),e("div",me,[e("p",ge,p(m.value?"社群設定":"新しい社群"),1),e("h1",null,p(m.value?"社群資料を更新":"社群を登録"),1),l[6]||(l[6]=e("p",{class:"hero-subtext"}," AI が社群情報を参照しながら活動助手を最適化します。ベーシックな情報から入力しましょう。 ",-1))]),e("span",be,p(m.value?"編集中":"草稿"),1)]),e("form",{class:"form-sections",onSubmit:te(R,["prevent"])},[e("section",fe,[l[9]||(l[9]=e("p",{class:"card-label"},"基本情報",-1)),e("div",ye,[l[7]||(l[7]=e("label",null,"社群名称",-1)),_(e("input",{"onUpdate:modelValue":l[0]||(l[0]=a=>o.name=a),type:"text",placeholder:"Tokyo Community...",required:""},null,512),[[C,o.name]])]),e("div",he,[l[8]||(l[8]=e("label",null,"Slug",-1)),_(e("input",{"onUpdate:modelValue":l[1]||(l[1]=a=>o.slug=a),type:"text",disabled:m.value,placeholder:"tokyo-community",required:""},null,8,_e),[[C,o.slug]])])]),e("section",we,[l[11]||(l[11]=e("div",{class:"card-head"},[e("p",{class:"card-label"},"ラベル"),e("p",{class:"card-hint"},"カンマ区切りで入力 / ワンタップで編集")],-1)),e("div",Ue,[l[10]||(l[10]=e("label",null,"キーワード",-1)),_(e("input",{"onUpdate:modelValue":l[2]||(l[2]=a=>o.labels=a),type:"text",placeholder:"親子, 多文化, NPO"},null,512),[[C,o.labels]])]),L.value.length?(d(),r("div",Ce,[(d(!0),r(H,null,W(L.value,a=>(d(),r("span",{key:a,class:"chip"},p(a),1))),128))])):q("",!0)]),e("section",Ie,[l[12]||(l[12]=e("div",{class:"card-head"},[e("p",{class:"card-label"},"公開範囲"),e("p",{class:"card-hint"},"ユーザー側にどこまで公開するかを決めます")],-1)),e("div",ke,[(d(),r(H,null,W(G,a=>e("label",{key:a.value,class:"radio-tile"},[_(e("input",{"onUpdate:modelValue":l[3]||(l[3]=n=>o.visibleLevel=n),value:a.value,type:"radio"},null,8,xe),[[ce,o.visibleLevel]]),e("div",Le,[e("p",Fe,p(a.label),1),e("p",Ee,p(a.desc),1)])])),64))])]),e("section",Me,[l[17]||(l[17]=e("p",{class:"card-label"},"ビジュアル",-1)),e("div",Be,[e("div",De,[l[14]||(l[14]=e("p",{class:"upload-title"},"ロゴ画像",-1)),e("div",{class:"upload-drop",onClick:Y},[e("input",{ref_key:"logoInput",ref:D,type:"file",accept:"image/*",class:"hidden-input",onChange:O},null,544),g.value?(d(),r("div",Ve,[e("img",{src:g.value,alt:"logo preview"},null,8,Ae)])):(d(),r("div",Pe,[...l[13]||(l[13]=[e("span",{class:"i-lucide-image-plus"},null,-1),e("p",null,"タップしてアップロード",-1)])]))])]),e("div",Re,[l[16]||(l[16]=e("p",{class:"upload-title"},"カバー画像",-1)),e("div",{class:"upload-drop",onClick:J},[e("input",{ref_key:"coverInput",ref:V,type:"file",accept:"image/*",class:"hidden-input",onChange:Q},null,544),b.value?(d(),r("div",Se,[e("img",{src:b.value,alt:"cover preview"},null,8,Te)])):(d(),r("div",Ne,[...l[15]||(l[15]=[e("span",{class:"i-lucide-image-plus"},null,-1),e("p",null,"タップしてアップロード",-1)])]))])])])]),e("section",je,[l[18]||(l[18]=e("div",{class:"card-head"},[e("p",{class:"card-label"},"紹介文"),e("p",{class:"card-hint"},"AI に渡る原稿です。ミッション・活動内容・対象者などを書きましょう。")],-1)),_(e("textarea",{"onUpdate:modelValue":l[4]||(l[4]=a=>o.description=a),rows:"6",placeholder:"例：Tokyo Community Organizations Meetup Group は..."},null,512),[[C,o.description]])]),f.value?(d(),r("p",qe,p(f.value),1)):q("",!0)],32),e("footer",He,[e("button",{type:"button",class:"ghost-btn",onClick:S},"キャンセル"),e("button",{type:"button",class:"primary-btn",disabled:w.value,onClick:R},p(w.value?"保存中…":"保存する"),9,We)])]))}}),Ke=ue($e,[["__scopeId","data-v-eea7479d"]]);export{Ke as default};
